### YamlMime:Tutorial
title: Teams自适应卡片的选项卡
metadata:
  title: Teams自适应卡片的选项卡
  description: 本教程介绍如何在选项卡中设置自适应卡片，Teams。
  audience: Developer
  level: Beginner
  ms.date: 12/23/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: tabs/how-to/authentication/auth-aad-sso.md
  nextTutorialTitle: 在选项卡身份验证上阅读更多信息
  ms.custom: mvc
  ms.localizationpriority: high
  ms.openlocfilehash: 61a999d64574a2a4b0877378b093569ba7f850c9
  ms.sourcegitcommit: 9e448dcdfd78f4278e9600808228e8158d830ef7
  ms.translationtype: MT
  ms.contentlocale: zh-CN
  ms.lasthandoff: 01/17/2022
  ms.locfileid: "62059649"
items:
- durationInMinutes: 1
  content: >
    自适应卡片选项卡是一种在卡片中生成选项卡的Teams。 你可以将自适应卡片呈现到选项卡，而不是在 IFrame 中嵌入 Web 内容。使用自适应卡片呈现前端时，后端由机器人提供电源。 机器人负责接受请求，以及使用呈现的自适应卡片进行相应响应。


    可以使用相关的用户界面构建选项卡， (UI) 桌面、Web 和移动设备上的本机构建基块。


    本文可帮助你了解：


    * 需要更改应用清单。

    * 标识调用活动如何请求和发送带自适应卡片的选项卡信息。

    * 对任务模块工作流的影响。


    此分步指南可帮助你在桌面和移动设备上使用自适应卡片生成选项卡。 你将看到以下输出：


    ![桌面移动屏幕截图](~/assets/images/adaptive-cards/desktop-mobile-screenshot.png)
- title: 先决条件
  durationInMinutes: 1
  content: >
    确保安装以下工具并设置开发环境


    * Microsoft Teams帐户， (来宾帐户) 。

    * [Visual Studio Code](https://code.visualstudio.com/)

    * [.NET Core SDK](https://dotnet.microsoft.com/download) 版本 3.1

    * [ngrok](https://ngrok.com/)或[Tunnel Relay](https://github.com/OfficeDev/microsoft-teams-tunnelrelay)

    * [Microsoft 365开发者帐户](https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant)或Teams具有安装应用的适当权限的帐户。
- title: 在 Azure 门户创建自动程序注册
  durationInMinutes: 2
  content: "自适应卡片选项卡需要 Azure Bot 服务在团队中生成选项卡。 当你在 Azure 中开发和托管自动程序服务时，向 Azure 自动程序服务注册它。 执行下列操作：\n1. 使用 ngrok 创建到 Web 服务器的终结点的隧道。\n1. 创建 Azure Bot 资源以向 Azure Bot 服务注册自动程序。\n1. 创建启用自动程序 SSO 身份验证的客户端密码。\n1. 添加Microsoft Teams频道以将机器人部署到Teams频道。\n1. 将消息终结点添加到您创建的 ngrok 隧道。\n\n使用 ngrok 创建到本地运行的 Web 服务器的公开可用 HTTPS 终结点的隧道。 在 ngrok 中运行以下命令：\n\n```bash\nngrok http -host-header=rewrite 3978\n```\n\n**创建 Azure Bot 资源**\n\n1. 打开 [Azure 门户](https://portal.azure.com/)。\n1. 选择“**创建资源**”。\n1. 在搜索 **框中搜索 Azure** 机器人。\n1. 选择 **Azure Bot**。\n\n    ![Azure Bot](~/assets/images/adaptive-cards/azure-bot.png)\n\n1. 选择“**创建**”。\n1. 在\"自动程序句柄\"字段中 **输入自动程序句柄** 名称。\n1. 从下拉列表 **中选择** 你的订阅。\n1. 从 **下拉列表中选择** 资源组。\n    \n    若要创建新资源组，请选择\"新建\"，输入资源名称，选择\"确定\"，然后从\"新建资源 **组** 位置\"下拉列表中选择所需位置。\n\n1. 选择 **\"应用类型\"** 作为 Microsoft 应用 ID **的多****租户**。\n\n    ![多租户](~/assets/images/adaptive-cards/multi-tenant.png)\n\n    > [!NOTE]\n    > 在 **\"Microsoft 应用** ID 的创建类型\"部分，已选择\"创建新的 **Microsoft 应用 ID\"** 以创建新自动程序。 如果已注册 **自动程序**，还可以选择\"使用现有应用注册\"。 在\"现有应用 ID\"字段中输入 Microsoft 应用 **ID，** 在\"现有应用密码 **\"字段中输入** 值。\n\n1. 然后“**审阅 + 创建**”。\n\n    ![创建 Azure Bot](~/assets/images/adaptive-cards/create-azure-bot.png)\n\n1. 如果验证通过，请选择\"创建 **\"。**\n\n    设置自动程序服务需要一些时间。\n\n    ![Azure Bot 验证](~/assets/images/adaptive-cards/validation-pane.png)\n\n1. 选择“**转到资源**”。 自动程序和相关资源在资源组中列出。\n\n    ![转到资源](~/assets/images/adaptive-cards/go-to-resource-card.png)\n\n    现在，Azure 自动程序已创建。\n\n    ![已创建 Azure 自动程序资源](~/assets/images/adaptive-cards/azure-bot-ui.png)\n\n**创建客户端密码**\n\n1. 在 **设置** 中，选择\"配置 **\"。** 保存 **Microsoft 应用 ID** (客户端 ID) 供将来参考。\n\n    ![Microsoft 应用 ID](~/assets/images/adaptive-cards/config-microsoft-app-id.png)\n\n1. 与 **Microsoft 应用 ID 相邻，** 选择\"管理 **\"。**\n\n    ![管理自动程序](~/assets/images/adaptive-cards/manage-bot-label.png)\n\n1. 在\"**客户端密码\"** 部分，选择 **\"新建客户端密码\"。****将显示\"添加客户端密码**\"窗口。  \n\n    ![新客户端密码](~/assets/images/adaptive-cards/new-client-secret.png)\n\n1. 输入 **\"说明**\"，然后选择\"**添加\"。**\n\n    ![客户端密码](~/assets/images/adaptive-cards/client-secret.png)\n\n1. 在\" **值\"** 列中， **选择\"复制到剪贴板** \"，并保存客户端密码 ID 供将来参考。\n\n    ![客户端密码值](~/assets/images/adaptive-cards/client-secret-value.png)\n   \n**添加Microsoft Teams频道**\n\n1. 转到 **主页**。\n\n    ![自动程序主页](~/assets/images/adaptive-cards/bot-home-page.png)\n\n1. 打开\"最近使用的资源\"部分 **列出的自动** 程序。\n1. 选择 **左窗格中** 的\"频道\"，然后选择 **\"Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n    ![频道Teams](~/assets/images/adaptive-cards/channel-teams.png)\n\n1. 选中复选框以接受服务条款，然后选择\"同意 **\"。**</br>\n\n    ![选择服务条款](~/assets/images/adaptive-cards/select-terms-of-service.png)\n\n1. 选择“**保存**”。\n\n    ![选择Teams](~/assets/images/adaptive-cards/select-teams.png)\n\n**添加消息终结点**\n\n1. 转到主页 **，****然后从左****窗格中选择** 设置配置\"。\n1. 转到 ngrok。\n1. 将 HTTPS URL (https 复制到 io) 如下图所示：\n\n    ![ngrok HTTPS URL](~/assets/images/adaptive-cards/ngrok-url.png)\n\n1. 在 **消息终结点中**，添加从 ngrok 生成的 HTTPS URL，在 URL 末尾添加 **/api/messages**。\n\n    ![消息终结点](~/assets/images/adaptive-cards/ngrok-messaging-endpoint.png)\n\n1. 选择“**应用**”。\n\n    你已成功在 Azure Bot 服务中设置自动程序，现在需要设置自动程序服务连接。\n"
- title: 设置自动程序服务连接
  durationInMinutes: 5
  content: "若要确保自动程序服务允许用户登录和访问自动程序，必须为自动程序配置 SSO。 为此，请执行下列操作：\n\n1. 将重定向 URI 添加到 Azure 自动程序资源\n1. 公开 API 终结点\n1. 授权客户端应用程序\n1. 为下游调用添加任何必要的 API 权限\n1. 启用隐式授予\n1. 更新清单\n1. 设置自动程序服务连接\n\n**将重定向 URI 添加到 Azure 自动程序资源**\n\n1. 选择 **\"Microsoft** 应用 ID\"旁边的\"**管理\"。**\n\n    ![管理自动程序](~/assets/images/adaptive-cards/manage-bot-label.png)\n\n1. 从 **自动** 程序资源的左窗格中选择身份验证。\n1. 在 **\"平台配置\"** 中，**选择\"添加平台\"。**\n1. 选择“Web”\n1. 输入 **重定向 URI** 作为 **https://token.botframework.com/.auth/web/redirect** ，然后选择配置 。\n\n    ![配置 Web 重定向 URL](~/assets/images/adaptive-cards/configure-web-redirect-url.png)\n\n    重定向 URI 将添加到 Azure 自动程序资源。\n\n    ![显示 Web 重定向 URL](~/assets/images/adaptive-cards/web-redirect-url-display.png)\n\n**公开 API 终结点**\n\n1. 从 **左窗格中选择\"** 公开 API\"。\n1. 为 **\"应用程序** ID URI\"选择\"设置\"。\n1. 使用 **所示的应用程序 ID URL，api://** 而不是在 **ngrok https://****中追加** 应用程序 ID URL，并添加在应用程序 ID URL 的开头。 \n\n    ![App ID URI](~/assets/images/adaptive-cards/app-id-url.png)\n\n1. 选择“**保存**”。\n1. 选择“**添加作用域**”。\n1. 在 **\"范围名称\"** 中 **，access_as_user\"。**\n1. In **Who can consent？**， switch to **Admins and users**.\n1. 在框中输入以下值：\n\n    | 字段 | 值 |\n    | ----- | ----- |\n    | 管理员同意显示名称 | Teams访问用户配置文件 |\n    | 管理员同意说明 | 允许Teams当前用户调用应用的 Web API。 |\n    | 用户同意显示名称 | Teams可以访问你的用户配置文件并代表你提出请求 |\n    | 用户同意说明 | 启用Teams以你拥有的相同权限调用此应用的 API。 |\n\n1. 确保将“状态”设置为“已启用”。\n\n    ![添加范围](~/assets/images/adaptive-cards/add-scope.png)\n\n1. 选择“**添加作用域**”。 范围名称自动匹配应用程序 ID URI，并access_as_user **/access_as_user** 结尾。\n\n**授权客户端应用程序**\n\n将以下 ID 添加为 **授权客户端应用程序**，选中\"授权范围\"复选框 **，然后选择\"****添加应用程序\"。**      \n* 1fec8e78-bce4-4aaf-ab1b-5451cc387264 (Teams移动或桌面应用程序)             \n* 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 (Teams Web 应用程序) </br>\n\n    ![添加客户端应用程序](~/assets/images/adaptive-cards/add-client-aapplication.png)      \n\n**为下游调用添加任何必要的 API 权限**\n\n1. 从 **左窗格中选择 API** 权限。\n1. 选择“**添加权限**”。 **将显示请求 API 权限** 窗口。\n1. 选择 **Microsoft API 的**。 然后选择 **\"Microsoft Graph\"，** 然后选择\"**委派权限\"。**\n1. 将应用 **所需的** 任何用户委派权限添加到下游 API，例如 User.Read。</br>\n\n    ![API 权限](~/assets/images/adaptive-cards/add-permissions.png)\n\n**启用隐式授予**\n\n1. 从 **左窗格中** 选择\"身份验证\"。\n1. 选中 **\"访问令牌****和 ID 令牌\"** 复选框。</br>\n\n    ![身份验证令牌](~/assets/images/adaptive-cards/authentication-tokens.png)\n\n1. 选择 **\"保存** \"保存更改。\n\n**更新清单**\n\n1. 从 **左窗格中** 选择清单。\n1. 确保配置项设置为 **\"accessTokenAcceptedVersion\"：2**。 如果没有，将其值更改为 **2，****然后选择保存**。\n    \n    > [!NOTE]\n    > 如果你已在应用中测试Teams，则必须注销此应用并注销Teams。 然后再次登录以查看此更改。\n\n    ![更新清单](~/assets/images/adaptive-cards/manifest.png)\n\n**设置自动程序服务连接**\n\n1. 转到主页 **，****然后从左****窗格中选择** 设置配置\"。\n1. 选择 **\"添加 OAuth 连接设置\"。**\n1. 在 **\"新建连接设置**\"中，输入以下详细信息：\n\n    | Field | 值或描述 |\n    | ----- | ----- |\n    | 名称 | 输入新连接设置的名称。 可以在自动程序服务代码的设置中使用该名称。 |\n    | 服务提供程序 | 选择 **\"Azure Active Directory V2\"。** |\n    | 客户端 ID | 以前另存为 **Microsoft 应用 ID**。 |\n    | 客户端密码 | 以前另存 **为** 客户端密码 ID 的值。 |\n    | 令牌Exchange URL | 在公开 **API 终结点时** ，使用之前获取的应用程序 ID URL。 |\n    | 租户 ID | 输入 **common**。 |\n    | Scopes | 输入 **User.Read，** 并添加指定下游 API 的权限时所需的全部作用域。 |\n\n    :::image type=\"content\" source=\"./assets/images/adaptive-cards/oauth-connection-setting.png\" alt-text=\"自动程序服务连接\":::\n\n1. 选择“**保存**”。\n"
- title: 配置自动程序
  durationInMinutes: 1
  content: >
    配置自动程序示例，了解如何在 Microsoft Teams 中对对话机器人进行身份验证。


    **配置和运行自动程序示例**


    1. 转到存储库 https://github.com/OfficeDev/Microsoft-Teams-Samples.git 。

    1. 选择 **"** 代码"，然后选择下拉列表。

    1. 选择 **下载 ZIP**。

        ![存储库下载](~/assets/images/adaptive-cards/repo-download.png)

    1. 确保记下下载的存储库的路径。

    1. 在文件资源管理器中，选择 **"Project"。**

    1. 转到 **Microsoft-Teams-Samples > tab-adaptive-cards > tab-adaptive-cards > > TabWithAdpativeCardFlow** 文件夹。

    1. 打开 Visual Studio Code 中的 **appsettings.json** 文件。

    1. 将 **机器人的 appsettings.json** 配置更新为使用 `MicrosoftAppId` `MicrosoftAppPassword` 、，将 ngrok URI 添加为 `ApplicationBaseUrl` 。

    1. 使用 OAuth 连接名称作为 **连接名称**。

        > [!NOTE]
        > 你可以从 `MicrosoftAppId` 自动程序的配置页面获取 。 `MicrosoftAppPassword`是之前保存的客户端密码 ID 的值。

        ![Appsettings Json](~/assets/images/adaptive-cards/appsettings-json.png)

    1. 选择“**保存**”。
- title: 在应用程序中配置和上载Teams
  durationInMinutes: 2
  content: >
    测试自动程序最全面的方式是创建应用包并将其上传到Teams。 此方法是在所有范围内测试自动程序可用的完整功能的唯一方法。 可以通过上载文件Teams并运行 **manifest.zip应用程序。**


    **通过上载Teams运行 manifest.zip 应用程序**


    1. 在文件资源管理器中，转到 **Microsoft-Teams-Samples > samples > tab-adaptive-cards > csharp > TabWithAdpativeCardFlow > AppPackage** 以打开文件夹。

    1. 在"**文件"中打开 manifest.json** Visual Studio Code。

    1. 在 **manifest.json** 文件中，查找 **{contentBotId}** 并添加 Microsoft 应用 ID 并保存。

        ![清单配置](~/assets/images/adaptive-cards/manifest-vsc.png)

    1. 在文件资源管理器中，转到 **AppPackage** 文件夹。

    1. Zip the contents of the **AppPackage** folder to create **manifest.zip**.

        > [!NOTE]
        > the **manifest.zip** should not contain any additional folders in it. 它在 zip **文件夹内** 应具有清单json源文件、颜色图标和大纲图标。

    1. 转到Teams。

    1. 若要上传 **manifest.zip，** 请选择"应用商店>**管理应用> Upload自定义应用，****然后打开** manifest.zip。

    1. 选择 **"** 添加"将选项卡添加到聊天中。

        ![应用Teams选项卡](~/assets/images/adaptive-cards/tab-in-teams.png)

        可以通过登录来与此选项卡进行交互。

    1. 向选项卡发送邮件。

        ![桌面移动屏幕截图](~/assets/images/adaptive-cards/desktop-mobile-screenshot.png)
- title: 与选项卡交互Teams
  durationInMinutes: 1
  content: "选项卡允许你访问频道或聊天中专用空间中的服务和内容。\n\n按照以下步骤使用选项卡：\n\n1. 在列表的左窗格中Teams省略号 \"。然后从列表中选择你的应用。\n1. 显示带操作控件的自适应卡片的选项卡。\n\n    ![显示带操作控件的自适应卡片的选项卡](~/assets/images/adaptive-cards/adaptive-cards-tab-action-controls.png)\n\n1. 选择 **\"登录** \"，然后选择一个帐户以访问选项卡。\n\n    ![登录](~/assets/images/adaptive-cards/sign-in-page.png)\n\n1. 选择 **主页上的\"** 显示任务模块\"。\n\n    ![显示任务模块](~/assets/images/adaptive-cards/tab-home-page.png)\n\n1. Tab/fetch 是机器人在用户打开自适应卡片选项卡时收到的第一个调用请求。当机器人收到请求时，它会发送一个选项卡继续响应或一个选项卡身份验证响应。\n\n    ![示例任务模块](~/assets/images/adaptive-cards/sample-task-module.png)\n\n1. **自适应卡片的 Submit 函数** \n   **任务/提交** 请求通过操作触发至具有相应数据的自动程序。 \n\n    ![任务提交卡片](~/assets/images/adaptive-cards/task-submit.png)\n\n1. 除非选择\"注销\"，否则 Tab 将保持 **登录**。\n\n    ![注销](~/assets/images/adaptive-cards/sign-out.png)\n\n1. 刷新以 **再次** 登录。\n\n    ![成功注销](~/assets/images/adaptive-cards/success-sign-out.png)\n"
- title: 完成挑战
  durationInMinutes: 1
  content: >
    你提供类似这样的内容了吗？


    ![桌面移动屏幕截图](~/assets/images/adaptive-cards/desktop-mobile-screenshot.png)
- content: 你已完成本教程，开始使用自动程序框架Microsoft Teams自适应卡片。
