## <a name="add-a-messaging-extension-to-your-app"></a><span data-ttu-id="f0abb-101">向应用添加消息传递扩展</span><span class="sxs-lookup"><span data-stu-id="f0abb-101">Add a messaging extension to your app</span></span>

<span data-ttu-id="f0abb-102">消息传递扩展是一种云托管服务，可侦听用户请求，然后使用结构化数据（如卡片） [做出响应](~/task-modules-and-cards/what-are-cards.md)。</span><span class="sxs-lookup"><span data-stu-id="f0abb-102">A messaging extension is a cloud-hosted service that listens to user requests and responds with structured data, such as a [card](~/task-modules-and-cards/what-are-cards.md).</span></span> <span data-ttu-id="f0abb-103">通过 Bot Framework 对象将服务Microsoft Teams集成在 `Activity` 一起。</span><span class="sxs-lookup"><span data-stu-id="f0abb-103">You integrate your service with Microsoft Teams via Bot Framework `Activity` objects.</span></span> <span data-ttu-id="f0abb-104">Bot Builder SDK 的 Node.js .NET 和扩展可帮助你向应用添加消息传递扩展功能。</span><span class="sxs-lookup"><span data-stu-id="f0abb-104">Our .NET and Node.js extensions for the Bot Builder SDK can help you add messaging extension functionality to your app.</span></span>

![邮件扩展的消息流关系图](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a><span data-ttu-id="f0abb-106">在 Bot Framework 中注册</span><span class="sxs-lookup"><span data-stu-id="f0abb-106">Register in the Bot Framework</span></span>

<span data-ttu-id="f0abb-107">如果尚未注册，必须先向用户注册Microsoft Bot Framework。</span><span class="sxs-lookup"><span data-stu-id="f0abb-107">If you haven’t done so already, you must first register a bot with the Microsoft Bot Framework.</span></span> <span data-ttu-id="f0abb-108">聊天机器人的 Microsoft 应用 ID 和回调终结点（如该终结点所定义）将在邮件扩展中用于接收和响应用户请求。</span><span class="sxs-lookup"><span data-stu-id="f0abb-108">The Microsoft app ID and callback endpoints for your bot, as defined there, will be used in your messaging extension to receive and respond to user requests.</span></span> <span data-ttu-id="f0abb-109">请记住为自动程序Microsoft Teams频道。</span><span class="sxs-lookup"><span data-stu-id="f0abb-109">Remember to enable the Microsoft Teams channel for your bot.</span></span>

<span data-ttu-id="f0abb-110">记录自动程序应用 ID 和应用密码，将需要在应用清单中提供应用 ID。</span><span class="sxs-lookup"><span data-stu-id="f0abb-110">Record your bot app ID and app password, you will need to supply the app ID in your app manifest.</span></span>

### <a name="update-your-app-manifest"></a><span data-ttu-id="f0abb-111">更新应用清单</span><span class="sxs-lookup"><span data-stu-id="f0abb-111">Update your app manifest</span></span>

<span data-ttu-id="f0abb-112">与机器人和选项卡一样，更新 [应用的](~/resources/schema/manifest-schema.md#composeextensions) 清单以包含消息传递扩展属性。</span><span class="sxs-lookup"><span data-stu-id="f0abb-112">As with bots and tabs, you update the [manifest](~/resources/schema/manifest-schema.md#composeextensions) of your app to include the messaging extension properties.</span></span> <span data-ttu-id="f0abb-113">这些属性控制邮件扩展在客户端中的显示Microsoft Teams行为。</span><span class="sxs-lookup"><span data-stu-id="f0abb-113">These properties govern how your messaging extension appears and behaves in the Microsoft Teams client.</span></span> <span data-ttu-id="f0abb-114">从清单的 v1.0 开始，支持消息传递扩展。</span><span class="sxs-lookup"><span data-stu-id="f0abb-114">Messaging extensions are supported beginning with v1.0 of the manifest.</span></span>

#### <a name="declare-your-messaging-extension"></a><span data-ttu-id="f0abb-115">声明邮件扩展</span><span class="sxs-lookup"><span data-stu-id="f0abb-115">Declare your messaging extension</span></span>

<span data-ttu-id="f0abb-116">若要添加邮件扩展，请通过 属性在清单中添加一个新的顶级 JSON `composeExtensions` 结构。</span><span class="sxs-lookup"><span data-stu-id="f0abb-116">To add a messaging extension, include a new top-level JSON structure in your manifest with the `composeExtensions` property.</span></span> <span data-ttu-id="f0abb-117">目前，你只能为应用创建单个邮件扩展。</span><span class="sxs-lookup"><span data-stu-id="f0abb-117">Currently, you are limited to creating a single messaging extension for your app.</span></span>

> [!NOTE]
> <span data-ttu-id="f0abb-118">清单将消息传递扩展引用为 `composeExtensions` 。</span><span class="sxs-lookup"><span data-stu-id="f0abb-118">The manifest refers to messaging extensions as `composeExtensions`.</span></span> <span data-ttu-id="f0abb-119">这是为了维护向后兼容性。</span><span class="sxs-lookup"><span data-stu-id="f0abb-119">This is to maintain backward compatibility.</span></span>

<span data-ttu-id="f0abb-120">扩展定义是具有以下结构的对象：</span><span class="sxs-lookup"><span data-stu-id="f0abb-120">The extension definition is an object that has the following structure:</span></span>

| <span data-ttu-id="f0abb-121">属性名称</span><span class="sxs-lookup"><span data-stu-id="f0abb-121">Property name</span></span> | <span data-ttu-id="f0abb-122">用途</span><span class="sxs-lookup"><span data-stu-id="f0abb-122">Purpose</span></span> | <span data-ttu-id="f0abb-123">是否必需？</span><span class="sxs-lookup"><span data-stu-id="f0abb-123">Required?</span></span> |
|---|---|---|
| `botId` | <span data-ttu-id="f0abb-124">使用 Bot Framework 注册的自动程序的唯一 Microsoft 应用 ID。</span><span class="sxs-lookup"><span data-stu-id="f0abb-124">The unique Microsoft app ID for the bot as registered with the Bot Framework.</span></span> <span data-ttu-id="f0abb-125">这通常应该与整个应用应用的 ID Teams相同。</span><span class="sxs-lookup"><span data-stu-id="f0abb-125">This should typically be the same as the ID for your overall Teams app.</span></span> | <span data-ttu-id="f0abb-126">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-126">Yes</span></span> |
| `scopes` | <span data-ttu-id="f0abb-127">一个数组，用于声明此扩展是可添加到还是可同时添加到或 (`personal` `team` 两) 。</span><span class="sxs-lookup"><span data-stu-id="f0abb-127">Array declaring whether this extension can be added to `personal` or `team` scopes (or both).</span></span> | <span data-ttu-id="f0abb-128">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-128">Yes</span></span> |
| `canUpdateConfiguration` | <span data-ttu-id="f0abb-129">启用 **设置** 菜单项。</span><span class="sxs-lookup"><span data-stu-id="f0abb-129">Enables **Settings** menu item.</span></span> | <span data-ttu-id="f0abb-130">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-130">No</span></span> |
| `commands` | <span data-ttu-id="f0abb-131">此邮件扩展支持的命令数组。</span><span class="sxs-lookup"><span data-stu-id="f0abb-131">Array of commands that this messaging extension supports.</span></span> <span data-ttu-id="f0abb-132">只能使用 10 个命令。</span><span class="sxs-lookup"><span data-stu-id="f0abb-132">You are limited to 10 commands.</span></span> | <span data-ttu-id="f0abb-133">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-133">Yes</span></span> |

#### <a name="define-commands"></a><span data-ttu-id="f0abb-134">定义命令</span><span class="sxs-lookup"><span data-stu-id="f0abb-134">Define commands</span></span>

<span data-ttu-id="f0abb-135">邮件扩展应声明一个命令，当用户从撰写框中的"更多选项" (&#8943;) 选择你的应用时，将显示此命令。</span><span class="sxs-lookup"><span data-stu-id="f0abb-135">Your messaging extension should declare one command, which appears when the user selects your app from the **More options** (**&#8943;**) button in the compose box.</span></span>

![邮件扩展中邮件扩展列表的Teams](~/assets/images/compose-extensions/compose-extension-list.png)

<span data-ttu-id="f0abb-137">在应用清单中，命令项是具有以下结构的对象：</span><span class="sxs-lookup"><span data-stu-id="f0abb-137">In the app manifest, your command item is an object with the following structure:</span></span>

| <span data-ttu-id="f0abb-138">属性名称</span><span class="sxs-lookup"><span data-stu-id="f0abb-138">Property name</span></span> | <span data-ttu-id="f0abb-139">用途</span><span class="sxs-lookup"><span data-stu-id="f0abb-139">Purpose</span></span> | <span data-ttu-id="f0abb-140">是否必需？</span><span class="sxs-lookup"><span data-stu-id="f0abb-140">Required?</span></span> | <span data-ttu-id="f0abb-141">最低清单版本</span><span class="sxs-lookup"><span data-stu-id="f0abb-141">Minimum manifest version</span></span> |
|---|---|---|---|
| `id` | <span data-ttu-id="f0abb-142">分配给此命令的唯一 ID。</span><span class="sxs-lookup"><span data-stu-id="f0abb-142">Unique ID that you assign to this command.</span></span> <span data-ttu-id="f0abb-143">用户请求将包含此 ID。</span><span class="sxs-lookup"><span data-stu-id="f0abb-143">The user request will include this ID.</span></span> | <span data-ttu-id="f0abb-144">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-144">Yes</span></span> | <span data-ttu-id="f0abb-145">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-145">1.0</span></span> |
| `title` | <span data-ttu-id="f0abb-146">命令名称。</span><span class="sxs-lookup"><span data-stu-id="f0abb-146">Command name.</span></span> <span data-ttu-id="f0abb-147">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="f0abb-147">This value appears in the UI.</span></span> | <span data-ttu-id="f0abb-148">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-148">Yes</span></span> | <span data-ttu-id="f0abb-149">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-149">1.0</span></span> |
| `description` | <span data-ttu-id="f0abb-150">指示此命令所执行操作的帮助文本。</span><span class="sxs-lookup"><span data-stu-id="f0abb-150">Help text indicating what this command does.</span></span> <span data-ttu-id="f0abb-151">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="f0abb-151">This value appears in the UI.</span></span> | <span data-ttu-id="f0abb-152">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-152">Yes</span></span> | <span data-ttu-id="f0abb-153">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-153">1.0</span></span> |
| `type` | <span data-ttu-id="f0abb-154">设置命令的类型。</span><span class="sxs-lookup"><span data-stu-id="f0abb-154">Set the type of command.</span></span> <span data-ttu-id="f0abb-155">可取值包括 `query` 和 `action`。</span><span class="sxs-lookup"><span data-stu-id="f0abb-155">Possible values include `query` and `action`.</span></span> <span data-ttu-id="f0abb-156">如果不存在，则默认值设置为 `query` 。</span><span class="sxs-lookup"><span data-stu-id="f0abb-156">If not present the default value is set to `query`.</span></span> | <span data-ttu-id="f0abb-157">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-157">No</span></span> | <span data-ttu-id="f0abb-158">1.4</span><span class="sxs-lookup"><span data-stu-id="f0abb-158">1.4</span></span> |
| `initialRun` | <span data-ttu-id="f0abb-159">可选参数，与命令 `query` 一起使用。</span><span class="sxs-lookup"><span data-stu-id="f0abb-159">Optional parameter, used with `query` commands.</span></span> <span data-ttu-id="f0abb-160">如果设置为 **true**，则指示用户一旦在 UI 中选择此命令，就应执行此命令。</span><span class="sxs-lookup"><span data-stu-id="f0abb-160">If set to **true**, indicates this command should be executed as soon as the user chooses this command in the UI.</span></span> | <span data-ttu-id="f0abb-161">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-161">No</span></span> | <span data-ttu-id="f0abb-162">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-162">1.0</span></span> |
| `fetchTask` | <span data-ttu-id="f0abb-163">可选参数，与命令 `action` 一起使用。</span><span class="sxs-lookup"><span data-stu-id="f0abb-163">Optional parameter, used with `action` commands.</span></span> <span data-ttu-id="f0abb-164">设置为 **true** 可获取要显示在任务模块 中的自适应卡片或 [Web URL。](~/task-modules-and-cards/what-are-task-modules.md)</span><span class="sxs-lookup"><span data-stu-id="f0abb-164">Set to **true** to fetch the adaptive card or web url to display within the [task module](~/task-modules-and-cards/what-are-task-modules.md).</span></span> <span data-ttu-id="f0abb-165">当命令的输入是动态的（而不是静态的参数集） `action` 时，会使用此功能。</span><span class="sxs-lookup"><span data-stu-id="f0abb-165">This is used when the inputs to the `action` command is dynamic as opposed to a static set of parameters.</span></span> <span data-ttu-id="f0abb-166">请注意，如果设置为 **true，** 则忽略命令的静态参数列表。</span><span class="sxs-lookup"><span data-stu-id="f0abb-166">Note that the if set to **true** the static parameter list for the command is ignored.</span></span> | <span data-ttu-id="f0abb-167">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-167">No</span></span> | <span data-ttu-id="f0abb-168">1.4</span><span class="sxs-lookup"><span data-stu-id="f0abb-168">1.4</span></span> |
| `parameters` | <span data-ttu-id="f0abb-169">命令的参数静态列表。</span><span class="sxs-lookup"><span data-stu-id="f0abb-169">Static list of parameters for the command.</span></span> | <span data-ttu-id="f0abb-170">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-170">Yes</span></span> | <span data-ttu-id="f0abb-171">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-171">1.0</span></span> |
| `parameter.name` | <span data-ttu-id="f0abb-172">参数的名称。</span><span class="sxs-lookup"><span data-stu-id="f0abb-172">The name of the parameter.</span></span> <span data-ttu-id="f0abb-173">这将在用户请求中发送到你的服务。</span><span class="sxs-lookup"><span data-stu-id="f0abb-173">This is sent to your service in the user request.</span></span> | <span data-ttu-id="f0abb-174">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-174">Yes</span></span> | <span data-ttu-id="f0abb-175">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-175">1.0</span></span> |
| `parameter.description` | <span data-ttu-id="f0abb-176">描述此参数的用途或应提供的值示例。</span><span class="sxs-lookup"><span data-stu-id="f0abb-176">Describes this parameter’s purposes or example of the value that should be provided.</span></span> <span data-ttu-id="f0abb-177">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="f0abb-177">This value appears in the UI.</span></span> | <span data-ttu-id="f0abb-178">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-178">Yes</span></span> | <span data-ttu-id="f0abb-179">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-179">1.0</span></span> |
| `parameter.title` | <span data-ttu-id="f0abb-180">简短的用户友好参数标题或标签。</span><span class="sxs-lookup"><span data-stu-id="f0abb-180">Short user-friendly parameter title or label.</span></span> | <span data-ttu-id="f0abb-181">是</span><span class="sxs-lookup"><span data-stu-id="f0abb-181">Yes</span></span> | <span data-ttu-id="f0abb-182">1.0</span><span class="sxs-lookup"><span data-stu-id="f0abb-182">1.0</span></span> |
| `parameter.inputType` | <span data-ttu-id="f0abb-183">设置为所需的输入类型。</span><span class="sxs-lookup"><span data-stu-id="f0abb-183">Set to the type of input required.</span></span> <span data-ttu-id="f0abb-184">可能的值包括 `text` `textarea` `number` 、、、、、。 `date` `time` `toggle`</span><span class="sxs-lookup"><span data-stu-id="f0abb-184">Possible values include `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span></span> <span data-ttu-id="f0abb-185">默认值设置为 `text` 。</span><span class="sxs-lookup"><span data-stu-id="f0abb-185">Default is set to `text`.</span></span> | <span data-ttu-id="f0abb-186">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-186">No</span></span> | <span data-ttu-id="f0abb-187">1.4</span><span class="sxs-lookup"><span data-stu-id="f0abb-187">1.4</span></span> |
| `context` | <span data-ttu-id="f0abb-188">用于定义邮件操作可用的上下文的值的可选数组。</span><span class="sxs-lookup"><span data-stu-id="f0abb-188">Optional array of values that defines the context the message action is available in.</span></span> <span data-ttu-id="f0abb-189">可能的值是 `message` 、 `compose` 或 `commandBox` 。</span><span class="sxs-lookup"><span data-stu-id="f0abb-189">Possible values are `message`, `compose`, or `commandBox`.</span></span> <span data-ttu-id="f0abb-190">默认值为“`["compose", "commandBox"]`”。</span><span class="sxs-lookup"><span data-stu-id="f0abb-190">Default is `["compose", "commandBox"]`.</span></span> | <span data-ttu-id="f0abb-191">否</span><span class="sxs-lookup"><span data-stu-id="f0abb-191">No</span></span> | <span data-ttu-id="f0abb-192">1.5</span><span class="sxs-lookup"><span data-stu-id="f0abb-192">1.5</span></span> |
