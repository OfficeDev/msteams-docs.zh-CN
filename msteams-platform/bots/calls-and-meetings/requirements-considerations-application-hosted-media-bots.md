---
title: 应用程序托管的媒体机器人的要求和注意事项
description: 了解与为 Microsoft Teams 创建应用程序托管的媒体机器人相关的重要要求和注意事项。
ms.topic: conceptual
keywords: 应用程序托管的媒体 Windows 服务器 azure vm
ms.date: 11/16/2018
ms.openlocfilehash: bf75b7f689713f16cb3ff9ff4313ab829b5cc2d6
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014486"
---
# <a name="requirements-and-considerations-for-application-hosted-media-bots"></a><span data-ttu-id="1fad9-104">应用程序托管的媒体机器人的要求和注意事项</span><span class="sxs-lookup"><span data-stu-id="1fad9-104">Requirements and considerations for application-hosted media bots</span></span>

<span data-ttu-id="1fad9-105">并非所有有关在 IVR 中开发消息传递和互动语音响应 (指南) 构建应用程序托管的媒体机器人同样适用。</span><span class="sxs-lookup"><span data-stu-id="1fad9-105">Not all guidance for developing messaging and Interactive Voice Response (IVR) bots applies equally to building application-hosted media bots.</span></span> <span data-ttu-id="1fad9-106">本文介绍开发并运行应用程序托管的媒体机器人的一些重要要求和注意事项。</span><span class="sxs-lookup"><span data-stu-id="1fad9-106">This article describes some of the important requirements and considerations for developing and running an application-hosted media bot.</span></span>

> [!NOTE]
> <span data-ttu-id="1fad9-107">由于适用于机器人的 Microsoft 实时媒体平台位于开发人员预览版中，因此本文中的指南可能会更改。</span><span class="sxs-lookup"><span data-stu-id="1fad9-107">Because the Microsoft Real-time Media Platform for Bots is in developer preview, the guidance in this article is subject to change.</span></span>

## <a name="application-hosted-media-bot-development-requires-cnet-and-windows-server"></a><span data-ttu-id="1fad9-108">应用程序托管的媒体机器人开发需要 C#/.NET 和 Windows Server</span><span class="sxs-lookup"><span data-stu-id="1fad9-108">Application-hosted media bot development requires C#/.NET and Windows Server</span></span>

- <span data-ttu-id="1fad9-109">应用程序托管的媒体自动程序需要此处提供的 .NET 库 (来访问音频和视频媒体流，并且必须在 Windows Server 计算机 (或 Azure) 中的 Windows Server 来宾操作系统上部署机器人。 `Microsoft.Graph.Communications.Calls.Media` [](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)</span><span class="sxs-lookup"><span data-stu-id="1fad9-109">An application-hosted media bot requires the `Microsoft.Graph.Communications.Calls.Media` .NET library ([available here](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) to access the audio and video media streams, and the bot must be deployed on a Windows Server machine (or Windows Server guest OS in Azure).</span></span> <span data-ttu-id="1fad9-110">因此，必须在 C# 和标准 .NET Framework 中开发自动程序，并部署在 Microsoft Azure 中。</span><span class="sxs-lookup"><span data-stu-id="1fad9-110">Therefore, the bot must be developed in C# and the standard .NET Framework and deployed in Microsoft Azure.</span></span> <span data-ttu-id="1fad9-111">你不能使用 C++ 或 Node.js API 访问实时媒体，应用程序托管的媒体自动程序不支持 .NET Core。</span><span class="sxs-lookup"><span data-stu-id="1fad9-111">You can't use C++ or Node.js APIs to access real-time media and .NET Core is not supported for an application-hosted media bot.</span></span>

- <span data-ttu-id="1fad9-112">应用程序托管的媒体自动程序可以托管在下列 Azure 服务环境之一中：</span><span class="sxs-lookup"><span data-stu-id="1fad9-112">An application-hosted media bot can be hosted within one of the following Azure service environments:</span></span>
  - <span data-ttu-id="1fad9-113">云服务。</span><span class="sxs-lookup"><span data-stu-id="1fad9-113">Cloud Service.</span></span>
  - <span data-ttu-id="1fad9-114">具有虚拟机缩放集的 Service Fabric (VMSS) 。</span><span class="sxs-lookup"><span data-stu-id="1fad9-114">Service Fabric with Virtual Machine Scale Sets (VMSS).</span></span>
  - <span data-ttu-id="1fad9-115">IaaS (服务基础结构) 虚拟机 (VM) 。</span><span class="sxs-lookup"><span data-stu-id="1fad9-115">Infrastructure as a Service (IaaS) Virtual Machine (VM).</span></span>  
  
- <span data-ttu-id="1fad9-116">应用程序托管的媒体机器人无法部署为 Azure Web App。</span><span class="sxs-lookup"><span data-stu-id="1fad9-116">An application-hosted media bot can't be deployed as an Azure Web App.</span></span>

- <span data-ttu-id="1fad9-117">应用程序托管的媒体自动程序必须在 .NET 库的 `Microsoft.Graph.Communications.Calls.Media` 最新版本上运行。</span><span class="sxs-lookup"><span data-stu-id="1fad9-117">An application-hosted media bot must be running on a recent version of the `Microsoft.Graph.Communications.Calls.Media` .NET library.</span></span> <span data-ttu-id="1fad9-118">机器人应该使用 [NuGet](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)程序包的最新版本或不超过三个月的版本。</span><span class="sxs-lookup"><span data-stu-id="1fad9-118">The bot should use either the newest available version of the [NuGet package](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/), or a version that is not more than three months old.</span></span> <span data-ttu-id="1fad9-119">较旧版本的库将被弃用，在几个月后可能不起作用。</span><span class="sxs-lookup"><span data-stu-id="1fad9-119">Older versions of the library will be deprecated and may not work after a few months.</span></span> <span data-ttu-id="1fad9-120">使库保持最新将确保自动程序与 Microsoft Teams 之间的最佳 `Microsoft.Graph.Communications.Calls.Media` 互操作性。</span><span class="sxs-lookup"><span data-stu-id="1fad9-120">Keeping the `Microsoft.Graph.Communications.Calls.Media` library up-to-date will ensure the best interoperability between the bot and Microsoft Teams.</span></span>

## <a name="real-time-media-calls-stay-on-the-machine-where-they-were-created"></a><span data-ttu-id="1fad9-121">实时媒体呼叫将停留在创建它们时所位于的计算机上</span><span class="sxs-lookup"><span data-stu-id="1fad9-121">Real-time media calls stay on the machine where they were created</span></span>

- <span data-ttu-id="1fad9-122">实时媒体呼叫将固定到接受或 (虚拟机) 虚拟机实例。</span><span class="sxs-lookup"><span data-stu-id="1fad9-122">A real-time media call is pinned to the virtual machine (VM) instance that accepted or started the call.</span></span> <span data-ttu-id="1fad9-123">来自 Microsoft Teams 呼叫或会议媒体将流动到该 VM 实例，机器人发送回 Microsoft Teams 的媒体也必须源自该 VM。</span><span class="sxs-lookup"><span data-stu-id="1fad9-123">Media from a Microsoft Teams call or meeting will flow to that VM instance, and media the bot sends back to Microsoft Teams must also originate from that VM.</span></span>
- <span data-ttu-id="1fad9-124">如果 VM 停止时正在进行任何实时媒体呼叫，则这些调用将突然终止。</span><span class="sxs-lookup"><span data-stu-id="1fad9-124">If there are any real-time media calls in progress when the VM is stopped, those calls will be abruptly terminated.</span></span> <span data-ttu-id="1fad9-125">如果机器人事先知道挂起的虚拟机关闭，可以尝试"正常"结束调用。</span><span class="sxs-lookup"><span data-stu-id="1fad9-125">If the bot has prior knowledge of the pending VM shutdown, it can try to "gracefully" end the calls.</span></span>

## <a name="application-hosted-media-bots-must-be-directly-accessible-on-the-internet"></a><span data-ttu-id="1fad9-126">应用程序托管的媒体机器人必须在 Internet 上直接访问</span><span class="sxs-lookup"><span data-stu-id="1fad9-126">Application-hosted media bots must be directly accessible on the internet</span></span>

- <span data-ttu-id="1fad9-127">在 Azure 中托管应用程序托管的媒体自动程序的每个 VM 实例都必须使用 ILPIP (实例级公用 IP 地址直接从 internet 访问) 。</span><span class="sxs-lookup"><span data-stu-id="1fad9-127">Each VM instance hosting an application-hosted media bot in Azure must be directly accessible from the internet using an instance-level public IP address (ILPIP).</span></span>
  - <span data-ttu-id="1fad9-128">有关获取和配置 Azure 云服务的 ILPIP 的信息，请参阅"实例级别公共 IP ([经典) 概述](/azure/virtual-network/virtual-networks-instance-level-public-ip)。</span><span class="sxs-lookup"><span data-stu-id="1fad9-128">For obtaining and configuring an ILPIP for an Azure Cloud Service, see [Instance level public IP (Classic) overview](/azure/virtual-network/virtual-networks-instance-level-public-ip).</span></span>
  - <span data-ttu-id="1fad9-129">有关为 VM 规模集配置 ILPIP，请参阅每个虚拟机[的公用 IPv4。](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine)</span><span class="sxs-lookup"><span data-stu-id="1fad9-129">For configuring an ILPIP for a VM Scale Set, see [Public IPv4 per virtual machine](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine).</span></span>
- <span data-ttu-id="1fad9-130">承载应用程序托管的媒体自动程序的服务还必须使用映射到特定实例的面向公众的端口配置每个 VM 实例。</span><span class="sxs-lookup"><span data-stu-id="1fad9-130">The service hosting an application-hosted media bot must also configure each VM instance with a public-facing port which maps to the specific instance.</span></span>
  - <span data-ttu-id="1fad9-131">对于 Azure 云服务，这需要实例输入终结点;请参阅 [在 Azure 中启用角色实例的通信](/azure/cloud-services/cloud-services-enable-communication-role-instances)。</span><span class="sxs-lookup"><span data-stu-id="1fad9-131">For an Azure Cloud Service, this requires an instance input endpoint; see [Enable communication for role instances in Azure](/azure/cloud-services/cloud-services-enable-communication-role-instances).</span></span>
  - <span data-ttu-id="1fad9-132">对于 VM 规模集，必须配置负载平衡器上的 NAT 规则;请参阅 [Azure 中的虚拟网络和虚拟机](/azure/virtual-machines/windows/network-overview)。</span><span class="sxs-lookup"><span data-stu-id="1fad9-132">For a VM Scale Set, a NAT rule on the load balancer must be configured; see [Virtual networks and virtual machines in Azure](/azure/virtual-machines/windows/network-overview).</span></span>
- <span data-ttu-id="1fad9-133">自动程序框架仿真器不支持应用程序托管的媒体机器人。</span><span class="sxs-lookup"><span data-stu-id="1fad9-133">Application-hosted media bots aren't supported by the Bot Framework Emulator.</span></span>

## <a name="scalability-and-performance-considerations"></a><span data-ttu-id="1fad9-134">可伸缩性和性能注意事项</span><span class="sxs-lookup"><span data-stu-id="1fad9-134">Scalability and performance considerations</span></span>

- <span data-ttu-id="1fad9-135">应用程序托管的媒体自动程序需要比 (机器人) 更多的计算和网络带宽，并且可能会产生更高的运营成本。</span><span class="sxs-lookup"><span data-stu-id="1fad9-135">Application-hosted media bots require more compute and network (bandwidth) capacity than messaging bots and may incur significantly higher operational costs.</span></span> <span data-ttu-id="1fad9-136">实时媒体自动程序开发人员必须仔细衡量机器人的可伸缩性，并确保机器人不接受多于它可以管理的并发呼叫数。</span><span class="sxs-lookup"><span data-stu-id="1fad9-136">A real-time media bot developer must carefully measure the bot's scalability, and ensure the bot doesn't accept more simultaneous calls than it can manage.</span></span> <span data-ttu-id="1fad9-137">如果使用"原始"RGB24 或 NV12 视频格式 (则启用视频的机器人只能维持每个 CPU 内核的一个或两个并发媒体) 。</span><span class="sxs-lookup"><span data-stu-id="1fad9-137">A video-enabled bot may be able to sustain only one or two concurrent media sessions per CPU core (if using the "raw" RGB24 or NV12 video formats).</span></span>
- <span data-ttu-id="1fad9-138">实时媒体平台当前不会利用 VM 上提供的任何图形处理单元 (GPU) 来对 H.264 视频编码/解码进行负载外加载。</span><span class="sxs-lookup"><span data-stu-id="1fad9-138">The Real-time Media Platform doesn't currently take advantage of any Graphics Processing Units (GPU) available on the VM to off-load H.264 video encoding/decoding.</span></span> <span data-ttu-id="1fad9-139">相反，视频编码和解码在 CPU 上的软件中完成。</span><span class="sxs-lookup"><span data-stu-id="1fad9-139">Instead, video encode and decode are done in software on the CPU.</span></span> <span data-ttu-id="1fad9-140">如果 GPU 可用，机器人可以利用它来呈现自己的图形 (例如，如果机器人使用 3D 图形引擎) 。</span><span class="sxs-lookup"><span data-stu-id="1fad9-140">If a GPU is available, the bot may take advantage of it for its own graphics rendering (e.g. if the bot is using a 3D graphics engine).</span></span>
- <span data-ttu-id="1fad9-141">托管实时媒体自动程序的 VM 实例必须至少具有 2 个 CPU 内核。</span><span class="sxs-lookup"><span data-stu-id="1fad9-141">The VM instance hosting the real-time media bot must have at least 2 CPU cores.</span></span> <span data-ttu-id="1fad9-142">对于 Azure，建议使用 Dv2 系列虚拟机。</span><span class="sxs-lookup"><span data-stu-id="1fad9-142">For Azure, a Dv2-series virtual machine is recommended.</span></span> <span data-ttu-id="1fad9-143">对于其他 Azure VM 类型，具有 4 个虚拟 CPU (vCPU) 是最低大小所需的。</span><span class="sxs-lookup"><span data-stu-id="1fad9-143">For other Azure VM types, a system with 4 virtual CPUs (vCPU) is the minimum size required.</span></span> <span data-ttu-id="1fad9-144">Azure 文档中提供了有关 Azure VM 类型 [的详细信息](/azure/virtual-machines/windows/sizes-general)。</span><span class="sxs-lookup"><span data-stu-id="1fad9-144">Detailed information about Azure VM types is available in the [Azure documentation](/azure/virtual-machines/windows/sizes-general).</span></span>

## <a name="samples-and-additional-resources"></a><span data-ttu-id="1fad9-145">示例和其他资源</span><span class="sxs-lookup"><span data-stu-id="1fad9-145">Samples and Additional Resources</span></span>

- [<span data-ttu-id="1fad9-146">示例应用程序</span><span class="sxs-lookup"><span data-stu-id="1fad9-146">Sample applications</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples)
- [<span data-ttu-id="1fad9-147">Graph 调用 SDK 文档</span><span class="sxs-lookup"><span data-stu-id="1fad9-147">Graph Calling SDK Documentation</span></span>](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)
