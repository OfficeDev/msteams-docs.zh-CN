---
title: 为 Microsoft 团队注册呼叫和会议机器人
description: 了解如何为 Microsoft 团队注册新的音频/视频呼叫机器人
keywords: 呼叫机器人音频/视频音频视频媒体
ms.openlocfilehash: 4db6c29352aa117e0dd1959826d0560359864d8a
ms.sourcegitcommit: 1aa0b172931d0f81db346452788c41dc4a6717b9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/22/2020
ms.locfileid: "48209751"
---
# <a name="register-a-calling-bot-for-microsoft-teams"></a><span data-ttu-id="b600f-104">为 Microsoft 团队注册呼叫机器人</span><span class="sxs-lookup"><span data-stu-id="b600f-104">Register a calling bot for Microsoft Teams</span></span>

<span data-ttu-id="b600f-105">参与音频/视频呼叫和联机会议的 bot 是一个普通的 Microsoft 团队 bot，其中包含几个额外的功能：</span><span class="sxs-lookup"><span data-stu-id="b600f-105">A bot that participates in audio/video calls and online meetings is an ordinary Microsoft Teams bot with a few extra features:</span></span>

* <span data-ttu-id="b600f-106">有一个新版本的团队应用程序清单，其中有两个附加设置， `supportsCalling` 和 `supportsVideo` 。</span><span class="sxs-lookup"><span data-stu-id="b600f-106">There's a new version of the Teams app manifest with two additional settings, `supportsCalling` and `supportsVideo`.</span></span> <span data-ttu-id="b600f-107">这些设置包括在 Microsoft 团队应用程序清单的 [开发人员预览](../../resources/dev-preview/developer-preview-intro.md) 版本中。</span><span class="sxs-lookup"><span data-stu-id="b600f-107">These settings are included in the [Developer Preview](../../resources/dev-preview/developer-preview-intro.md) version of the Microsoft Teams app manifest.</span></span>
* <span data-ttu-id="b600f-108">必须为你的 bot 的 Microsoft 应用 ID 配置[Microsoft Graph 权限](./registering-calling-bot.md#add-microsoft-graph-permissions)。</span><span class="sxs-lookup"><span data-stu-id="b600f-108">[Microsoft Graph permissions](./registering-calling-bot.md#add-microsoft-graph-permissions) must be configured for your bot's Microsoft App ID.</span></span>
* <span data-ttu-id="b600f-109">Microsoft Graph 呼叫和联机会议 Api 权限需要租户管理员同意。</span><span class="sxs-lookup"><span data-stu-id="b600f-109">The Microsoft Graph calls and online meetings APIs permissions require tenant admin consent.</span></span>

<span data-ttu-id="b600f-110">让我们更详细地讨论上面的内容。</span><span class="sxs-lookup"><span data-stu-id="b600f-110">Let's discuss the above in more detail.</span></span>

## <a name="new-manifest-settings"></a><span data-ttu-id="b600f-111">新清单设置</span><span class="sxs-lookup"><span data-stu-id="b600f-111">New manifest settings</span></span>

<span data-ttu-id="b600f-112">呼叫和联机会议 bot 的 manifest.js中有两个其他设置，可在团队中为你的 bot 启用音频/视频。</span><span class="sxs-lookup"><span data-stu-id="b600f-112">Calling and online meetings bots have two additional settings in the manifest.json that enable audio/video for your bot in Teams.</span></span>

* <span data-ttu-id="b600f-113">`bots[0].supportsCalling`.</span><span class="sxs-lookup"><span data-stu-id="b600f-113">`bots[0].supportsCalling`.</span></span> <span data-ttu-id="b600f-114">如果存在并设置为 `true` ，则团队将允许你的 bot 参与呼叫和联机会议。</span><span class="sxs-lookup"><span data-stu-id="b600f-114">If present and set to `true`, Teams will allow your bot to participate in calls and online meetings.</span></span>
* <span data-ttu-id="b600f-115">`bots[0].supportsVideo`.</span><span class="sxs-lookup"><span data-stu-id="b600f-115">`bots[0].supportsVideo`.</span></span> <span data-ttu-id="b600f-116">如果存在并设置为 `true` ，则团队会意识到你的 bot 支持视频。</span><span class="sxs-lookup"><span data-stu-id="b600f-116">If present and set to `true`, Teams knows that your bot supports video.</span></span>

<span data-ttu-id="b600f-117">如果您希望 IDE 正确验证这些值的通话和会议机器人架构上的 manifest.js，可以更改 `$schema` 属性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="b600f-117">If you want your IDE to properly validate the manifest.json schema for your calling and meeting bot for these values, you can change the `$schema` attribute as follows:</span></span>

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

## <a name="creating-a-new-bot-or-adding-calling-capabilities-to-an-existing-bot"></a><span data-ttu-id="b600f-118">创建新的 bot 或向现有 bot 添加呼叫功能</span><span class="sxs-lookup"><span data-stu-id="b600f-118">Creating a new bot or adding calling capabilities to an existing bot</span></span>

<span data-ttu-id="b600f-119">在 " [创建 Microsoft 团队的 bot](../how-to/create-a-bot-for-teams.md) " 主题中将更详细地介绍了如何创建新的 bot，但我们将在此处重复执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="b600f-119">Creating a new bot is covered in more detail in the [Create a bot for Microsoft Teams](../how-to/create-a-bot-for-teams.md) topic, but we'll repeat some of it here:</span></span>

1. <span data-ttu-id="b600f-120">使用此链接可创建新的 bot： `https://dev.botframework.com/bots/new` 。</span><span class="sxs-lookup"><span data-stu-id="b600f-120">Use this link to create a new bot: `https://dev.botframework.com/bots/new`.</span></span> <span data-ttu-id="b600f-121">如果改为在 Bot 框架门户中选择 " *创建机器人* " 按钮，则会在 Microsoft Azure 中创建你需要 Azure 帐户的你的 bot。</span><span class="sxs-lookup"><span data-stu-id="b600f-121">If, instead,  you select the *Create a bot* button in the Bot Framework portal, you will create your bot in Microsoft Azure, for which you'll need an Azure account.</span></span>
1. <span data-ttu-id="b600f-122">添加 Microsoft 团队频道。</span><span class="sxs-lookup"><span data-stu-id="b600f-122">Add the Microsoft Teams channel.</span></span> <span data-ttu-id="b600f-123">单击 "Microsoft 团队频道" 页面上的 "通话" 选项卡，然后选择 " **启用呼叫**"，然后使用你将接收传入通知的 HTTPS URL 更新 \*\*Webhook () \*\* （例如， `https://contoso.com/teamsapp/api/calling` ）。</span><span class="sxs-lookup"><span data-stu-id="b600f-123">Click on the "Calling" tab on the Microsoft Teams channel page and select **Enable calling**, and then update **Webhook (for calling)** with your HTTPS URL where you will receive incoming notifications, e.g.`https://contoso.com/teamsapp/api/calling`.</span></span> <span data-ttu-id="b600f-124">有关如何配置频道的详细信息，请参阅 [配置频道](/bot-framework/portal-configure-channels) 。</span><span class="sxs-lookup"><span data-stu-id="b600f-124">Refer to [Configuring Channels](/bot-framework/portal-configure-channels) for more information on how to configure channels.</span></span>
  <span data-ttu-id="b600f-125">![配置 Microsoft 团队频道信息](~/assets/images/calls-and-meetings/configure-msteams-channel.png)</span><span class="sxs-lookup"><span data-stu-id="b600f-125">![Configure Microsoft Teams channel information](~/assets/images/calls-and-meetings/configure-msteams-channel.png)</span></span>

## <a name="add-microsoft-graph-permissions"></a><span data-ttu-id="b600f-126">添加 Microsoft Graph 权限</span><span class="sxs-lookup"><span data-stu-id="b600f-126">Add Microsoft Graph permissions</span></span>

<span data-ttu-id="b600f-127">Microsoft Graph 公开了控制应用程序对资源的访问权限的精细权限。</span><span class="sxs-lookup"><span data-stu-id="b600f-127">Microsoft Graph exposes granular permissions controlling the access that apps have to resources.</span></span> <span data-ttu-id="b600f-128">作为开发人员，你可以决定应用请求哪些 Microsoft Graph 权限。</span><span class="sxs-lookup"><span data-stu-id="b600f-128">As a developer, you decide which permissions for Microsoft Graph your app requests.</span></span>  <span data-ttu-id="b600f-129">Microsoft Graph 调用 Api 支持 _应用程序权限_，这些权限由在没有登录用户的情况下运行的应用程序使用。</span><span class="sxs-lookup"><span data-stu-id="b600f-129">The Microsoft Graph Calling APIs support _Application permissions_, which are used by apps that run without a signed-in user present.</span></span>  <span data-ttu-id="b600f-130">租户管理员必须授予应用程序权限许可。</span><span class="sxs-lookup"><span data-stu-id="b600f-130">A tenant administrator must grant consent to application permissions.</span></span> <span data-ttu-id="b600f-131">以下是这些权限的列表：</span><span class="sxs-lookup"><span data-stu-id="b600f-131">Below is a list of those permissions:</span></span>

### <a name="application-permissions-calls"></a><span data-ttu-id="b600f-132">应用程序权限：调用</span><span class="sxs-lookup"><span data-stu-id="b600f-132">Application permissions: calls</span></span>

|<span data-ttu-id="b600f-133">权限</span><span class="sxs-lookup"><span data-stu-id="b600f-133">Permission</span></span>    |<span data-ttu-id="b600f-134">显示字符串</span><span class="sxs-lookup"><span data-stu-id="b600f-134">Display String</span></span>   |<span data-ttu-id="b600f-135">说明</span><span class="sxs-lookup"><span data-stu-id="b600f-135">Description</span></span> |<span data-ttu-id="b600f-136">需经过管理员同意</span><span class="sxs-lookup"><span data-stu-id="b600f-136">Admin Consent Required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|<span data-ttu-id="b600f-137">_Calls.Initiate.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-137">_Calls.Initiate.All_</span></span>|<span data-ttu-id="b600f-138">从应用发起一对一拨出通话（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-138">Initiate outgoing 1:1 calls from the app (preview)</span></span>|<span data-ttu-id="b600f-139">允许应用在没有登录用户的情况下，向单个用户发起播出通话并将通话转接到组织目录中的用户。</span><span class="sxs-lookup"><span data-stu-id="b600f-139">Allows the app to place outbound calls to a single user and transfer calls to users in your organization’s directory, without a signed-in user.</span></span>|<span data-ttu-id="b600f-140">是</span><span class="sxs-lookup"><span data-stu-id="b600f-140">Yes</span></span>|
|<span data-ttu-id="b600f-141">_Calls.InitiateGroupCall.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-141">_Calls.InitiateGroupCall.All_</span></span>|<span data-ttu-id="b600f-142">从应用发起组拨出通话（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-142">Initiate outgoing group calls from the app (preview)</span></span>|<span data-ttu-id="b600f-143">允许应用在没有登录用户的情况下，向多个用户发起播出通话并向组织中的会议添加参与者。</span><span class="sxs-lookup"><span data-stu-id="b600f-143">Allows the app to place outbound calls to multiple users and add participants to meetings in your organization, without a signed-in user.</span></span>|<span data-ttu-id="b600f-144">是</span><span class="sxs-lookup"><span data-stu-id="b600f-144">Yes</span></span>|
|<span data-ttu-id="b600f-145">_Calls.JoinGroupCall.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-145">_Calls.JoinGroupCall.All_</span></span>|<span data-ttu-id="b600f-146">作为应用加入组通话和会议（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-146">Join Group Calls and Meetings as an app (preview)</span></span>|<span data-ttu-id="b600f-147">允许应用在没有登录用户的情况下，加入组织中的组通话和计划会议。</span><span class="sxs-lookup"><span data-stu-id="b600f-147">Allows the app to join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="b600f-148">应用将加入到租户的会议中并获得目录用户特权。</span><span class="sxs-lookup"><span data-stu-id="b600f-148">The app will be joined with the privileges of a directory user to meetings in your tenant.</span></span>|<span data-ttu-id="b600f-149">是</span><span class="sxs-lookup"><span data-stu-id="b600f-149">Yes</span></span>|
|<span data-ttu-id="b600f-150">_Calls.JoinGroupCallasGuest.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-150">_Calls.JoinGroupCallasGuest.All_</span></span>|<span data-ttu-id="b600f-151">作为来宾加入组通话和会议（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-151">Join Group Calls and Meetings as a guest (preview)</span></span>|<span data-ttu-id="b600f-152">允许应用在没有登录用户的情况下，以匿名方式加入组织中的组通话和计划会议。</span><span class="sxs-lookup"><span data-stu-id="b600f-152">Allows the app to anonymously join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="b600f-153">应用将作为来宾加入租户的会议。</span><span class="sxs-lookup"><span data-stu-id="b600f-153">The app will be joined as a guest to meetings in your tenant.</span></span>|<span data-ttu-id="b600f-154">是</span><span class="sxs-lookup"><span data-stu-id="b600f-154">Yes</span></span>|
|<span data-ttu-id="b600f-155">_AccessMedia。_ <sup>_请参阅下面_的</sup></span><span class="sxs-lookup"><span data-stu-id="b600f-155">_Calls.AccessMedia.All_ <sup>_see below_</sup></span></span>|<span data-ttu-id="b600f-156">作为应用访问通话中的媒体数据流（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-156">Access media streams in a call as an app (preview)</span></span>|<span data-ttu-id="b600f-157">允许应用在没有登录用户的情况下，直接访问通话中的媒体数据流。</span><span class="sxs-lookup"><span data-stu-id="b600f-157">Allows the app to get direct access to media streams in a call, without a signed-in user.</span></span>|<span data-ttu-id="b600f-158">是</span><span class="sxs-lookup"><span data-stu-id="b600f-158">Yes</span></span>|

> [!IMPORTANT]
> <span data-ttu-id="b600f-159">您 **不能** 使用 Microsoft. Media API 来记录或以其他方式保留你的 bot 访问的呼叫或会议中的媒体内容。</span><span class="sxs-lookup"><span data-stu-id="b600f-159">You **cannot** use the Microsoft.Graph.Calls.Media API to record or otherwise persist media content from calls or meetings that your bot accesses.</span></span>

### <a name="application-permissions-online-meetings"></a><span data-ttu-id="b600f-160">应用程序权限：联机会议</span><span class="sxs-lookup"><span data-stu-id="b600f-160">Application permissions: online meetings</span></span>

|<span data-ttu-id="b600f-161">权限</span><span class="sxs-lookup"><span data-stu-id="b600f-161">Permission</span></span>    |<span data-ttu-id="b600f-162">显示字符串</span><span class="sxs-lookup"><span data-stu-id="b600f-162">Display String</span></span>   |<span data-ttu-id="b600f-163">说明</span><span class="sxs-lookup"><span data-stu-id="b600f-163">Description</span></span> |<span data-ttu-id="b600f-164">需经过管理员同意</span><span class="sxs-lookup"><span data-stu-id="b600f-164">Admin Consent Required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|<span data-ttu-id="b600f-165">_OnlineMeetings.Read.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-165">_OnlineMeetings.Read.All_</span></span>|<span data-ttu-id="b600f-166">从应用阅读联机会议详细信息（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-166">Read Online Meeting details from the app (preview)</span></span>|<span data-ttu-id="b600f-167">允许应用在没有登录用户的情况下读取组织中的联机会议详细信息。</span><span class="sxs-lookup"><span data-stu-id="b600f-167">Allows the app to read Online Meeting details in your organization, without a signed-in user.</span></span>|<span data-ttu-id="b600f-168">是</span><span class="sxs-lookup"><span data-stu-id="b600f-168">Yes</span></span>|
|<span data-ttu-id="b600f-169">_OnlineMeetings.ReadWrite.All_</span><span class="sxs-lookup"><span data-stu-id="b600f-169">_OnlineMeetings.ReadWrite.All_</span></span>|<span data-ttu-id="b600f-170">代表用户从应用读取和创建联机会议（预览版）</span><span class="sxs-lookup"><span data-stu-id="b600f-170">Read and Create Online Meetings from the app (preview) on behalf of a user</span></span>|<span data-ttu-id="b600f-171">允许应用在没有登录用户的情况下代表用户创建组织中的联机会议。</span><span class="sxs-lookup"><span data-stu-id="b600f-171">Allows the app to create Online Meetings in your organization on behalf of a user, without a signed-in user.</span></span>|<span data-ttu-id="b600f-172">是</span><span class="sxs-lookup"><span data-stu-id="b600f-172">Yes</span></span>|

### <a name="assigning-permissions"></a><span data-ttu-id="b600f-173">分配权限</span><span class="sxs-lookup"><span data-stu-id="b600f-173">Assigning permissions</span></span>

<span data-ttu-id="b600f-174">你必须提前为你的 bot 配置应用程序权限。</span><span class="sxs-lookup"><span data-stu-id="b600f-174">You must configure the application permissions for your bot in advance.</span></span> <span data-ttu-id="b600f-175">我们建议使用[Microsoft 应用注册门户](https://apps.dev.microsoft.com/) [，如下所述，](/graph/auth_register_app_v2)因为它是配置机器人的地方;但是，如果您更喜欢使用[AZURE AD V1 终结点](/azure/active-directory/develop/azure-ad-endpoint-comparison)，仍可以使用[azure 门户](https://aka.ms/aadapplist)。</span><span class="sxs-lookup"><span data-stu-id="b600f-175">We recommend using the [Microsoft App Registration Portal](https://apps.dev.microsoft.com/) as described [here](/graph/auth_register_app_v2) because that's where your bot was configured; however, you can still use the [Azure portal](https://aka.ms/aadapplist) if you prefer to use the [Azure AD V1 endpoint](/azure/active-directory/develop/azure-ad-endpoint-comparison).</span></span>

### <a name="getting-tenant-administrator-consent"></a><span data-ttu-id="b600f-176">获取租户管理员同意</span><span class="sxs-lookup"><span data-stu-id="b600f-176">Getting tenant administrator consent</span></span>

<span data-ttu-id="b600f-177">对于使用 Azure AD V1 终结点的应用程序，租户管理员可以在其组织中安装应用程序时同意使用 [Azure 门户](https://portal.azure.com) 的应用程序权限，也可以在您的应用程序中提供注册权限，管理员可通过该体验来同意您配置的权限。</span><span class="sxs-lookup"><span data-stu-id="b600f-177">For apps using the Azure AD V1 endpoint, a tenant administrator can consent to the application permissions using the [Azure portal](https://portal.azure.com) when your app is installed in their organization, or you can provide a sign-up experience in your app through which administrators can consent to the permissions you configured.</span></span> <span data-ttu-id="b600f-178">在 Azure AD 中记录管理员同意后，您的应用程序可以请求令牌，而无需再次请求许可。</span><span class="sxs-lookup"><span data-stu-id="b600f-178">Once administrator consent is recorded by Azure AD, your app can request tokens without having to request consent again.</span></span>

<span data-ttu-id="b600f-179">你可以依靠管理员授予你的应用程序在 [Azure 门户](https://portal.azure.com)上所需的权限;不过，通常情况下，更好的选择是使用 Azure AD V2 终结点为管理员提供注册体验 `/adminconsent` 。</span><span class="sxs-lookup"><span data-stu-id="b600f-179">You can rely on an administrator to grant the permissions your app needs at the [Azure portal](https://portal.azure.com); though, often a better option is to provide a sign-up experience for administrators by using the Azure AD V2 `/adminconsent` endpoint.</span></span>  <span data-ttu-id="b600f-180">有关详细信息，请参阅 [构建管理员同意 URL 的说明](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent) 。</span><span class="sxs-lookup"><span data-stu-id="b600f-180">Please refer to the [instructions on constructing an Admin Consent URL](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent) for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="b600f-181">构造租户管理员同意 URL 需要在 [应用注册门户](https://apps.dev.microsoft.com/)中配置的重定向 URI/回复 url。</span><span class="sxs-lookup"><span data-stu-id="b600f-181">Constructing the Tenant Admin Consent URL requires a configured Redirect URI/Reply URL in the [App Registration Portal](https://apps.dev.microsoft.com/).</span></span> <span data-ttu-id="b600f-182">若要为你的 bot 添加回复 Url，请访问你的 bot 注册，选择 "高级选项-> 编辑应用程序清单"。</span><span class="sxs-lookup"><span data-stu-id="b600f-182">To add reply URLs for your bot, access your bot registration, choose Advanced Options -> Edit Application Manifest.</span></span>  <span data-ttu-id="b600f-183">将重定向 URL 添加到 `replyUrls` 集合中。</span><span class="sxs-lookup"><span data-stu-id="b600f-183">Add your Redirect URL to the `replyUrls` collection.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b600f-184">无论何时对应用程序的权限进行更改，还必须重复管理员同意过程。</span><span class="sxs-lookup"><span data-stu-id="b600f-184">Anytime you make a change to your application's permissions, you must also repeat the Admin Consent process.</span></span> <span data-ttu-id="b600f-185">租户管理员重新应用同意之后，才会反映应用注册门户中所做的更改。</span><span class="sxs-lookup"><span data-stu-id="b600f-185">Changes made in the app registration portal will not be reflected until consent has been reapplied by the tenant's administrator.</span></span>
