---
title: 为 Microsoft Teams 注册通话和会议机器人
description: 了解如何注册 Microsoft Teams 的新音频/视频呼叫机器人
ms.topic: conceptual
keywords: 呼叫机器人音频/视频音频视频媒体
ms.openlocfilehash: 4f4f1fdf0c33685e146081085aa7ff8e07f1a87d
ms.sourcegitcommit: dd2220f691029d043aaddfc7c229e332735acb1d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/24/2021
ms.locfileid: "51995860"
---
# <a name="register-calls-and-meetings-bot-for-microsoft-teams"></a><span data-ttu-id="e36aa-104">为 Microsoft Teams 注册通话和会议机器人</span><span class="sxs-lookup"><span data-stu-id="e36aa-104">Register calls and meetings bot for Microsoft Teams</span></span>

<span data-ttu-id="e36aa-105">参与音频或视频通话和联机会议的机器人是常规 Microsoft Teams 自动程序，具有以下用于注册机器人的额外功能：</span><span class="sxs-lookup"><span data-stu-id="e36aa-105">A bot that participates in audio or video calls and online meetings is a regular Microsoft Teams bot with the following extra features used to register the bot:</span></span>

* <span data-ttu-id="e36aa-106">有一个新版本的 Teams 应用清单，其中新增了两个设置 `supportsCalling` 和 `supportsVideo` 。</span><span class="sxs-lookup"><span data-stu-id="e36aa-106">There is a new version of the Teams app manifest with two additional settings, `supportsCalling` and `supportsVideo`.</span></span> <span data-ttu-id="e36aa-107">这些设置包含在 Teams [应用清单](../../resources/dev-preview/developer-preview-intro.md) 的开发人员预览版中。</span><span class="sxs-lookup"><span data-stu-id="e36aa-107">These settings are included in the [developer preview](../../resources/dev-preview/developer-preview-intro.md) version of the Teams app manifest.</span></span>
* <span data-ttu-id="e36aa-108">[必须为自动](./registering-calling-bot.md#add-graph-permissions) 程序 Microsoft 应用 ID 配置 Microsoft Graph 权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-108">[Microsoft Graph permissions](./registering-calling-bot.md#add-graph-permissions) must be configured for your bot's Microsoft App ID.</span></span>
* <span data-ttu-id="e36aa-109">Graph 通话和联机会议 API 权限需要租户管理员同意。</span><span class="sxs-lookup"><span data-stu-id="e36aa-109">The Graph calls and online meetings APIs permissions require tenant admin consent.</span></span>

## <a name="new-manifest-settings"></a><span data-ttu-id="e36aa-110">新清单设置</span><span class="sxs-lookup"><span data-stu-id="e36aa-110">New manifest settings</span></span>

<span data-ttu-id="e36aa-111">通话和联机会议自动程序在 manifest.js有以下两个额外设置，为 Teams 中的机器人启用音频或视频。</span><span class="sxs-lookup"><span data-stu-id="e36aa-111">Calls and online meetings bots have the following two additional settings in the manifest.json that enable audio or video for your bot in Teams.</span></span>

* <span data-ttu-id="e36aa-112">`bots[0].supportsCalling`.</span><span class="sxs-lookup"><span data-stu-id="e36aa-112">`bots[0].supportsCalling`.</span></span> <span data-ttu-id="e36aa-113">如果存在并设置为 `true` ，Teams 允许机器人参与通话和联机会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-113">If present and set to `true`, Teams allows your bot to participate in calls and online meetings.</span></span>
* <span data-ttu-id="e36aa-114">`bots[0].supportsVideo`.</span><span class="sxs-lookup"><span data-stu-id="e36aa-114">`bots[0].supportsVideo`.</span></span> <span data-ttu-id="e36aa-115">如果存在并设置为 `true` ，Teams 知道机器人支持视频。</span><span class="sxs-lookup"><span data-stu-id="e36aa-115">If present and set to `true`, Teams knows that your bot supports video.</span></span>

<span data-ttu-id="e36aa-116">如果希望 IDE 正确验证manifest.js和会议机器人的架构上是否包含这些值，可以按如下方式更改 `$schema` 属性：</span><span class="sxs-lookup"><span data-stu-id="e36aa-116">If you want your IDE to properly validate the manifest.json schema for your calls and meetings bot for these values, you can change the `$schema` attribute as follows:</span></span>

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

<span data-ttu-id="e36aa-117">下一部分使你能够创建新的机器人或将呼叫功能添加到现有机器人。</span><span class="sxs-lookup"><span data-stu-id="e36aa-117">The next section enables you to create a new bot or add calling capabilities to your existing bot.</span></span>

## <a name="create-new-bot-or-add-calling-capabilities"></a><span data-ttu-id="e36aa-118">创建新的机器人或添加呼叫功能</span><span class="sxs-lookup"><span data-stu-id="e36aa-118">Create new bot or add calling capabilities</span></span>

<span data-ttu-id="e36aa-119">有关创建机器人的信息，请参阅为 [Teams 创建自动程序](../how-to/create-a-bot-for-teams.md)。</span><span class="sxs-lookup"><span data-stu-id="e36aa-119">For information on creating bots, see [create a bot for Teams](../how-to/create-a-bot-for-teams.md).</span></span>

<span data-ttu-id="e36aa-120">**为 Teams 创建新的自动程序**</span><span class="sxs-lookup"><span data-stu-id="e36aa-120">**To create a new bot for Teams**</span></span>

1. <span data-ttu-id="e36aa-121">使用此链接可创建新的自动程序 `https://dev.botframework.com/bots/new` 。</span><span class="sxs-lookup"><span data-stu-id="e36aa-121">Use this link to create a new bot, `https://dev.botframework.com/bots/new`.</span></span> <span data-ttu-id="e36aa-122">或者，如果你选择自动 **程序** 框架门户中的创建自动程序按钮，你将在 Microsoft Azure 中创建自动程序，你必须拥有 Azure 帐户。</span><span class="sxs-lookup"><span data-stu-id="e36aa-122">Alternately, if you select the **Create a bot** button in the Bot Framework portal, you create your bot in Microsoft Azure, for which you must have an Azure account.</span></span>
1. <span data-ttu-id="e36aa-123">添加 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="e36aa-123">Add the Teams channel.</span></span>
1. <span data-ttu-id="e36aa-124">选择 **Teams 频道** 页面上的"通话"选项卡。</span><span class="sxs-lookup"><span data-stu-id="e36aa-124">Select the **Calling** tab on the Teams channel page.</span></span> <span data-ttu-id="e36aa-125">选择 **"启用呼叫**"，然后更新 **Webhook (，** 以) 接收传入通知的 HTTPS URL 调用 Webhook，例如 `https://contoso.com/teamsapp/api/calling` 。</span><span class="sxs-lookup"><span data-stu-id="e36aa-125">Select **Enable calling**, and then update **Webhook (for calling)** with your HTTPS URL where you receive incoming notifications, for example `https://contoso.com/teamsapp/api/calling`.</span></span> <span data-ttu-id="e36aa-126">有关详细信息，请参阅 [配置频道](/bot-framework/portal-configure-channels)。</span><span class="sxs-lookup"><span data-stu-id="e36aa-126">For more information, see [configuring channels](/bot-framework/portal-configure-channels).</span></span>

    ![配置 Teams 频道信息](~/assets/images/calls-and-meetings/configure-msteams-channel.png)

<span data-ttu-id="e36aa-128">下一节提供呼叫和联机会议支持的应用程序权限列表。</span><span class="sxs-lookup"><span data-stu-id="e36aa-128">The next section provides a list of application permissions supported for calls and online meetings.</span></span>

## <a name="add-graph-permissions"></a><span data-ttu-id="e36aa-129">添加 Graph 权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-129">Add Graph permissions</span></span>

<span data-ttu-id="e36aa-130">Graph 提供精细的权限来控制应用对资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-130">The Graph provides granular permissions to control the access that apps have to resources.</span></span> <span data-ttu-id="e36aa-131">你可以决定应用请求的 Graph 权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-131">You decide which permissions for Graph your app requests.</span></span> <span data-ttu-id="e36aa-132">Graph 调用 API 支持应用程序权限，这些权限由在没有登录用户的情况下运行的应用使用。</span><span class="sxs-lookup"><span data-stu-id="e36aa-132">The Graph calling APIs support application permissions, which are used by apps that run without a signed-in user present.</span></span> <span data-ttu-id="e36aa-133">租户管理员必须同意应用程序权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-133">A tenant administrator must grant consent to application permissions.</span></span>

### <a name="application-permissions-for-calls"></a><span data-ttu-id="e36aa-134">调用的应用程序权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-134">Application permissions for calls</span></span>

<span data-ttu-id="e36aa-135">下表提供了用于调用的应用程序权限列表：</span><span class="sxs-lookup"><span data-stu-id="e36aa-135">The following table provides a list of application permissions for calls:</span></span>

|<span data-ttu-id="e36aa-136">权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-136">Permission</span></span>    |<span data-ttu-id="e36aa-137">显示字符串</span><span class="sxs-lookup"><span data-stu-id="e36aa-137">Display string</span></span>   |<span data-ttu-id="e36aa-138">说明</span><span class="sxs-lookup"><span data-stu-id="e36aa-138">Description</span></span> |<span data-ttu-id="e36aa-139">需要管理员同意</span><span class="sxs-lookup"><span data-stu-id="e36aa-139">Admin consent required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| <span data-ttu-id="e36aa-140">Calls.Initiate.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-140">Calls.Initiate.All</span></span> |<span data-ttu-id="e36aa-141">从应用预览启动传出 1：1 呼叫。</span><span class="sxs-lookup"><span data-stu-id="e36aa-141">Initiate outgoing 1:1 calls from the app preview.</span></span> |<span data-ttu-id="e36aa-142">允许应用在没有登录用户的情况下，向单个用户发起播出通话并将通话转接到组织目录中的用户。</span><span class="sxs-lookup"><span data-stu-id="e36aa-142">Allows the app to place outbound calls to a single user and transfer calls to users in your organization’s directory, without a signed-in user.</span></span>|<span data-ttu-id="e36aa-143">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-143">Yes</span></span>|
| <span data-ttu-id="e36aa-144">Calls.InitiateGroupCall.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-144">Calls.InitiateGroupCall.All</span></span> |<span data-ttu-id="e36aa-145">从应用预览启动传出组呼叫。</span><span class="sxs-lookup"><span data-stu-id="e36aa-145">Initiate outgoing group calls from the app preview.</span></span> |<span data-ttu-id="e36aa-146">允许应用在没有登录用户的情况下，向多个用户发起播出通话并向组织中的会议添加参与者。</span><span class="sxs-lookup"><span data-stu-id="e36aa-146">Allows the app to place outbound calls to multiple users and add participants to meetings in your organization, without a signed-in user.</span></span>|<span data-ttu-id="e36aa-147">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-147">Yes</span></span>|
| <span data-ttu-id="e36aa-148">Calls.JoinGroupCall.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-148">Calls.JoinGroupCall.All</span></span> |<span data-ttu-id="e36aa-149">以应用预览模式加入群组通话和会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-149">Join group calls and meetings as an app preview.</span></span> |<span data-ttu-id="e36aa-150">允许应用在没有登录用户的情况下，加入组织中的组通话和计划会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-150">Allows the app to join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="e36aa-151">应用已使用目录用户的权限加入租户中的会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-151">The app is joined with the privileges of a directory user to meetings in your tenant.</span></span>|<span data-ttu-id="e36aa-152">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-152">Yes</span></span>|
| <span data-ttu-id="e36aa-153">Calls.JoinGroupCallasGuest.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-153">Calls.JoinGroupCallasGuest.All</span></span> |<span data-ttu-id="e36aa-154">以来宾预览模式加入群组通话和会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-154">Join group calls and meetings as a guest preview.</span></span> |<span data-ttu-id="e36aa-155">允许应用在没有登录用户的情况下，以匿名方式加入组织中的组通话和计划会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-155">Allows the app to anonymously join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="e36aa-156">应用作为来宾加入租户中的会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-156">The app is joined as a guest to meetings in your tenant.</span></span>|<span data-ttu-id="e36aa-157">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-157">Yes</span></span>|
| <span data-ttu-id="e36aa-158">Calls.AccessMedia.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-158">Calls.AccessMedia.All</span></span> |<span data-ttu-id="e36aa-159">以应用预览模式访问通话中的媒体流。</span><span class="sxs-lookup"><span data-stu-id="e36aa-159">Access media streams in a call as an app preview.</span></span> |<span data-ttu-id="e36aa-160">允许应用在没有登录用户的情况下，直接访问通话中的媒体数据流。</span><span class="sxs-lookup"><span data-stu-id="e36aa-160">Allows the app to get direct access to media streams in a call, without a signed-in user.</span></span>|<span data-ttu-id="e36aa-161">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-161">Yes</span></span>|

> [!IMPORTANT]
> <span data-ttu-id="e36aa-162">不能使用媒体访问 API 记录或以其他方式保留来自调用或会议的媒体内容，您的应用程序访问或派生来自该媒体内容记录或录制的数据。</span><span class="sxs-lookup"><span data-stu-id="e36aa-162">You cannot use the Media Access API to record or otherwise persist media content from calls or meetings that your application accesses or derive data from that media content record or recording.</span></span> <span data-ttu-id="e36aa-163">必须先调用[ `updateRecordingStatus` API](/graph/api/call-updaterecordingstatus)以指示录制已开始，然后从该 API 收到成功回复。</span><span class="sxs-lookup"><span data-stu-id="e36aa-163">You must first call the [`updateRecordingStatus` API](/graph/api/call-updaterecordingstatus) to indicate that recording has begun, and receive a success reply from that API.</span></span> <span data-ttu-id="e36aa-164">如果应用程序开始录制任何会议或呼叫，则必须在调用 API 之前结束录制， `updateRecordingStatus` 以指示录制已结束。</span><span class="sxs-lookup"><span data-stu-id="e36aa-164">If your application begins recording any meeting or call, it must end the recording before calling the `updateRecordingStatus` API to indicate that the recording has ended.</span></span>

### <a name="application-permissions-for-online-meetings"></a><span data-ttu-id="e36aa-165">联机会议的应用程序权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-165">Application permissions for online meetings</span></span>

<span data-ttu-id="e36aa-166">下表提供了联机会议的应用程序权限列表：</span><span class="sxs-lookup"><span data-stu-id="e36aa-166">The following table provides a list of application permissions for online meetings:</span></span>

|<span data-ttu-id="e36aa-167">权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-167">Permission</span></span>    |<span data-ttu-id="e36aa-168">显示字符串</span><span class="sxs-lookup"><span data-stu-id="e36aa-168">Display string</span></span>   |<span data-ttu-id="e36aa-169">说明</span><span class="sxs-lookup"><span data-stu-id="e36aa-169">Description</span></span> |<span data-ttu-id="e36aa-170">需要管理员同意</span><span class="sxs-lookup"><span data-stu-id="e36aa-170">Admin consent required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| <span data-ttu-id="e36aa-171">OnlineMeetings.Read.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-171">OnlineMeetings.Read.All</span></span> |<span data-ttu-id="e36aa-172">从应用预览中读取联机会议详细信息</span><span class="sxs-lookup"><span data-stu-id="e36aa-172">Read online meeting details from the app preview</span></span>|<span data-ttu-id="e36aa-173">允许应用在没有登录用户的情况下读取组织的联机会议详细信息。</span><span class="sxs-lookup"><span data-stu-id="e36aa-173">Allows the app to read online meeting details in your organization, without a signed-in user.</span></span>|<span data-ttu-id="e36aa-174">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-174">Yes</span></span>|
| <span data-ttu-id="e36aa-175">OnlineMeetings.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="e36aa-175">OnlineMeetings.ReadWrite.All</span></span> |<span data-ttu-id="e36aa-176">代表用户从应用预览中读取和创建联机会议</span><span class="sxs-lookup"><span data-stu-id="e36aa-176">Read and create online meetings from the app preview on behalf of a user</span></span>|<span data-ttu-id="e36aa-177">允许应用在没有登录用户的情况下代表用户在你的组织中创建联机会议。</span><span class="sxs-lookup"><span data-stu-id="e36aa-177">Allows the app to create online meetings in your organization on behalf of a user, without a signed-in user.</span></span>|<span data-ttu-id="e36aa-178">是</span><span class="sxs-lookup"><span data-stu-id="e36aa-178">Yes</span></span>|

### <a name="assign-permissions"></a><span data-ttu-id="e36aa-179">分配权限</span><span class="sxs-lookup"><span data-stu-id="e36aa-179">Assign permissions</span></span>

<span data-ttu-id="e36aa-180">如果你想要使用[Azure Active Directory](/azure/active-directory/develop/azure-ad-endpoint-comparison) (AAD) V1 终结点，则必须使用[Azure](https://aka.ms/aadapplist)门户提前为自动程序配置应用程序权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-180">You must configure the application permissions for your bot in advance by using the [Azure portal](https://aka.ms/aadapplist) if you prefer to use the [Azure Active Directory (AAD) V1 endpoint](/azure/active-directory/develop/azure-ad-endpoint-comparison).</span></span>

### <a name="get-tenant-administrator-consent"></a><span data-ttu-id="e36aa-181">获取租户管理员同意</span><span class="sxs-lookup"><span data-stu-id="e36aa-181">Get tenant administrator consent</span></span>

<span data-ttu-id="e36aa-182">对于使用 AAD V1 终结点的应用，当应用安装在其组织中时，租户管理员可以使用 [Azure](https://portal.azure.com) 门户同意应用程序权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-182">For apps using the AAD V1 endpoint, a tenant administrator can consent to the application permissions using the [Azure portal](https://portal.azure.com) when your app is installed in their organization.</span></span> <span data-ttu-id="e36aa-183">或者，可以在应用中提供注册体验，管理员可通过此体验同意你配置的权限。</span><span class="sxs-lookup"><span data-stu-id="e36aa-183">Alternately, you can provide a sign-up experience in your app through which administrators can consent to the permissions you configured.</span></span> <span data-ttu-id="e36aa-184">AAD 记录管理员同意后，你的应用无需再次请求同意即可请求令牌。</span><span class="sxs-lookup"><span data-stu-id="e36aa-184">Once administrator consent is recorded by AAD, your app can request tokens without having to request consent again.</span></span>

<span data-ttu-id="e36aa-185">你可以依赖管理员在 Azure 门户授予应用 [所需的权限](https://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="e36aa-185">You can rely on an administrator to grant the permissions your app needs at the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="e36aa-186">更好的选择是使用 AAD V2 终结点为管理员提供注册 `/adminconsent` 体验。</span><span class="sxs-lookup"><span data-stu-id="e36aa-186">A better option is to provide a sign-up experience for administrators by using the AAD V2 `/adminconsent` endpoint.</span></span> <span data-ttu-id="e36aa-187">有关详细信息，请参阅 [有关构造管理员同意 URL 的说明](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent)。</span><span class="sxs-lookup"><span data-stu-id="e36aa-187">For more information, see [instructions on constructing an Admin consent URL](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent).</span></span>

> [!NOTE]
> <span data-ttu-id="e36aa-188">若要构建租户管理员同意 URL，需要应用注册门户中配置的重定向 URI[](https://apps.dev.microsoft.com/)或回复 URL。</span><span class="sxs-lookup"><span data-stu-id="e36aa-188">To construct the tenant Admin consent URL, a configured redirect URI or reply URL in the [app registration portal](https://apps.dev.microsoft.com/) is required.</span></span> <span data-ttu-id="e36aa-189">若要为自动程序添加回复 URL，访问自动程序注册，选择"高级选项""  >  **编辑应用程序清单"。**</span><span class="sxs-lookup"><span data-stu-id="e36aa-189">To add reply URLs for your bot, access your bot registration, choose **Advanced Options** > **Edit Application Manifest**.</span></span> <span data-ttu-id="e36aa-190">将重定向 URL 添加到 `replyUrls` 集合。</span><span class="sxs-lookup"><span data-stu-id="e36aa-190">Add your redirect URL to the `replyUrls` collection.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e36aa-191">无论何时更改应用程序权限，都必须重复管理员同意过程。</span><span class="sxs-lookup"><span data-stu-id="e36aa-191">Anytime you make a change to your application's permissions, you must also repeat the Admin consent process.</span></span> <span data-ttu-id="e36aa-192">在租户管理员重新应用同意之前，不会反映应用注册门户中所做的更改。</span><span class="sxs-lookup"><span data-stu-id="e36aa-192">Changes made in the app registration portal are not reflected until the consent has been reapplied by the tenant's administrator.</span></span>

## <a name="next-step"></a><span data-ttu-id="e36aa-193">后续步骤</span><span class="sxs-lookup"><span data-stu-id="e36aa-193">Next step</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="e36aa-194">来电通知</span><span class="sxs-lookup"><span data-stu-id="e36aa-194">Incoming call notifications</span></span>](~/bots/calls-and-meetings/call-notifications.md)
