---
title: 自动程序基础知识
author: clearab
description: 了解 Teams 中机器人的基础知识。
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: 3c4e707fa4677c2441f348e8d09ecf4428ef1296
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014500"
---
# <a name="bot-basics"></a><span data-ttu-id="375ef-103">自动程序基础知识</span><span class="sxs-lookup"><span data-stu-id="375ef-103">Bot basics</span></span>

<span data-ttu-id="375ef-104">本文档介绍 Microsoft Teams 中的机器人，这些机器人基于核心 Bot [](https://aka.ms/how-bots-work) Framework 文档中的机器人工作[方式一文构建](https://aka.ms/azure-bot-service-docs)。</span><span class="sxs-lookup"><span data-stu-id="375ef-104">This document provides an introduction to bots in Microsoft Teams that builds on the article [How bots work](https://aka.ms/how-bots-work) in the core [Bot Framework documentation](https://aka.ms/azure-bot-service-docs).</span></span> <span data-ttu-id="375ef-105">为 Microsoft Teams 开发的机器人和核心 Bot Framework 之间的主要区别在于 Teams 中提供的功能。</span><span class="sxs-lookup"><span data-stu-id="375ef-105">The primary difference between bots developed for Microsoft Teams and the core Bot Framework is in the features provided in Teams.</span></span>

## <a name="teams-activity-handlers"></a><span data-ttu-id="375ef-106">Teams 活动处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-106">Teams activity handlers</span></span>

<span data-ttu-id="375ef-107">Teams 活动处理程序派生自 Microsoft Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-107">Teams activity handler is derived from Microsoft Bot Framework's activity handler.</span></span> <span data-ttu-id="375ef-108">它先路由所有 Teams 活动，然后再允许处理任何特定于 Teams 的活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-108">It routes all Teams activities before allowing any non-Teams specific activities to be handled.</span></span>

<span data-ttu-id="375ef-109">当 Teams 自动程序收到活动时，它被定向到 *活动处理程序*。</span><span class="sxs-lookup"><span data-stu-id="375ef-109">When a bot for Teams receives an activity, it is directed to the *activity handlers*.</span></span> <span data-ttu-id="375ef-110">所有活动都通过一个称为轮转处理程序的基本 *处理程序进行路由*。</span><span class="sxs-lookup"><span data-stu-id="375ef-110">All activities are routed through one base handler called the *turn handler*.</span></span> <span data-ttu-id="375ef-111">轮 *转处理程序* 调用所需的活动处理程序来管理收到的任何活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-111">The *turn handler* calls the required activity handler to manage any activity received.</span></span> <span data-ttu-id="375ef-112">Teams 自动程序派生自 `TeamsActivityHandler` 类，该类派生自 Bot Framework 的 `ActivityHandler` 类。</span><span class="sxs-lookup"><span data-stu-id="375ef-112">The Teams bot is derived from `TeamsActivityHandler` class, which is derived from the Bot Framework's `ActivityHandler` class.</span></span>

# <a name="c"></a>[<span data-ttu-id="375ef-113">C#</span><span class="sxs-lookup"><span data-stu-id="375ef-113">C#</span></span>](#tab/csharp)

<span data-ttu-id="375ef-114">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="375ef-114">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="375ef-115">如果机器人收到消息活动，则轮转处理程序将收到该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="375ef-115">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="375ef-116">然后，轮转处理程序将传入活动发送到 `OnMessageActivityAsync` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-116">The turn handler then sends the incoming activity to the `OnMessageActivityAsync` activity handler.</span></span> <span data-ttu-id="375ef-117">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="375ef-117">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="375ef-118">如果机器人收到对话更新活动，则轮转处理程序将收到该传入活动的通知，并将传入活动发送到 `OnConversationUpdateActivityAsync` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-118">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `OnConversationUpdateActivityAsync`.</span></span> <span data-ttu-id="375ef-119">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-119">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="375ef-120">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-120">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="375ef-121">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序和 `OnConversationUpdateActivityAsync` `OnInvokeActivityAsync` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-121">In the Teams activity handler class, there are two primary Teams activity handlers, `OnConversationUpdateActivityAsync` and `OnInvokeActivityAsync`.</span></span> <span data-ttu-id="375ef-122">`OnConversationUpdateActivityAsync` 路由所有对话更新活动 `OnInvokeActivityAsync` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-122">`OnConversationUpdateActivityAsync` routes all conversation update activities and `OnInvokeActivityAsync` routes all Teams invoke activities.</span></span>

<span data-ttu-id="375ef-123">若要实现 Teams 特定活动处理程序的逻辑，必须替代自动程序中的方法，如"自动程序逻辑" [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="375ef-123">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [Bot logic](#bot-logic) section.</span></span> <span data-ttu-id="375ef-124">这些处理程序没有基本实现，因此，必须在替代中添加想要的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-124">There is no base implementation for these handlers, therefore, you must add the logic that you want in your override.</span></span>

# <a name="javascript"></a>[<span data-ttu-id="375ef-125">JavaScript</span><span class="sxs-lookup"><span data-stu-id="375ef-125">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="375ef-126">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="375ef-126">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="375ef-127">如果机器人收到消息活动，则轮转处理程序将收到该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="375ef-127">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="375ef-128">然后，轮转处理程序将传入活动发送到 `onMessage` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-128">The turn handler then sends the incoming activity to the `onMessage` activity handler.</span></span> <span data-ttu-id="375ef-129">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="375ef-129">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="375ef-130">如果机器人收到对话更新活动，则轮转处理程序将收到该传入活动的通知，并将传入活动发送到 `dispatchConversationUpdateActivity` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-130">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `dispatchConversationUpdateActivity`.</span></span> <span data-ttu-id="375ef-131">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-131">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="375ef-132">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-132">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="375ef-133">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序和 `dispatchConversationUpdateActivity` `onInvokeActivity` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-133">In the Teams activity handler class, there are two primary Teams activity handlers, `dispatchConversationUpdateActivity` and `onInvokeActivity`.</span></span> <span data-ttu-id="375ef-134">`dispatchConversationUpdateActivity` 路由所有对话更新活动 `onInvokeActivity` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-134">`dispatchConversationUpdateActivity` routes all conversation update activities and `onInvokeActivity` routes all Teams invoke activities.</span></span>

<span data-ttu-id="375ef-135">若要实现 Teams 特定活动处理程序的逻辑，必须替代自动程序中的方法，如"自动程序逻辑" [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="375ef-135">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [Bot logic](#bot-logic) section.</span></span> <span data-ttu-id="375ef-136">定义这些处理程序的自动程序逻辑， **然后确保在 `next()` 末尾进行调用**。</span><span class="sxs-lookup"><span data-stu-id="375ef-136">Define your bot logic for these handlers, then **be sure to call `next()` at the end**.</span></span> <span data-ttu-id="375ef-137">通过 `next()` 调用，可确保下一个处理程序运行。</span><span class="sxs-lookup"><span data-stu-id="375ef-137">By calling `next()` you ensure that the next handler runs.</span></span>

# <a name="python"></a>[<span data-ttu-id="375ef-138">Python</span><span class="sxs-lookup"><span data-stu-id="375ef-138">Python</span></span>](#tab/python)

<span data-ttu-id="375ef-139">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="375ef-139">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="375ef-140">如果机器人收到消息活动，则轮转处理程序将收到该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="375ef-140">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="375ef-141">然后，轮转处理程序将传入活动发送到 `on_message_activity` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-141">The turn handler then sends the incoming activity to the `on_message_activity` activity handler.</span></span> <span data-ttu-id="375ef-142">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="375ef-142">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="375ef-143">如果机器人收到对话更新活动，则轮转处理程序将收到该传入活动的通知，并将传入活动发送到 `on_conversation_update_activity` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-143">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `on_conversation_update_activity`.</span></span> <span data-ttu-id="375ef-144">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-144">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="375ef-145">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-145">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="375ef-146">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序和 `on_conversation_update_activity` `on_invoke_activity` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-146">In the Teams activity handler class, there are two primary Teams activity handlers, `on_conversation_update_activity` and `on_invoke_activity`.</span></span> <span data-ttu-id="375ef-147">`on_conversation_update_activity` 路由所有对话更新活动 `on_invoke_activity` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-147">`on_conversation_update_activity` routes all conversation update activities and `on_invoke_activity` routes all Teams invoke activities.</span></span>

<span data-ttu-id="375ef-148">若要实现 Teams 特定活动处理程序的逻辑，必须替代自动程序中的方法，如"自动程序逻辑" [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="375ef-148">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [Bot logic](#bot-logic) section.</span></span> <span data-ttu-id="375ef-149">这些处理程序没有基本实现，因此，必须在替代中添加想要的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-149">There is no base implementation for these handlers, therefore, you must add the logic that you want in your override.</span></span>

---

## <a name="bot-logic"></a><span data-ttu-id="375ef-150">自动程序逻辑</span><span class="sxs-lookup"><span data-stu-id="375ef-150">Bot logic</span></span>

<span data-ttu-id="375ef-151">机器人逻辑处理来自一个或多个自动程序通道的传入活动，并响应生成传出活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-151">The bot logic processes incoming activities from one or more of your bot channels and in response generates outgoing activities.</span></span> <span data-ttu-id="375ef-152">对于从 Teams 活动处理程序类派生的机器人，这一点仍然如此，此类将首先检查 Teams 活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-152">This is still true of bots derived from the Teams activity handler class, which first checks for Teams activities.</span></span> <span data-ttu-id="375ef-153">检查 Teams 活动后，它会将所有其他活动传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-153">After checking for Teams activities, it passes all other activities to the Bot Framework's activity handler.</span></span>

# <a name="c"></a>[<span data-ttu-id="375ef-154">C#</span><span class="sxs-lookup"><span data-stu-id="375ef-154">C#</span></span>](#tab/csharp)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="375ef-155">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-155">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="375ef-156">除了添加 *和\*\*删除* 的成员的活动之外，本节中所述的所有活动处理程序将继续像使用非 Teams 自动程序一样工作。</span><span class="sxs-lookup"><span data-stu-id="375ef-156">Except for the *added* and *removed* members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="375ef-157">活动处理程序在团队的上下文中有所不同，其中新成员将添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="375ef-157">Activity handlers are different in context of a team, where a new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="375ef-158">其中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-158">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="375ef-159">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-159">Event</span></span> | <span data-ttu-id="375ef-160">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-160">Handler</span></span> | <span data-ttu-id="375ef-161">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-161">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-162">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-162">Any activity type received</span></span> | `OnTurnAsync` | <span data-ttu-id="375ef-163">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="375ef-163">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="375ef-164">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-164">Message activity received</span></span> | `OnMessageActivityAsync` | <span data-ttu-id="375ef-165">可以重写此方法以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-165">This method can be overridden to handle a `Message` activity.</span></span> |
| <span data-ttu-id="375ef-166">接收的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="375ef-166">Conversation update activity received</span></span> | `OnConversationUpdateActivityAsync` | <span data-ttu-id="375ef-167">如果除自动程序成员外的其他成员在活动上加入或离开对话，此方法将调用 `ConversationUpdate` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-167">This method calls a handler if members other than the bot joined or left the conversation, on a `ConversationUpdate` activity.</span></span> |
| <span data-ttu-id="375ef-168">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="375ef-168">Non-bot members joined the conversation</span></span> | `OnMembersAddedAsync` | <span data-ttu-id="375ef-169">可以重写此方法以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-169">This method can be overridden to handle members joining a conversation.</span></span> |
| <span data-ttu-id="375ef-170">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="375ef-170">Non-bot members left the conversation</span></span> | `OnMembersRemovedAsync` | <span data-ttu-id="375ef-171">可以重写此方法以处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-171">This method can be overridden to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="375ef-172">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-172">Event activity received</span></span> | `OnEventActivityAsync` | <span data-ttu-id="375ef-173">此方法在活动上调用特定于事件类型的 `Event` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-173">This method calls a handler specific to the event type, on an `Event` activity.</span></span> |
| <span data-ttu-id="375ef-174">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-174">Token-response event activity received</span></span> | `OnTokenResponseEventAsync` | <span data-ttu-id="375ef-175">可以重写此方法以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-175">This method can be overridden to handle token response events.</span></span> |
| <span data-ttu-id="375ef-176">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-176">Non-token-response event activity received</span></span> | `OnEventAsync` | <span data-ttu-id="375ef-177">可以重写此方法以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-177">This method can be overridden to handle other types of events.</span></span> |
| <span data-ttu-id="375ef-178">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-178">Other activity type received</span></span> | `OnUnrecognizedActivityTypeAsync` | <span data-ttu-id="375ef-179">可以重写此方法以处理任何活动类型，否则无法处理。</span><span class="sxs-lookup"><span data-stu-id="375ef-179">This method can be overridden to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="375ef-180">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-180">Teams specific activity handlers</span></span>

<span data-ttu-id="375ef-181">扩展 `TeamsActivityHandler` 了核心聊天机器人框架处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="375ef-181">The `TeamsActivityHandler` extends the list of handlers in the Core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="375ef-182">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-182">Event</span></span> | <span data-ttu-id="375ef-183">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-183">Handler</span></span> | <span data-ttu-id="375ef-184">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-184">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-185">channelCreated</span><span class="sxs-lookup"><span data-stu-id="375ef-185">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="375ef-186">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-186">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="375ef-187">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-187">For more information, see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-188">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="375ef-188">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="375ef-189">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-189">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="375ef-190">有关详细信息，请参阅对话 [更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-190">For more information, see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-191">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-191">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="375ef-192">可以重写此方法以处理要重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-192">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="375ef-193">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-193">For more information, see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-194">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-194">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="375ef-195">`return Task.CompletedTask;` 可以重写此方法以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="375ef-195">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="375ef-196">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-196">For more information, see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-197">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="375ef-197">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="375ef-198">此方法在 中 `OnMembersAddedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-198">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-199">可以重写此方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-199">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="375ef-200">有关详细信息，请参阅[在对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-200">For more information, see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-201">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="375ef-201">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="375ef-202">此方法在 中 `OnMembersRemovedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-202">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-203">可以重写此方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-203">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="375ef-204">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-204">For more information, see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="375ef-205">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="375ef-205">Teams invoke activities</span></span>

<span data-ttu-id="375ef-206">从 Teams 活动处理程序调用的 `OnInvokeActivityAsync` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-206">The list of Teams activity handlers called from the `OnInvokeActivityAsync` Teams activity handler include the following:</span></span>

| <span data-ttu-id="375ef-207">调用类型</span><span class="sxs-lookup"><span data-stu-id="375ef-207">Invoke types</span></span>                    | <span data-ttu-id="375ef-208">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-208">Handler</span></span>                              | <span data-ttu-id="375ef-209">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-209">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="375ef-210">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-210">CardAction.Invoke</span></span>               | `OnTeamsCardActionInvokeAsync`       | <span data-ttu-id="375ef-211">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-211">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-212">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-212">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAcceptAsync`      | <span data-ttu-id="375ef-213">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-213">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="375ef-214">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-214">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAsync`            | <span data-ttu-id="375ef-215">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-215">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-216">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-216">fileConsent/invoke</span></span>              | `OnTeamsFileConsentDeclineAsync`     | <span data-ttu-id="375ef-217">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-217">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="375ef-218">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="375ef-218">actionableMessage/executeAction</span></span> | `OnTeamsO365ConnectorCardActionAsync` | <span data-ttu-id="375ef-219">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-219">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-220">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="375ef-220">signin/verifyState</span></span>              | `OnTeamsSigninVerifyStateAsync`      | <span data-ttu-id="375ef-221">当从连接器收到 signIn 验证状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-221">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-222">task/fetch</span><span class="sxs-lookup"><span data-stu-id="375ef-222">task/fetch</span></span>                      | `OnTeamsTaskModuleFetchAsync`        | <span data-ttu-id="375ef-223">可以在派生类中重写此方法，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-223">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="375ef-224">task/submit</span><span class="sxs-lookup"><span data-stu-id="375ef-224">task/submit</span></span>                     | `OnTeamsTaskModuleSubmitAsync`       | <span data-ttu-id="375ef-225">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-225">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="375ef-226">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="375ef-226">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="375ef-227">Bot Framework SDK 还支持调用特定于邮件扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-227">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="375ef-228">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="375ef-228">For more information, see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

# <a name="javascript"></a>[<span data-ttu-id="375ef-229">JavaScript</span><span class="sxs-lookup"><span data-stu-id="375ef-229">JavaScript</span></span>](#tab/javascript)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="375ef-230">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-230">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="375ef-231">除了添加 *和\*\*删除* 的成员的活动之外，本节中所述的所有活动处理程序将继续像使用非 Teams 自动程序一样工作。</span><span class="sxs-lookup"><span data-stu-id="375ef-231">Except for the *added* and *removed* members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="375ef-232">活动处理程序在团队上下文中有所不同，其中，将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="375ef-232">Activity handlers are different in context of a team, where the new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="375ef-233">其中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-233">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="375ef-234">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-234">Event</span></span> | <span data-ttu-id="375ef-235">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-235">Handler</span></span> | <span data-ttu-id="375ef-236">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-236">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-237">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-237">Any activity type received</span></span> | `onTurn` | <span data-ttu-id="375ef-238">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="375ef-238">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="375ef-239">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-239">Message activity received</span></span> | `onMessage` | <span data-ttu-id="375ef-240">此方法有助于处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-240">This method helps to handle a `Message` activity.</span></span> |
| <span data-ttu-id="375ef-241">接收的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="375ef-241">Conversation update activity received</span></span> | `onConversationUpdate` | <span data-ttu-id="375ef-242">如果除自动程序成员外的其他成员在活动上加入或离开对话，此方法将调用 `ConversationUpdate` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-242">This method calls a handler if members other than the bot joined or left the conversation, on a `ConversationUpdate` activity.</span></span> |
| <span data-ttu-id="375ef-243">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="375ef-243">Non-bot members joined the conversation</span></span> | `onMembersAdded` | <span data-ttu-id="375ef-244">此方法有助于处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-244">This method helps to handle members joining a conversation.</span></span> |
| <span data-ttu-id="375ef-245">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="375ef-245">Non-bot members left the conversation</span></span> | `onMembersRemoved` | <span data-ttu-id="375ef-246">此方法有助于处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-246">This method helps to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="375ef-247">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-247">Event activity received</span></span> | `onEvent` | <span data-ttu-id="375ef-248">此方法在活动上调用特定于事件类型的 `Event` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-248">This method calls a handler specific to the event type, on an `Event` activity.</span></span> |
| <span data-ttu-id="375ef-249">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-249">Token-response event activity received</span></span> | `onTokenResponseEvent` | <span data-ttu-id="375ef-250">此方法有助于处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-250">This method helps to handle token response events.</span></span> |
| <span data-ttu-id="375ef-251">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-251">Other activity type received</span></span> | `onUnrecognizedActivityType` | <span data-ttu-id="375ef-252">此方法有助于处理任何活动类型，否则无法处理。</span><span class="sxs-lookup"><span data-stu-id="375ef-252">This method helps to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="375ef-253">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-253">Teams specific activity handlers</span></span>

<span data-ttu-id="375ef-254">扩展 `TeamsActivityHandler` 了核心聊天机器人框架处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="375ef-254">The `TeamsActivityHandler` extends the list of handlers in the Core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="375ef-255">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-255">Event</span></span> | <span data-ttu-id="375ef-256">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-256">Handler</span></span> | <span data-ttu-id="375ef-257">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-257">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-258">channelCreated</span><span class="sxs-lookup"><span data-stu-id="375ef-258">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="375ef-259">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-259">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="375ef-260">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-260">For more information, see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-261">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="375ef-261">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="375ef-262">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-262">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="375ef-263">有关详细信息，请参阅对话 [更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-263">For more information, see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-264">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-264">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="375ef-265">可以重写此方法以处理要重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-265">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="375ef-266">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-266">For more information, see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-267">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-267">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="375ef-268">`return Task.CompletedTask;` 可以重写此方法以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="375ef-268">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="375ef-269">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-269">For more information, see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-270">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="375ef-270">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="375ef-271">此方法在 中 `OnMembersAddedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-271">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-272">可以重写此方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-272">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="375ef-273">有关详细信息，请参阅[在对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-273">For more information, see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-274">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="375ef-274">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="375ef-275">此方法在 中 `OnMembersRemovedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-275">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-276">可以重写此方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-276">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="375ef-277">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-277">For more information, see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |

#### <a name="teams-invoke-activities"></a><span data-ttu-id="375ef-278">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="375ef-278">Teams invoke activities</span></span>

<span data-ttu-id="375ef-279">从 Teams 活动处理程序调用的 `onInvokeActivity` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-279">The list of Teams activity handlers called from the `onInvokeActivity` Teams activity handler include the following:</span></span>

| <span data-ttu-id="375ef-280">调用类型</span><span class="sxs-lookup"><span data-stu-id="375ef-280">Invoke types</span></span>                    | <span data-ttu-id="375ef-281">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-281">Handler</span></span>                              | <span data-ttu-id="375ef-282">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-282">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="375ef-283">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-283">CardAction.Invoke</span></span>               | `handleTeamsCardActionInvoke`       | <span data-ttu-id="375ef-284">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-284">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-285">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-285">fileConsent/invoke</span></span>              | `handleTeamsFileConsentAccept`      | <span data-ttu-id="375ef-286">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-286">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="375ef-287">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-287">fileConsent/invoke</span></span>              | `handleTeamsFileConsent`            | <span data-ttu-id="375ef-288">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-288">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-289">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-289">fileConsent/invoke</span></span>              | `handleTeamsFileConsentDecline`     | <span data-ttu-id="375ef-290">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-290">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="375ef-291">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="375ef-291">actionableMessage/executeAction</span></span> | `handleTeamsO365ConnectorCardAction` | <span data-ttu-id="375ef-292">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-292">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-293">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="375ef-293">signin/verifyState</span></span>              | `handleTeamsSigninVerifyState`      | <span data-ttu-id="375ef-294">当从连接器收到 signIn 验证状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-294">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-295">task/fetch</span><span class="sxs-lookup"><span data-stu-id="375ef-295">task/fetch</span></span>                      | `handleTeamsTaskModuleFetch`        | <span data-ttu-id="375ef-296">可以在派生类中重写此方法，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-296">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="375ef-297">task/submit</span><span class="sxs-lookup"><span data-stu-id="375ef-297">task/submit</span></span>                     | `handleTeamsTaskModuleSubmit`       | <span data-ttu-id="375ef-298">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-298">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="375ef-299">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="375ef-299">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="375ef-300">Bot Framework SDK 还支持调用特定于邮件扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-300">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="375ef-301">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="375ef-301">For more information, see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

# <a name="python"></a>[<span data-ttu-id="375ef-302">Python</span><span class="sxs-lookup"><span data-stu-id="375ef-302">Python</span></span>](#tab/python)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="375ef-303">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-303">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="375ef-304">除了添加 *和\*\*删除* 的成员的活动之外，本节中所述的所有活动处理程序将继续像使用非 Teams 自动程序一样工作。</span><span class="sxs-lookup"><span data-stu-id="375ef-304">Except for the *added* and *removed* members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="375ef-305">活动处理程序在团队上下文中有所不同，其中，将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="375ef-305">Activity handlers are different in context of a team, where the new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="375ef-306">其中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-306">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="375ef-307">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-307">Event</span></span> | <span data-ttu-id="375ef-308">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-308">Handler</span></span> | <span data-ttu-id="375ef-309">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-309">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-310">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-310">Any activity type received</span></span> | `on_turn` | <span data-ttu-id="375ef-311">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="375ef-311">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="375ef-312">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-312">Message activity received</span></span> | `on_message_activity` | <span data-ttu-id="375ef-313">可以重写此方法以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-313">This method can be overridden to handle a `Message` activity.</span></span> |
| <span data-ttu-id="375ef-314">接收的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="375ef-314">Conversation update activity received</span></span> | `on_conversation_update_activity` | <span data-ttu-id="375ef-315">如果除机器人成员外的成员加入或离开对话，此方法将调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-315">This method calls a handler if members other than the bot join or leave the conversation.</span></span> |
| <span data-ttu-id="375ef-316">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="375ef-316">Non-bot members joined the conversation</span></span> | `on_members_added_activity` | <span data-ttu-id="375ef-317">可以重写此方法以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-317">This method can be overridden to handle members joining a conversation.</span></span> |
| <span data-ttu-id="375ef-318">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="375ef-318">Non-bot members left the conversation</span></span> | `on_members_removed_activity` | <span data-ttu-id="375ef-319">可以重写此方法以处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-319">This method can be overridden to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="375ef-320">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-320">Event activity received</span></span> | `on_event_activity` | <span data-ttu-id="375ef-321">此方法调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="375ef-321">This method calls a handler specific to the type of event.</span></span> |
| <span data-ttu-id="375ef-322">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-322">Token-response event activity received</span></span> | `on_token_response_event` | <span data-ttu-id="375ef-323">可以重写此方法以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-323">This method can be overridden to handle token response events.</span></span> |
| <span data-ttu-id="375ef-324">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="375ef-324">Non-token-response event activity received</span></span> | `on_event` | <span data-ttu-id="375ef-325">可以重写此方法以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="375ef-325">This method can be overridden to handle other types of events.</span></span> |
| <span data-ttu-id="375ef-326">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="375ef-326">Other activity types received</span></span> | `on_unrecognized_activity_type` | <span data-ttu-id="375ef-327">可以重写此方法以处理任何未处理的活动类型。</span><span class="sxs-lookup"><span data-stu-id="375ef-327">This method can be overridden to handle any type of activity that is not handled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="375ef-328">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-328">Teams specific activity handlers</span></span>

<span data-ttu-id="375ef-329">扩展 `TeamsActivityHandler` 了核心聊天机器人框架处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="375ef-329">The `TeamsActivityHandler` extends the list of handlers from the Core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="375ef-330">事件</span><span class="sxs-lookup"><span data-stu-id="375ef-330">Event</span></span> | <span data-ttu-id="375ef-331">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-331">Handler</span></span> | <span data-ttu-id="375ef-332">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-332">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="375ef-333">channelCreated</span><span class="sxs-lookup"><span data-stu-id="375ef-333">channelCreated</span></span> | `on_teams_channel_created` | <span data-ttu-id="375ef-334">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-334">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="375ef-335">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-335">For more information, see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="375ef-336">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="375ef-336">channelDeleted</span></span> | `on_teams_channel_deleted` | <span data-ttu-id="375ef-337">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-337">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="375ef-338">有关详细信息，请参阅对话 [更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-338">For more information, see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-339">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-339">channelRenamed</span></span> | `on_teams_channel_renamed` | <span data-ttu-id="375ef-340">可以重写此方法以处理要重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="375ef-340">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="375ef-341">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-341">For more information, see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-342">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="375ef-342">teamRenamed</span></span> | `on_teams_team_renamed` | <span data-ttu-id="375ef-343">`return Task.CompletedTask;` 可以重写此方法以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="375ef-343">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="375ef-344">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-344">For more information, see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-345">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="375ef-345">MembersAdded</span></span> | `on_teams_members_added` | <span data-ttu-id="375ef-346">此方法在 中 `OnMembersAddedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-346">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-347">可以重写此方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-347">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="375ef-348">有关详细信息，请参阅[在对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-348">For more information, see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="375ef-349">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="375ef-349">MembersRemoved</span></span> | `on_teams_members_removed` | <span data-ttu-id="375ef-350">此方法在 中 `OnMembersRemovedAsync` 调用该方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="375ef-350">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="375ef-351">可以重写此方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="375ef-351">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="375ef-352">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="375ef-352">For more information, see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="375ef-353">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="375ef-353">Teams invoke activities</span></span>

<span data-ttu-id="375ef-354">从 Teams 活动处理程序调用的 `on_invoke_activity` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="375ef-354">The list of Teams activity handlers called from the `on_invoke_activity` Teams activity handler include the following:</span></span>

| <span data-ttu-id="375ef-355">调用类型</span><span class="sxs-lookup"><span data-stu-id="375ef-355">Invoke types</span></span>                    | <span data-ttu-id="375ef-356">处理程序</span><span class="sxs-lookup"><span data-stu-id="375ef-356">Handler</span></span>                              | <span data-ttu-id="375ef-357">说明</span><span class="sxs-lookup"><span data-stu-id="375ef-357">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="375ef-358">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-358">CardAction.Invoke</span></span>               | `on_teams_card_action_invoke`       | <span data-ttu-id="375ef-359">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-359">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-360">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-360">fileConsent/invoke</span></span>              | `on_teams_file_consent_accept`      | <span data-ttu-id="375ef-361">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-361">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="375ef-362">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-362">fileConsent/invoke</span></span>              | `on_teams_file_consent`            | <span data-ttu-id="375ef-363">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-363">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-364">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="375ef-364">fileConsent/invoke</span></span>              | `on_teams_file_consent_decline`     | <span data-ttu-id="375ef-365">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-365">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="375ef-366">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="375ef-366">actionableMessage/executeAction</span></span> | `on_teams_o365_connector_card_action` | <span data-ttu-id="375ef-367">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-367">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-368">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="375ef-368">signin/verifyState</span></span>              | `on_teams_signin_verify_state`      | <span data-ttu-id="375ef-369">当从连接器收到 signIn 验证状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="375ef-369">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="375ef-370">task/fetch</span><span class="sxs-lookup"><span data-stu-id="375ef-370">task/fetch</span></span>                      | `on_teams_task_module_fetch`        | <span data-ttu-id="375ef-371">可以在派生类中重写此方法，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-371">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="375ef-372">task/submit</span><span class="sxs-lookup"><span data-stu-id="375ef-372">task/submit</span></span>                     | `on_teams_task_module_submit`       | <span data-ttu-id="375ef-373">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="375ef-373">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="375ef-374">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="375ef-374">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="375ef-375">Bot Framework SDK 还支持调用特定于邮件扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="375ef-375">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="375ef-376">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="375ef-376">For more information, see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

---
