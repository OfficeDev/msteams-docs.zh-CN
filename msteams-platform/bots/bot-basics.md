---
title: 自动程序基础知识
author: clearab
description: 了解 Teams 中机器人的基础知识。
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: 43dd351b30fdba3435d39aca43aae0f2de00ed24
ms.sourcegitcommit: d0e71ea63af2f67eba75ba283ec46cc7cdf87d75
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/24/2020
ms.locfileid: "49731956"
---
# <a name="bot-basics"></a><span data-ttu-id="f7c41-103">自动程序基础知识</span><span class="sxs-lookup"><span data-stu-id="f7c41-103">Bot basics</span></span>

<span data-ttu-id="f7c41-104">这是基于核心 Bot Framework 文档中[](https://aka.ms/how-bots-work)自动程序如何工作的文章构建[的简介](https://aka.ms/azure-bot-service-docs)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-104">This is an introduction that builds on the article [How bots work](https://aka.ms/how-bots-work) in the core [Bot Framework documentation](https://aka.ms/azure-bot-service-docs).</span></span> <span data-ttu-id="f7c41-105">您可能会发现该文章以及"概念"部分的其他文章很有用。</span><span class="sxs-lookup"><span data-stu-id="f7c41-105">You may find that article, and the other articles in the *Concepts* section, useful.</span></span>

<span data-ttu-id="f7c41-106">为 Microsoft Teams 开发的自动程序的主要区别在于如何处理活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-106">The primary difference in bots developed for Microsoft Teams is in how the activities are handled.</span></span> <span data-ttu-id="f7c41-107">Microsoft Teams 活动处理程序派生自 Bot Framework 的活动处理程序，用于路由所有 Teams 活动，然后再允许处理任何特定于 Teams 的活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-107">The Microsoft Teams activity handler derives from the Bot Framework's activity handler to route  all Teams activities before allowing any non-Teams specific activities to be handled.</span></span>

## <a name="teams-activity-handlers"></a><span data-ttu-id="f7c41-108">Teams 活动处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-108">Teams Activity handlers</span></span>

<span data-ttu-id="f7c41-109">当 Microsoft Teams 自动程序收到活动时，它会将活动传递给 *其活动处理程序*。</span><span class="sxs-lookup"><span data-stu-id="f7c41-109">When a bot for Microsoft Teams receives an activity, it passes it on to its *activity handlers*.</span></span> <span data-ttu-id="f7c41-110">其中，有一个称为轮转处理程序的基本处理程序，所有活动都通过该处理程序进行路由。</span><span class="sxs-lookup"><span data-stu-id="f7c41-110">Under the covers, there's one base handler called the *turn handler*, that all activities are routed through.</span></span> <span data-ttu-id="f7c41-111">轮 *转处理程序* 调用所需的活动处理程序以处理收到的任何类型的活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-111">The *turn handler* calls the required activity handler to handle whatever type of activity was received.</span></span> <span data-ttu-id="f7c41-112">为 Microsoft Teams 设计的自动程序的不同是它派生自从 `TeamsActivityHandler` Bot Framework 的类派生 `ActivityHandler` 的类。</span><span class="sxs-lookup"><span data-stu-id="f7c41-112">Where a bot designed for Microsoft Teams differs is that it is derived from `TeamsActivityHandler` class that is derived from the Bot Framework's `ActivityHandler` class.</span></span>

# <a name="c"></a>[<span data-ttu-id="f7c41-113">C#</span><span class="sxs-lookup"><span data-stu-id="f7c41-113">C#</span></span>](#tab/csharp)

<span data-ttu-id="f7c41-114">与使用 Microsoft Bot Framework 创建的任何自动程序一样，如果机器人收到消息活动，轮转处理程序将看到传入活动并将其发送到 `OnMessageActivityAsync` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-114">As with any bot created using the Microsoft Bot Framework, if the bot receives a message activity, the turn handler sees that incoming activity and sends it to the `OnMessageActivityAsync` activity handler.</span></span> <span data-ttu-id="f7c41-115">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="f7c41-115">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="f7c41-116">如果机器人收到对话更新活动，轮机处理程序将看到传入活动并将其发送到 `OnConversationUpdateActivityAsync` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-116">If the bot receives a conversation update activity, the turn handler sees that incoming activity and sends it to the `OnConversationUpdateActivityAsync`.</span></span> <span data-ttu-id="f7c41-117">*Teams* 活动处理程序，将首先检查任何 Teams 特定事件，如果未找到任何事件，则传递到 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-117">*Teams* activity handler that will first check for any Teams specific events and pass it along to the Bot Framework's activity handler if none are found.</span></span>

<span data-ttu-id="f7c41-118">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序，可路由所有对话更新活动，并路由 `OnConversationUpdateActivityAsync` `OnInvokeActivityAsync` 所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-118">In the Teams activity handler class, there are two primary Teams activity handlers, `OnConversationUpdateActivityAsync` that routes all conversation update activities, and `OnInvokeActivityAsync` that routes all Teams invoke activities.</span></span>

<span data-ttu-id="f7c41-119">若要为 Teams 特定活动处理程序实现逻辑，你将在自动程序中替代这些方法，如下面的自动程序逻辑 [部分所示](#bot-logic) 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-119">To implement your logic for Teams specific activity handlers, you'll override these methods in your bot as shown in the [Bot logic](#bot-logic) section below.</span></span> <span data-ttu-id="f7c41-120">对于其中每个处理程序，没有基本实现，因此只需在替代中添加想要的逻辑。</span><span class="sxs-lookup"><span data-stu-id="f7c41-120">For each of these handlers, there is no base implementation, so just add the logic that you want in your override.</span></span>

# <a name="javascript"></a>[<span data-ttu-id="f7c41-121">JavaScript</span><span class="sxs-lookup"><span data-stu-id="f7c41-121">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="f7c41-122">与使用 Microsoft Bot Framework 创建的任何自动程序一样，如果机器人收到消息活动，轮转处理程序将看到传入活动并将其发送到 `onMessage` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-122">As with any bot created using the Microsoft Bot Framework, if the bot receives a message activity, the turn handler sees that incoming activity and sends it to the `onMessage` activity handler.</span></span> <span data-ttu-id="f7c41-123">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="f7c41-123">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="f7c41-124">如果机器人收到对话更新活动，轮机处理程序将看到传入活动并将其发送到 `dispatchConversationUpdateActivity` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-124">If the bot receives a conversation update activity, the turn handler sees that incoming activity and sends it to the `dispatchConversationUpdateActivity`.</span></span> <span data-ttu-id="f7c41-125">*Teams* 活动处理程序，将首先检查任何 Teams 特定事件，如果未找到任何事件，则传递到自动程序框架活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-125">*Teams* activity handler that will first check for any Teams specific events and pass it along to the bot frameworks activity handler if none are found.</span></span>

<span data-ttu-id="f7c41-126">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序，可路由所有对话更新 `dispatchConversationUpdateActivity` 活动，并路由所有 Teams `onInvokeActivity` 调用活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-126">In the Teams activity handler class, there are two primary Teams activity handlers, `dispatchConversationUpdateActivity` that routes all conversation update Activities, and `onInvokeActivity` that routes all Teams invoke activities.</span></span>

<span data-ttu-id="f7c41-127">若要为 Teams 特定活动处理程序实现逻辑，你将在自动程序中替代这些方法，如"自动程序逻辑"[部分所述。](#bot-logic)</span><span class="sxs-lookup"><span data-stu-id="f7c41-127">To implement your logic for Teams specific activity handlers, you'll override these methods in your bot as seen in the [Bot logic](#bot-logic) section.</span></span> <span data-ttu-id="f7c41-128">对于其中每个处理程序，请定义自动程序逻辑，然后 **确保在 `next()` 末尾进行调用**。</span><span class="sxs-lookup"><span data-stu-id="f7c41-128">For each of these handlers, define your bot logic, then **be sure to call `next()` at the end**.</span></span> <span data-ttu-id="f7c41-129">通过 `next()` 调用，可确保下一个处理程序运行。</span><span class="sxs-lookup"><span data-stu-id="f7c41-129">By calling `next()` you ensure that the next handler runs.</span></span>

# <a name="python"></a>[<span data-ttu-id="f7c41-130">Python</span><span class="sxs-lookup"><span data-stu-id="f7c41-130">Python</span></span>](#tab/python)

<span data-ttu-id="f7c41-131">自动程序是使用 Microsoft Bot Framework 创建的，如果这些机器人收到消息活动，则轮转处理程序将收到该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="f7c41-131">Bots are created using the Microsoft Bot Framework, if these bot receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="f7c41-132">然后，轮转处理程序将传入活动发送到 `on_message_activity` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-132">The turn handler then sends the incoming activity to the `on_message_activity` activity handler.</span></span> <span data-ttu-id="f7c41-133">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="f7c41-133">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="f7c41-134">如果机器人收到对话更新活动，则轮转处理程序将收到该传入活动的通知，并将传入活动发送到 `on_conversation_update_activity` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-134">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `on_conversation_update_activity`.</span></span> <span data-ttu-id="f7c41-135">Teams 活动处理程序将首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-135">The Teams activity handler will first check for any Teams specific events.</span></span> <span data-ttu-id="f7c41-136">如果未找到任何事件，它将将它们传递到 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-136">If no events are found, it will then pass them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="f7c41-137">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序和 `on_conversation_update_activity` `on_invoke_activity` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-137">In the Teams activity handler class, there are two primary Teams activity handlers, `on_conversation_update_activity` and `on_invoke_activity`.</span></span> <span data-ttu-id="f7c41-138">`on_conversation_update_activity` 路由所有对话更新活动 `on_invoke_activity` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-138">`on_conversation_update_activity` routes all conversation update activities and `on_invoke_activity` routes all Teams invoke activities.</span></span>

<span data-ttu-id="f7c41-139">若要为 Teams 特定活动处理程序实现逻辑，你需要在自动程序中替代这些方法，如"自动程序逻辑" [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="f7c41-139">To implement your logic for Teams specific activity handlers, you need to override these methods in your bot as shown in the [Bot logic](#bot-logic) section.</span></span> <span data-ttu-id="f7c41-140">这些处理程序没有基本实现，因此，你需要在替代中添加所需的逻辑。</span><span class="sxs-lookup"><span data-stu-id="f7c41-140">There is no base implementation for these handlers, therefore, you need to add the logic that you want in your override.</span></span>

---

## <a name="bot-logic"></a><span data-ttu-id="f7c41-141">自动程序逻辑</span><span class="sxs-lookup"><span data-stu-id="f7c41-141">Bot logic</span></span>

<span data-ttu-id="f7c41-142">机器人逻辑处理来自一个或多个自动程序通道的传入活动，并生成传出活动作为响应。</span><span class="sxs-lookup"><span data-stu-id="f7c41-142">The bot logic processes incoming activities from one or more of your bot channels and generates outgoing activities in response.</span></span>  <span data-ttu-id="f7c41-143">从 Teams 活动处理程序类派生的机器人仍然如此，该类首先检查 Teams 活动，然后将所有其他活动传递给自动程序框架活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-143">This is still true of bots derived from the Teams activity handler class, which first checks for Teams activities, then passes all other activities to the bot frameworks activity handler.</span></span>

# <a name="c"></a>[<span data-ttu-id="f7c41-144">C#</span><span class="sxs-lookup"><span data-stu-id="f7c41-144">C#</span></span>](#tab/csharp)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="f7c41-145">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-145">Core Bot Framework handlers</span></span>

<span data-ttu-id="f7c41-146">下面介绍的所有活动处理程序将继续像处理非 Teams 机器人一样工作，除了处理成员添加和成员删除活动外，这些处理程序在团队的上下文中将有所不同，其中新成员将添加到团队而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="f7c41-146">All of the activity handlers described below will continue to work as they do with a non-Teams bot, with the exception of handling members *added* and members *removed* activities, these will be different in the context of a team, where the new member is added to the team as opposed to a message thread.</span></span>

<span data-ttu-id="f7c41-147">下面概述了其中定义的 `ActivityHandler` 处理程序：</span><span class="sxs-lookup"><span data-stu-id="f7c41-147">The handlers defined in `ActivityHandler` are outlined below:</span></span>

| <span data-ttu-id="f7c41-148">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-148">Event</span></span> | <span data-ttu-id="f7c41-149">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-149">Handler</span></span> | <span data-ttu-id="f7c41-150">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-150">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-151">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-151">Any activity type received</span></span> | `OnTurnAsync` | <span data-ttu-id="f7c41-152">根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="f7c41-152">Calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="f7c41-153">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-153">Message activity received</span></span> | `OnMessageActivityAsync` | <span data-ttu-id="f7c41-154">重写它以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-154">Override this to handle a `Message` activity.</span></span> |
| <span data-ttu-id="f7c41-155">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-155">Conversation update activity received</span></span> | `OnConversationUpdateActivityAsync` | <span data-ttu-id="f7c41-156">在活动中，如果除自动程序成员外的成员加入或 `ConversationUpdate` 离开对话，则调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-156">On a `ConversationUpdate` activity, calls a handler if members other than the bot joined or left the conversation.</span></span> |
| <span data-ttu-id="f7c41-157">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-157">Non-bot members joined the conversation</span></span> | `OnMembersAddedAsync` | <span data-ttu-id="f7c41-158">重写此关系以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-158">Override this to handle members joining a conversation.</span></span> |
| <span data-ttu-id="f7c41-159">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-159">Non-bot members left the conversation</span></span> | `OnMembersRemovedAsync` | <span data-ttu-id="f7c41-160">重写此关系以处理成员离开对话。</span><span class="sxs-lookup"><span data-stu-id="f7c41-160">Override this to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="f7c41-161">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-161">Event activity received</span></span> | `OnEventActivityAsync` | <span data-ttu-id="f7c41-162">在 `Event` 活动中，调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-162">On an `Event` activity, calls a handler specific to the event type.</span></span> |
| <span data-ttu-id="f7c41-163">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-163">Token-response event activity received</span></span> | `OnTokenResponseEventAsync` | <span data-ttu-id="f7c41-164">重写它以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-164">Override this to handle token response events.</span></span> |
| <span data-ttu-id="f7c41-165">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-165">Non-token-response event activity received</span></span> | `OnEventAsync` | <span data-ttu-id="f7c41-166">重写它以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-166">Override this to handle other types of events.</span></span> |
| <span data-ttu-id="f7c41-167">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-167">Other activity type received</span></span> | `OnUnrecognizedActivityTypeAsync` | <span data-ttu-id="f7c41-168">重写它以处理任何活动类型，否则未经处理。</span><span class="sxs-lookup"><span data-stu-id="f7c41-168">Override this to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-handlers"></a><span data-ttu-id="f7c41-169">特定于 Teams 的处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-169">Teams-specific handlers</span></span>

<span data-ttu-id="f7c41-170">扩展 `TeamsActivityHandler` 了上述处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="f7c41-170">The `TeamsActivityHandler` extends the list of handlers above to include the following:</span></span>

| <span data-ttu-id="f7c41-171">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-171">Event</span></span> | <span data-ttu-id="f7c41-172">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-172">Handler</span></span> | <span data-ttu-id="f7c41-173">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-173">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-174">channelCreated</span><span class="sxs-lookup"><span data-stu-id="f7c41-174">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="f7c41-175">重写此规则以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-175">Override this to handle a Teams channel being created.</span></span> <span data-ttu-id="f7c41-176">有关详细信息，请参阅[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-176">For more information see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-177">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="f7c41-177">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="f7c41-178">重写此规则以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-178">Override this to handle a Teams channel being deleted.</span></span> <span data-ttu-id="f7c41-179">有关详细信息，请参阅 [对话更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-179">For more information see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-180">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-180">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="f7c41-181">重写它以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-181">Override this to handle a Teams channel being renamed.</span></span> <span data-ttu-id="f7c41-182">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-182">For more information see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-183">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-183">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="f7c41-184">`return Task.CompletedTask;` 重写它以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="f7c41-184">`return Task.CompletedTask;` Override this to handle a Teams Team being Renamed.</span></span> <span data-ttu-id="f7c41-185">有关详细信息，请参阅 [对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-185">For more information see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-186">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="f7c41-186">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="f7c41-187">在 `OnMembersAddedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-187">Calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-188">重写此规则以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-188">Override this to handle members joining a team.</span></span> <span data-ttu-id="f7c41-189">有关详细信息，请参阅[在对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-189">For more information see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-190">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="f7c41-190">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="f7c41-191">在 `OnMembersRemovedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-191">Calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-192">重写此规则以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-192">Override this to handle members leaving a team.</span></span> <span data-ttu-id="f7c41-193">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-193">For more information see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="f7c41-194">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-194">Teams invoke activities</span></span>

<span data-ttu-id="f7c41-195">下面是从 Teams 活动处理程序调用的所有 `OnInvokeActivityAsync` _Teams_ 活动处理程序的列表：</span><span class="sxs-lookup"><span data-stu-id="f7c41-195">Here is a list of all of the Teams activity handlers called from the `OnInvokeActivityAsync` _Teams_ activity handler:</span></span>

| <span data-ttu-id="f7c41-196">调用类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-196">Invoke types</span></span>                    | <span data-ttu-id="f7c41-197">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-197">Handler</span></span>                              | <span data-ttu-id="f7c41-198">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-198">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="f7c41-199">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-199">CardAction.Invoke</span></span>               | `OnTeamsCardActionInvokeAsync`       | <span data-ttu-id="f7c41-200">Teams 卡片操作调用。</span><span class="sxs-lookup"><span data-stu-id="f7c41-200">Teams Card Action Invoke.</span></span> |
| <span data-ttu-id="f7c41-201">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-201">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAcceptAsync`      | <span data-ttu-id="f7c41-202">Teams 文件同意接受。</span><span class="sxs-lookup"><span data-stu-id="f7c41-202">Teams File Consent Accept.</span></span> |
| <span data-ttu-id="f7c41-203">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-203">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAsync`            | <span data-ttu-id="f7c41-204">Teams 文件许可。</span><span class="sxs-lookup"><span data-stu-id="f7c41-204">Teams File Consent.</span></span> |
| <span data-ttu-id="f7c41-205">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-205">fileConsent/invoke</span></span>              | `OnTeamsFileConsentDeclineAsync`     | <span data-ttu-id="f7c41-206">Teams 文件许可。</span><span class="sxs-lookup"><span data-stu-id="f7c41-206">Teams File Consent.</span></span> |
| <span data-ttu-id="f7c41-207">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="f7c41-207">actionableMessage/executeAction</span></span> | `OnTeamsO365ConnectorCardActionAsync` | <span data-ttu-id="f7c41-208">Teams O365 连接器卡片操作。</span><span class="sxs-lookup"><span data-stu-id="f7c41-208">Teams O365 connector Card Action.</span></span> |
| <span data-ttu-id="f7c41-209">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="f7c41-209">signin/verifyState</span></span>              | `OnTeamsSigninVerifyStateAsync`      | <span data-ttu-id="f7c41-210">Teams 登录验证状态。</span><span class="sxs-lookup"><span data-stu-id="f7c41-210">Teams Sign in Verify State.</span></span> |
| <span data-ttu-id="f7c41-211">task/fetch</span><span class="sxs-lookup"><span data-stu-id="f7c41-211">task/fetch</span></span>                      | `OnTeamsTaskModuleFetchAsync`        | <span data-ttu-id="f7c41-212">Teams 任务模块提取。</span><span class="sxs-lookup"><span data-stu-id="f7c41-212">Teams Task Module Fetch.</span></span> |
| <span data-ttu-id="f7c41-213">task/submit</span><span class="sxs-lookup"><span data-stu-id="f7c41-213">task/submit</span></span>                     | `OnTeamsTaskModuleSubmitAsync`       | <span data-ttu-id="f7c41-214">Teams 任务模块提交。</span><span class="sxs-lookup"><span data-stu-id="f7c41-214">Teams Task Module Submit.</span></span> |

<span data-ttu-id="f7c41-215">上面列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="f7c41-215">The invoke activities listed above are for conversational bots in Teams.</span></span> <span data-ttu-id="f7c41-216">Bot Framework SDK 还支持特定于消息传递扩展的调用。</span><span class="sxs-lookup"><span data-stu-id="f7c41-216">The Bot Framework SDK also supports invokes specific to messaging extensions.</span></span> <span data-ttu-id="f7c41-217">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)</span><span class="sxs-lookup"><span data-stu-id="f7c41-217">For more information see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions)</span></span>

# <a name="javascript"></a>[<span data-ttu-id="f7c41-218">JavaScript</span><span class="sxs-lookup"><span data-stu-id="f7c41-218">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="f7c41-219">下面描述的所有活动处理程序将继续像处理非 Teams 自动程序一样工作，除了处理添加的成员和成员删除的活动外，这些处理程序在团队的上下文中有所不同，其中新成员将添加到团队而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="f7c41-219">All of the activity handlers described below will continue to work as they do with a non-Teams bot, with the exception of handling the members *added* and members *removed* activities, these will be different in the context of a team, where the new member is added to the team as opposed to a message thread.</span></span>

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="f7c41-220">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-220">Core Bot Framework handlers</span></span>

<span data-ttu-id="f7c41-221">下面概述了其中定义的 `ActivityHandler` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-221">The handlers defined in `ActivityHandler` are outlined below.</span></span>

| <span data-ttu-id="f7c41-222">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-222">Event</span></span> | <span data-ttu-id="f7c41-223">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-223">Handler</span></span> | <span data-ttu-id="f7c41-224">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-224">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-225">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-225">Any activity type received</span></span> | `onTurn` | <span data-ttu-id="f7c41-226">根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="f7c41-226">Calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="f7c41-227">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-227">Message activity received</span></span> | `onMessage` | <span data-ttu-id="f7c41-228">为此提供一个函数以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-228">Provide a function for this to handle a `Message` activity.</span></span> |
| <span data-ttu-id="f7c41-229">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-229">Conversation update activity received</span></span> | `onConversationUpdate` | <span data-ttu-id="f7c41-230">在活动中，如果除自动程序成员外的成员加入或 `ConversationUpdate` 离开对话，则调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-230">On a `ConversationUpdate` activity, calls a handler if members other than the bot joined or left the conversation.</span></span> |
| <span data-ttu-id="f7c41-231">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-231">Non-bot members joined the conversation</span></span> | `onMembersAdded` | <span data-ttu-id="f7c41-232">为此提供一个函数来处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-232">Provide a function for this to handle members joining a conversation.</span></span> |
| <span data-ttu-id="f7c41-233">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-233">Non-bot members left the conversation</span></span> | `onMembersRemoved` | <span data-ttu-id="f7c41-234">为此提供一个函数来处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-234">Provide a function for this to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="f7c41-235">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-235">Event activity received</span></span> | `onEvent` | <span data-ttu-id="f7c41-236">在 `Event` 活动中，调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-236">On an `Event` activity, calls a handler specific to the event type.</span></span> |
| <span data-ttu-id="f7c41-237">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-237">Token-response event activity received</span></span> | `onTokenResponseEvent` | <span data-ttu-id="f7c41-238">为此提供一个函数以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-238">Provide a function for this to handle token response events.</span></span> |
| <span data-ttu-id="f7c41-239">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-239">Other activity type received</span></span> | `onUnrecognizedActivityType` | <span data-ttu-id="f7c41-240">为此提供一个函数来处理任何活动类型，否则未经处理。</span><span class="sxs-lookup"><span data-stu-id="f7c41-240">Provide a function for this to handle any activity type otherwise unhandled.</span></span> |
| <span data-ttu-id="f7c41-241">活动处理程序已完成</span><span class="sxs-lookup"><span data-stu-id="f7c41-241">Activity handlers have completed</span></span> | `onDialog` | <span data-ttu-id="f7c41-242">为此提供一个函数，以处理应在其余活动处理程序完成后在轮转结束时完成的任何处理。</span><span class="sxs-lookup"><span data-stu-id="f7c41-242">Provide a function for this to handle any processing that should be done at the end of a turn after the rest of your activity handlers have completed.</span></span> |

#### <a name="teams-specific-handlers"></a><span data-ttu-id="f7c41-243">特定于 Teams 的处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-243">Teams-specific handlers</span></span>

<span data-ttu-id="f7c41-244">扩展 `TeamsActivityHandler` 了核心聊天机器人框架处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="f7c41-244">The `TeamsActivityHandler` extends the list of handlers in the Core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="f7c41-245">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-245">Event</span></span> | <span data-ttu-id="f7c41-246">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-246">Handler</span></span> | <span data-ttu-id="f7c41-247">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-247">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-248">channelCreated</span><span class="sxs-lookup"><span data-stu-id="f7c41-248">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="f7c41-249">重写此规则以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-249">Override this to handle a Teams channel being created.</span></span> <span data-ttu-id="f7c41-250">有关详细信息，请参阅[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-250">For more information see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-251">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="f7c41-251">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="f7c41-252">重写此规则以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-252">Override this to handle a Teams channel being deleted.</span></span> <span data-ttu-id="f7c41-253">有关详细信息，请参阅 [对话更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-253">For more information see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-254">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-254">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="f7c41-255">重写它以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-255">Override this to handle a Teams channel being renamed.</span></span> <span data-ttu-id="f7c41-256">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-256">For more information see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-257">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-257">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="f7c41-258">`return Task.CompletedTask;` 重写它以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="f7c41-258">`return Task.CompletedTask;` Override this to handle a Teams team being renamed.</span></span> <span data-ttu-id="f7c41-259">有关详细信息，请参阅 [对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-259">For more information see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-260">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="f7c41-260">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="f7c41-261">在 `OnMembersAddedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-261">Calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-262">重写此规则以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-262">Override this to handle members joining a team.</span></span> <span data-ttu-id="f7c41-263">有关详细信息，请参阅[在对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-263">For more information see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-264">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="f7c41-264">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="f7c41-265">在 `OnMembersRemovedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-265">Calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-266">重写此规则以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-266">Override this to handle members leaving a team.</span></span> <span data-ttu-id="f7c41-267">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-267">For more information see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |

#### <a name="teams-invoke-activities"></a><span data-ttu-id="f7c41-268">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-268">Teams invoke activities</span></span>

<span data-ttu-id="f7c41-269">下面是从 Teams 活动处理程序调用的所有 `onInvokeActivity` Teams 活动处理程序的列表：</span><span class="sxs-lookup"><span data-stu-id="f7c41-269">Here is a list of all of the Teams activity handlers called from the `onInvokeActivity` Teams activity handler:</span></span>

| <span data-ttu-id="f7c41-270">调用类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-270">Invoke types</span></span>                    | <span data-ttu-id="f7c41-271">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-271">Handler</span></span>                              | <span data-ttu-id="f7c41-272">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-272">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="f7c41-273">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-273">CardAction.Invoke</span></span>               | `handleTeamsCardActionInvoke`       | <span data-ttu-id="f7c41-274">Teams 卡片操作调用。</span><span class="sxs-lookup"><span data-stu-id="f7c41-274">Teams card action invoke.</span></span> |
| <span data-ttu-id="f7c41-275">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-275">fileConsent/invoke</span></span>              | `handleTeamsFileConsentAccept`      | <span data-ttu-id="f7c41-276">Teams 文件同意接受。</span><span class="sxs-lookup"><span data-stu-id="f7c41-276">Teams file consent accept.</span></span> |
| <span data-ttu-id="f7c41-277">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-277">fileConsent/invoke</span></span>              | `handleTeamsFileConsent`            | <span data-ttu-id="f7c41-278">Teams 文件许可。</span><span class="sxs-lookup"><span data-stu-id="f7c41-278">Teams file consent.</span></span> |
| <span data-ttu-id="f7c41-279">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-279">fileConsent/invoke</span></span>              | `handleTeamsFileConsentDecline`     | <span data-ttu-id="f7c41-280">Teams 文件许可。</span><span class="sxs-lookup"><span data-stu-id="f7c41-280">Teams file consent.</span></span> |
| <span data-ttu-id="f7c41-281">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="f7c41-281">actionableMessage/executeAction</span></span> | `handleTeamsO365ConnectorCardAction` | <span data-ttu-id="f7c41-282">Teams O365 连接器卡操作。</span><span class="sxs-lookup"><span data-stu-id="f7c41-282">Teams O365 connector card action.</span></span> |
| <span data-ttu-id="f7c41-283">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="f7c41-283">signin/verifyState</span></span>              | `handleTeamsSigninVerifyState`      | <span data-ttu-id="f7c41-284">Teams 登录验证状态。</span><span class="sxs-lookup"><span data-stu-id="f7c41-284">Teams sign in verify state.</span></span> |
| <span data-ttu-id="f7c41-285">task/fetch</span><span class="sxs-lookup"><span data-stu-id="f7c41-285">task/fetch</span></span>                      | `handleTeamsTaskModuleFetch`        | <span data-ttu-id="f7c41-286">Teams 任务模块提取。</span><span class="sxs-lookup"><span data-stu-id="f7c41-286">Teams task module fetch.</span></span> |
| <span data-ttu-id="f7c41-287">task/submit</span><span class="sxs-lookup"><span data-stu-id="f7c41-287">task/submit</span></span>                     | `handleTeamsTaskModuleSubmit`       | <span data-ttu-id="f7c41-288">Teams 任务模块提交。</span><span class="sxs-lookup"><span data-stu-id="f7c41-288">Teams task module submit.</span></span> |

<span data-ttu-id="f7c41-289">Teams 调用活动部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="f7c41-289">The invoke activities listed in the Teams invoke activities section are for conversational bots in Teams.</span></span> <span data-ttu-id="f7c41-290">Bot Framework SDK 还支持调用特定于邮件扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-290">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="f7c41-291">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-291">For more information, see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

# <a name="python"></a>[<span data-ttu-id="f7c41-292">Python</span><span class="sxs-lookup"><span data-stu-id="f7c41-292">Python</span></span>](#tab/python)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="f7c41-293">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-293">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="f7c41-294">除了添加和删除的成员的活动之外，本节中所述的所有活动处理程序将继续像使用非 Teams 自动程序一样工作。</span><span class="sxs-lookup"><span data-stu-id="f7c41-294">Except for the added and removed members' activities, all of the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="f7c41-295">活动处理程序在团队上下文中有所不同，其中，将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="f7c41-295">Activity handlers are different in context of a team, where the new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="f7c41-296">其中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="f7c41-296">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="f7c41-297">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-297">Event</span></span> | <span data-ttu-id="f7c41-298">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-298">Handler</span></span> | <span data-ttu-id="f7c41-299">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-299">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-300">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-300">Any activity type received</span></span> | `on_turn` | <span data-ttu-id="f7c41-301">根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="f7c41-301">Calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="f7c41-302">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-302">Message activity received</span></span> | `on_message_activity` | <span data-ttu-id="f7c41-303">重写它以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-303">Overrides this to handle a `Message` activity.</span></span> |
| <span data-ttu-id="f7c41-304">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-304">Conversation update activity received</span></span> | `on_conversation_update_activity` | <span data-ttu-id="f7c41-305">如果除机器人成员外的成员加入或离开对话，请调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-305">Calls a handler if members other than the bot join or leave the conversation.</span></span> |
| <span data-ttu-id="f7c41-306">非自动程序成员加入对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-306">Non-bot members joined the conversation</span></span> | `on_members_added_activity` | <span data-ttu-id="f7c41-307">重写此关系以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-307">Overrides this to handle members joining a conversation.</span></span> |
| <span data-ttu-id="f7c41-308">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="f7c41-308">Non-bot members left the conversation</span></span> | `on_members_removed_activity` | <span data-ttu-id="f7c41-309">重写此关系以处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-309">Overrides this to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="f7c41-310">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-310">Event activity received</span></span> | `on_event_activity` | <span data-ttu-id="f7c41-311">调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="f7c41-311">Calls a handler specific to the type of event.</span></span> |
| <span data-ttu-id="f7c41-312">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-312">Token-response event activity received</span></span> | `on_token_response_event` | <span data-ttu-id="f7c41-313">重写它以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-313">Overrides this to handle token response events.</span></span> |
| <span data-ttu-id="f7c41-314">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-314">Non-token-response event activity received</span></span> | `on_event` | <span data-ttu-id="f7c41-315">重写它以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="f7c41-315">Overrides this to handle other types of events.</span></span> |
| <span data-ttu-id="f7c41-316">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-316">Other activity types received</span></span> | `on_unrecognized_activity_type` | <span data-ttu-id="f7c41-317">重写它以处理任何未处理的活动类型。</span><span class="sxs-lookup"><span data-stu-id="f7c41-317">Overrides this to handle any type of activity that is not handled.</span></span> |

#### <a name="teams-specific-handlers"></a><span data-ttu-id="f7c41-318">特定于 Teams 的处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-318">Teams-specific handlers</span></span>

<span data-ttu-id="f7c41-319">扩展 `TeamsActivityHandler` 了核心聊天机器人框架处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="f7c41-319">The `TeamsActivityHandler` extends the list of handlers from the Core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="f7c41-320">事件</span><span class="sxs-lookup"><span data-stu-id="f7c41-320">Event</span></span> | <span data-ttu-id="f7c41-321">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-321">Handler</span></span> | <span data-ttu-id="f7c41-322">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-322">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="f7c41-323">channelCreated</span><span class="sxs-lookup"><span data-stu-id="f7c41-323">channelCreated</span></span> | `on_teams_channel_created` | <span data-ttu-id="f7c41-324">替代此设置以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-324">Overrides this to handle a Teams channel being created.</span></span> <span data-ttu-id="f7c41-325">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-325">For more information, see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="f7c41-326">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="f7c41-326">channelDeleted</span></span> | `on_teams_channel_deleted` | <span data-ttu-id="f7c41-327">重写此规则以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-327">Overrides this to handle a Teams channel being deleted.</span></span> <span data-ttu-id="f7c41-328">有关详细信息，请参阅对话 [更新](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) 事件 [中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-328">For more information, see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-329">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-329">channelRenamed</span></span> | `on_teams_channel_renamed` | <span data-ttu-id="f7c41-330">替代它以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="f7c41-330">Overrides this to handle a Teams channel being renamed.</span></span> <span data-ttu-id="f7c41-331">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 重命名 [的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-331">For more information, see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-332">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="f7c41-332">teamRenamed</span></span> | `on_teams_team_renamed` | <span data-ttu-id="f7c41-333">`return Task.CompletedTask;` 替代它以处理正在重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="f7c41-333">`return Task.CompletedTask;` Overrides this to handle a Teams team being renamed.</span></span> <span data-ttu-id="f7c41-334">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 重命名 [的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-334">For more information, see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-335">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="f7c41-335">MembersAdded</span></span> | `on_teams_members_added` | <span data-ttu-id="f7c41-336">在 `OnMembersAddedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-336">Calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-337">重写此规则以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-337">Overrides this to handle members joining a team.</span></span> <span data-ttu-id="f7c41-338">有关详细信息，请参阅["对话更新"事件中添加](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-338">For more information, see [Team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="f7c41-339">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="f7c41-339">MembersRemoved</span></span> | `on_teams_members_removed` | <span data-ttu-id="f7c41-340">在 `OnMembersRemovedAsync` 中调用方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="f7c41-340">Calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="f7c41-341">重写此规则以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="f7c41-341">Overrides this to handle members leaving a team.</span></span> <span data-ttu-id="f7c41-342">有关详细信息，请参阅 [对话更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) 的 [团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-342">For more information, see [Team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="f7c41-343">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="f7c41-343">Teams invoke activities</span></span>

<span data-ttu-id="f7c41-344">从 Teams 活动处理程序调用的 `on_invoke_activity` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="f7c41-344">The list of Teams activity handlers called from the `on_invoke_activity` Teams activity handler include the following:</span></span>

| <span data-ttu-id="f7c41-345">调用类型</span><span class="sxs-lookup"><span data-stu-id="f7c41-345">Invoke types</span></span>                    | <span data-ttu-id="f7c41-346">处理程序</span><span class="sxs-lookup"><span data-stu-id="f7c41-346">Handler</span></span>                              | <span data-ttu-id="f7c41-347">说明</span><span class="sxs-lookup"><span data-stu-id="f7c41-347">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="f7c41-348">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-348">CardAction.Invoke</span></span>               | `on_teams_card_action_invoke`       | <span data-ttu-id="f7c41-349">Teams 卡片操作调用。</span><span class="sxs-lookup"><span data-stu-id="f7c41-349">Teams card action invoke.</span></span> |
| <span data-ttu-id="f7c41-350">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-350">fileConsent/invoke</span></span>              | `on_teams_file_consent_accept`      | <span data-ttu-id="f7c41-351">Teams 文件同意接受。</span><span class="sxs-lookup"><span data-stu-id="f7c41-351">Teams file consent accept.</span></span> |
| <span data-ttu-id="f7c41-352">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-352">fileConsent/invoke</span></span>              | `on_teams_file_consent`            | <span data-ttu-id="f7c41-353">Teams 文件许可。</span><span class="sxs-lookup"><span data-stu-id="f7c41-353">Teams file consent.</span></span> |
| <span data-ttu-id="f7c41-354">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="f7c41-354">fileConsent/invoke</span></span>              | `on_teams_file_consent_decline`     | <span data-ttu-id="f7c41-355">Teams 文件许可拒绝。</span><span class="sxs-lookup"><span data-stu-id="f7c41-355">Teams file consent decline.</span></span> |
| <span data-ttu-id="f7c41-356">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="f7c41-356">actionableMessage/executeAction</span></span> | `on_teams_o365_connector_card_action` | <span data-ttu-id="f7c41-357">Teams O365 连接器卡操作。</span><span class="sxs-lookup"><span data-stu-id="f7c41-357">Teams O365 connector card action.</span></span> |
| <span data-ttu-id="f7c41-358">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="f7c41-358">signin/verifyState</span></span>              | `on_teams_signin_verify_state`      | <span data-ttu-id="f7c41-359">Teams 登录验证状态。</span><span class="sxs-lookup"><span data-stu-id="f7c41-359">Teams sign in verify state.</span></span> |
| <span data-ttu-id="f7c41-360">task/fetch</span><span class="sxs-lookup"><span data-stu-id="f7c41-360">task/fetch</span></span>                      | `on_teams_task_module_fetch`        | <span data-ttu-id="f7c41-361">Teams 任务模块提取。</span><span class="sxs-lookup"><span data-stu-id="f7c41-361">Teams task module fetch.</span></span> |
| <span data-ttu-id="f7c41-362">task/submit</span><span class="sxs-lookup"><span data-stu-id="f7c41-362">task/submit</span></span>                     | `on_teams_task_module_submit`       | <span data-ttu-id="f7c41-363">Teams 任务模块提交。</span><span class="sxs-lookup"><span data-stu-id="f7c41-363">Teams task module submit.</span></span> |

<span data-ttu-id="f7c41-364">Teams 调用活动部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="f7c41-364">The invoke activities listed in the Teams invoke activities section are for conversational bots in Teams.</span></span> <span data-ttu-id="f7c41-365">Bot Framework SDK 还支持调用特定于邮件扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="f7c41-365">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="f7c41-366">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="f7c41-366">For more information, see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

---
