---
title: 智能机器人活动处理程序
author: clearab
description: 了解 Teams 中的机器人活动处理程序。
ms.topic: conceptual
localization_priority: Normal
ms.author: anclear
ms.openlocfilehash: da770d930ca6d00503c0102f1e683a60161636fd
ms.sourcegitcommit: 825abed2f8784d2bab7407ba7a4455ae17bbd28f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/26/2021
ms.locfileid: "52020188"
---
# <a name="bot-activity-handlers"></a><span data-ttu-id="122b7-103">智能机器人活动处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-103">Bot activity handlers</span></span>

<span data-ttu-id="122b7-104">本文档基于核心 Bot Framework 文档中 [有关](https://aka.ms/how-bots-work) 机器人 [如何工作的文章](https://aka.ms/azure-bot-service-docs)。</span><span class="sxs-lookup"><span data-stu-id="122b7-104">This document builds on the article on [how bots work](https://aka.ms/how-bots-work) in the core [Bot Framework documentation](https://aka.ms/azure-bot-service-docs).</span></span> <span data-ttu-id="122b7-105">为 Microsoft Teams 开发的机器人和核心 Bot Framework 之间的主要区别在于 Teams 中提供的功能。</span><span class="sxs-lookup"><span data-stu-id="122b7-105">The primary difference between bots developed for Microsoft Teams and the core Bot Framework is in the features provided in Teams.</span></span>

<span data-ttu-id="122b7-106">若要组织机器人的对话逻辑，则使用活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-106">To organize the conversational logic for your bot, an activity handler is used.</span></span> <span data-ttu-id="122b7-107">使用 Teams 活动处理程序和自动程序逻辑以两种方式处理活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-107">Activities are handled in two ways using Teams activity handlers and bot logic.</span></span> <span data-ttu-id="122b7-108">Teams 活动处理程序添加了对特定于 Microsoft Teams 的事件和交互的支持。</span><span class="sxs-lookup"><span data-stu-id="122b7-108">The Teams activity handler adds support for Microsoft Teams-specific events and interactions.</span></span> <span data-ttu-id="122b7-109">机器人对象包含轮次的对话逻辑或逻辑，并公开一个轮次处理程序，这是可接受来自机器人适配器的传入活动的方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-109">The bot object contains the conversational reasoning or logic for a turn and exposes a turn handler, which is the method that can accept incoming activities from the bot adapter.</span></span>

## <a name="teams-activity-handlers"></a><span data-ttu-id="122b7-110">Teams 活动处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-110">Teams activity handlers</span></span>

<span data-ttu-id="122b7-111">Teams 活动处理程序派生自 Microsoft Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-111">Teams activity handler is derived from Microsoft Bot Framework's activity handler.</span></span> <span data-ttu-id="122b7-112">在允许处理任何非 Teams 特定活动之前，它将路由所有 Teams 活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-112">It routes all Teams activities before allowing any non-Teams specific activities to be handled.</span></span>

<span data-ttu-id="122b7-113">当 Teams 机器人收到活动时，它会路由到活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-113">When a bot for Teams receives an activity, it is routed to the activity handlers.</span></span> <span data-ttu-id="122b7-114">所有活动都通过一个称为轮转处理程序的基本处理程序进行路由。</span><span class="sxs-lookup"><span data-stu-id="122b7-114">All activities are routed through one base handler called the turn handler.</span></span> <span data-ttu-id="122b7-115">轮次处理程序调用所需的活动处理程序来管理收到的任何活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-115">The turn handler calls the required activity handler to manage any activity received.</span></span> <span data-ttu-id="122b7-116">Teams 机器人派生自 `TeamsActivityHandler` 类，该类派生自 Bot Framework 的 `ActivityHandler` 类。</span><span class="sxs-lookup"><span data-stu-id="122b7-116">The Teams bot is derived from `TeamsActivityHandler` class, which is derived from the Bot Framework's `ActivityHandler` class.</span></span>

# <a name="c"></a>[<span data-ttu-id="122b7-117">C#</span><span class="sxs-lookup"><span data-stu-id="122b7-117">C#</span></span>](#tab/csharp)

<span data-ttu-id="122b7-118">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="122b7-118">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="122b7-119">如果机器人收到消息活动，轮机处理程序将接收该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="122b7-119">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="122b7-120">然后轮次处理程序将传入活动发送到 `OnMessageActivityAsync` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-120">The turn handler then sends the incoming activity to the `OnMessageActivityAsync` activity handler.</span></span> <span data-ttu-id="122b7-121">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="122b7-121">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="122b7-122">如果机器人收到对话更新活动，则轮机处理程序将接收该传入活动的通知，并将传入活动发送到 `OnConversationUpdateActivityAsync` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-122">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `OnConversationUpdateActivityAsync`.</span></span> <span data-ttu-id="122b7-123">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-123">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="122b7-124">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-124">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="122b7-125">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序 `OnConversationUpdateActivityAsync` 和 `OnInvokeActivityAsync` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-125">In the Teams activity handler class, there are two primary Teams activity handlers, `OnConversationUpdateActivityAsync` and `OnInvokeActivityAsync`.</span></span> <span data-ttu-id="122b7-126">`OnConversationUpdateActivityAsync` 路由所有对话更新活动 `OnInvokeActivityAsync` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-126">`OnConversationUpdateActivityAsync` routes all conversation update activities and `OnInvokeActivityAsync` routes all Teams invoke activities.</span></span>

<span data-ttu-id="122b7-127">若要为 Teams 特定活动处理程序实现逻辑，必须替代自动程序中的方法，如机器人逻辑 [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="122b7-127">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [bot logic](#bot-logic) section.</span></span> <span data-ttu-id="122b7-128">这些处理程序没有基本实现，因此，必须在替代中添加想要的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-128">There is no base implementation for these handlers, therefore, you must add the logic that you want in your override.</span></span>

# <a name="javascript"></a>[<span data-ttu-id="122b7-129">JavaScript</span><span class="sxs-lookup"><span data-stu-id="122b7-129">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="122b7-130">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="122b7-130">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="122b7-131">如果机器人收到消息活动，轮机处理程序将接收该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="122b7-131">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="122b7-132">然后轮次处理程序将传入活动发送到 `onMessage` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-132">The turn handler then sends the incoming activity to the `onMessage` activity handler.</span></span> <span data-ttu-id="122b7-133">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="122b7-133">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="122b7-134">如果机器人收到对话更新活动，则轮机处理程序将接收该传入活动的通知，并将传入活动发送到 `dispatchConversationUpdateActivity` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-134">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `dispatchConversationUpdateActivity`.</span></span> <span data-ttu-id="122b7-135">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-135">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="122b7-136">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-136">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="122b7-137">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序 `dispatchConversationUpdateActivity` 和 `onInvokeActivity` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-137">In the Teams activity handler class, there are two primary Teams activity handlers, `dispatchConversationUpdateActivity` and `onInvokeActivity`.</span></span> <span data-ttu-id="122b7-138">`dispatchConversationUpdateActivity` 路由所有对话更新活动 `onInvokeActivity` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-138">`dispatchConversationUpdateActivity` routes all conversation update activities and `onInvokeActivity` routes all Teams invoke activities.</span></span>

<span data-ttu-id="122b7-139">若要为 Teams 特定活动处理程序实现逻辑，必须替代自动程序中的方法，如机器人逻辑 [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="122b7-139">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [bot logic](#bot-logic) section.</span></span> <span data-ttu-id="122b7-140">为这些处理程序定义自动程序逻辑，然后确保在末尾 `next()` 调用。</span><span class="sxs-lookup"><span data-stu-id="122b7-140">Define your bot logic for these handlers, then be sure to call `next()` at the end.</span></span> <span data-ttu-id="122b7-141">通过 `next()` 调用 ，可确保下一个处理程序运行。</span><span class="sxs-lookup"><span data-stu-id="122b7-141">By calling `next()` you ensure that the next handler runs.</span></span>

# <a name="python"></a>[<span data-ttu-id="122b7-142">Python</span><span class="sxs-lookup"><span data-stu-id="122b7-142">Python</span></span>](#tab/python)

<span data-ttu-id="122b7-143">自动程序是使用 Bot Framework 创建的。</span><span class="sxs-lookup"><span data-stu-id="122b7-143">Bots are created using the Bot Framework.</span></span> <span data-ttu-id="122b7-144">如果机器人收到消息活动，轮机处理程序将接收该传入活动的通知。</span><span class="sxs-lookup"><span data-stu-id="122b7-144">If the bots receive a message activity, then the turn handler receives a notification of that incoming activity.</span></span> <span data-ttu-id="122b7-145">然后轮次处理程序将传入活动发送到 `on_message_activity` 活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-145">The turn handler then sends the incoming activity to the `on_message_activity` activity handler.</span></span> <span data-ttu-id="122b7-146">在 Teams 中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="122b7-146">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="122b7-147">如果机器人收到对话更新活动，则轮机处理程序将接收该传入活动的通知，并将传入活动发送到 `on_conversation_update_activity` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-147">If the bot receives a conversation update activity, then the turn handler receives a notification of that incoming activity and sends the incoming activity to `on_conversation_update_activity`.</span></span> <span data-ttu-id="122b7-148">Teams 活动处理程序首先检查任何 Teams 特定事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-148">The Teams activity handler first checks for any Teams specific events.</span></span> <span data-ttu-id="122b7-149">如果未找到任何事件，它会将它们传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-149">If no events are found, it then passes them along to the Bot Framework's activity handler.</span></span>

<span data-ttu-id="122b7-150">在 Teams 活动处理程序类中，有两个主要的 Teams 活动处理程序 `on_conversation_update_activity` 和 `on_invoke_activity` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-150">In the Teams activity handler class, there are two primary Teams activity handlers, `on_conversation_update_activity` and `on_invoke_activity`.</span></span> <span data-ttu-id="122b7-151">`on_conversation_update_activity` 路由所有对话更新活动 `on_invoke_activity` ，并路由所有 Teams 调用活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-151">`on_conversation_update_activity` routes all conversation update activities and `on_invoke_activity` routes all Teams invoke activities.</span></span>

<span data-ttu-id="122b7-152">若要为 Teams 特定活动处理程序实现逻辑，必须替代自动程序中的方法，如机器人逻辑 [部分](#bot-logic) 所示。</span><span class="sxs-lookup"><span data-stu-id="122b7-152">To implement your logic for Teams specific activity handlers, you must override the methods in your bot as shown in the [bot logic](#bot-logic) section.</span></span> <span data-ttu-id="122b7-153">这些处理程序没有基本实现，因此，必须在替代中添加想要的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-153">There is no base implementation for these handlers, therefore, you must add the logic that you want in your override.</span></span>

---

## <a name="bot-logic"></a><span data-ttu-id="122b7-154">自动程序逻辑</span><span class="sxs-lookup"><span data-stu-id="122b7-154">Bot logic</span></span>

<span data-ttu-id="122b7-155">机器人逻辑处理来自一个或多个自动程序通道的传入活动，并响应生成传出活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-155">The bot logic processes incoming activities from one or more of your bot channels and in response generates outgoing activities.</span></span> <span data-ttu-id="122b7-156">对于从 Teams 活动处理程序类派生的机器人，这一点仍然成立，此类首先会检查 Teams 活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-156">This is still true of bots derived from the Teams activity handler class, which first checks for Teams activities.</span></span> <span data-ttu-id="122b7-157">检查 Teams 活动后，它会将所有其他活动传递给 Bot Framework 的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-157">After checking for Teams activities, it passes all other activities to the Bot Framework's activity handler.</span></span>

# <a name="c"></a>[<span data-ttu-id="122b7-158">C#</span><span class="sxs-lookup"><span data-stu-id="122b7-158">C#</span></span>](#tab/csharp)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="122b7-159">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-159">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="122b7-160">除了添加 **和\*\*\*\*删除** 的成员的活动之外，本节中所述的所有活动处理程序将继续像处理非 Teams 机器人一样工作。</span><span class="sxs-lookup"><span data-stu-id="122b7-160">Except for the **added** and **removed** members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="122b7-161">活动处理程序在团队的上下文中有所不同，其中将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="122b7-161">Activity handlers are different in context of a team, where a new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="122b7-162">中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-162">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="122b7-163">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-163">Event</span></span> | <span data-ttu-id="122b7-164">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-164">Handler</span></span> | <span data-ttu-id="122b7-165">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-165">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-166">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-166">Any activity type received</span></span> | `OnTurnAsync` | <span data-ttu-id="122b7-167">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="122b7-167">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="122b7-168">收到的邮件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-168">Message activity received</span></span> | `OnMessageActivityAsync` | <span data-ttu-id="122b7-169">可以重写此方法以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-169">This method can be overridden to handle a `Message` activity.</span></span> |
| <span data-ttu-id="122b7-170">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="122b7-170">Conversation update activity received</span></span> | `OnConversationUpdateActivityAsync` | <span data-ttu-id="122b7-171">如果活动上除机器人加入或离开对话的成员外，此方法将调用 `ConversationUpdate` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-171">This method calls a handler if members other than the bot joined or left the conversation, on a `ConversationUpdate` activity.</span></span> |
| <span data-ttu-id="122b7-172">非自动程序成员已加入对话</span><span class="sxs-lookup"><span data-stu-id="122b7-172">Non-bot members joined the conversation</span></span> | `OnMembersAddedAsync` | <span data-ttu-id="122b7-173">可以重写此方法以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-173">This method can be overridden to handle members joining a conversation.</span></span> |
| <span data-ttu-id="122b7-174">非自动程序成员离开对话</span><span class="sxs-lookup"><span data-stu-id="122b7-174">Non-bot members left the conversation</span></span> | `OnMembersRemovedAsync` | <span data-ttu-id="122b7-175">可以重写此方法以处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-175">This method can be overridden to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="122b7-176">收到的事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-176">Event activity received</span></span> | `OnEventActivityAsync` | <span data-ttu-id="122b7-177">此方法在活动上调用特定于事件类型的 `Event` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-177">This method calls a handler specific to the event type, on an `Event` activity.</span></span> |
| <span data-ttu-id="122b7-178">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-178">Token-response event activity received</span></span> | `OnTokenResponseEventAsync` | <span data-ttu-id="122b7-179">可以重写此方法以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-179">This method can be overridden to handle token response events.</span></span> |
| <span data-ttu-id="122b7-180">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-180">Non-token-response event activity received</span></span> | `OnEventAsync` | <span data-ttu-id="122b7-181">可以重写此方法以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-181">This method can be overridden to handle other types of events.</span></span> |
| <span data-ttu-id="122b7-182">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-182">Other activity type received</span></span> | `OnUnrecognizedActivityTypeAsync` | <span data-ttu-id="122b7-183">可以重写此方法以处理任何活动类型，否则无法处理。</span><span class="sxs-lookup"><span data-stu-id="122b7-183">This method can be overridden to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="122b7-184">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-184">Teams specific activity handlers</span></span>

<span data-ttu-id="122b7-185">`TeamsActivityHandler`扩展核心 Bot Framework 处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="122b7-185">The `TeamsActivityHandler` extends the list of handlers in the core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="122b7-186">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-186">Event</span></span> | <span data-ttu-id="122b7-187">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-187">Handler</span></span> | <span data-ttu-id="122b7-188">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-188">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-189">channelCreated</span><span class="sxs-lookup"><span data-stu-id="122b7-189">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="122b7-190">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-190">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="122b7-191">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-191">For more information, see [channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-192">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="122b7-192">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="122b7-193">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-193">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="122b7-194">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted)[中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-194">For more information, see [channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-195">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-195">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="122b7-196">可以重写此方法以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-196">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="122b7-197">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 中 [重命名的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-197">For more information, see [channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-198">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-198">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="122b7-199">`return Task.CompletedTask;` 可以重写此方法来处理要重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="122b7-199">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="122b7-200">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 中 [重命名的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-200">For more information, see [team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-201">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="122b7-201">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="122b7-202">此方法在 `OnMembersAddedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-202">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-203">可以重写 方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-203">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="122b7-204">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-204">For more information, see [team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-205">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="122b7-205">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="122b7-206">此方法在 `OnMembersRemovedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-206">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-207">可以重写 方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-207">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="122b7-208">有关详细信息，请参阅对话[更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed)[的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-208">For more information, see [team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="122b7-209">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="122b7-209">Teams invoke activities</span></span>

<span data-ttu-id="122b7-210">从 Teams 活动处理程序调用的 `OnInvokeActivityAsync` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-210">The list of Teams activity handlers called from the `OnInvokeActivityAsync` Teams activity handler include the following:</span></span>

| <span data-ttu-id="122b7-211">调用类型</span><span class="sxs-lookup"><span data-stu-id="122b7-211">Invoke types</span></span>                    | <span data-ttu-id="122b7-212">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-212">Handler</span></span>                              | <span data-ttu-id="122b7-213">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-213">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="122b7-214">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-214">CardAction.Invoke</span></span>               | `OnTeamsCardActionInvokeAsync`       | <span data-ttu-id="122b7-215">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-215">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-216">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-216">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAcceptAsync`      | <span data-ttu-id="122b7-217">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-217">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="122b7-218">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-218">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAsync`            | <span data-ttu-id="122b7-219">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-219">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-220">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-220">fileConsent/invoke</span></span>              | `OnTeamsFileConsentDeclineAsync`     | <span data-ttu-id="122b7-221">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-221">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="122b7-222">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="122b7-222">actionableMessage/executeAction</span></span> | `OnTeamsO365ConnectorCardActionAsync` | <span data-ttu-id="122b7-223">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-223">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-224">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="122b7-224">signin/verifyState</span></span>              | `OnTeamsSigninVerifyStateAsync`      | <span data-ttu-id="122b7-225">当 signIn 验证从连接器收到状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-225">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-226">task/fetch</span><span class="sxs-lookup"><span data-stu-id="122b7-226">task/fetch</span></span>                      | `OnTeamsTaskModuleFetchAsync`        | <span data-ttu-id="122b7-227">此方法可以在派生类中重写，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-227">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="122b7-228">task/submit</span><span class="sxs-lookup"><span data-stu-id="122b7-228">task/submit</span></span>                     | `OnTeamsTaskModuleSubmitAsync`       | <span data-ttu-id="122b7-229">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-229">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="122b7-230">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="122b7-230">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="122b7-231">Bot Framework SDK 还支持调用特定于消息传递扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-231">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="122b7-232">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="122b7-232">For more information, see [what are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

# <a name="javascript"></a>[<span data-ttu-id="122b7-233">JavaScript</span><span class="sxs-lookup"><span data-stu-id="122b7-233">JavaScript</span></span>](#tab/javascript)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="122b7-234">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-234">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="122b7-235">除了添加 **和\*\*\*\*删除** 的成员的活动之外，本节中所述的所有活动处理程序将继续像处理非 Teams 机器人一样工作。</span><span class="sxs-lookup"><span data-stu-id="122b7-235">Except for the **added** and **removed** members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="122b7-236">活动处理程序在团队的上下文中有所不同，其中，将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="122b7-236">Activity handlers are different in context of a team, where the new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="122b7-237">中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-237">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="122b7-238">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-238">Event</span></span> | <span data-ttu-id="122b7-239">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-239">Handler</span></span> | <span data-ttu-id="122b7-240">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-240">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-241">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-241">Any activity type received</span></span> | `onTurn` | <span data-ttu-id="122b7-242">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="122b7-242">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="122b7-243">收到的邮件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-243">Message activity received</span></span> | `onMessage` | <span data-ttu-id="122b7-244">此方法有助于处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-244">This method helps to handle a `Message` activity.</span></span> |
| <span data-ttu-id="122b7-245">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="122b7-245">Conversation update activity received</span></span> | `onConversationUpdate` | <span data-ttu-id="122b7-246">如果活动上除机器人加入或离开对话的成员外，此方法将调用 `ConversationUpdate` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-246">This method calls a handler if members other than the bot joined or left the conversation, on a `ConversationUpdate` activity.</span></span> |
| <span data-ttu-id="122b7-247">非自动程序成员已加入对话</span><span class="sxs-lookup"><span data-stu-id="122b7-247">Non-bot members joined the conversation</span></span> | `onMembersAdded` | <span data-ttu-id="122b7-248">此方法有助于处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-248">This method helps to handle members joining a conversation.</span></span> |
| <span data-ttu-id="122b7-249">非自动程序成员离开对话</span><span class="sxs-lookup"><span data-stu-id="122b7-249">Non-bot members left the conversation</span></span> | `onMembersRemoved` | <span data-ttu-id="122b7-250">此方法有助于处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-250">This method helps to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="122b7-251">收到的事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-251">Event activity received</span></span> | `onEvent` | <span data-ttu-id="122b7-252">此方法在活动上调用特定于事件类型的 `Event` 处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-252">This method calls a handler specific to the event type, on an `Event` activity.</span></span> |
| <span data-ttu-id="122b7-253">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-253">Token-response event activity received</span></span> | `onTokenResponseEvent` | <span data-ttu-id="122b7-254">此方法有助于处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-254">This method helps to handle token response events.</span></span> |
| <span data-ttu-id="122b7-255">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-255">Other activity type received</span></span> | `onUnrecognizedActivityType` | <span data-ttu-id="122b7-256">此方法有助于处理未经处理的任何活动类型。</span><span class="sxs-lookup"><span data-stu-id="122b7-256">This method helps to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="122b7-257">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-257">Teams specific activity handlers</span></span>

<span data-ttu-id="122b7-258">`TeamsActivityHandler`扩展核心 Bot Framework 处理程序部分中的处理程序列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="122b7-258">The `TeamsActivityHandler` extends the list of handlers in the core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="122b7-259">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-259">Event</span></span> | <span data-ttu-id="122b7-260">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-260">Handler</span></span> | <span data-ttu-id="122b7-261">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-261">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-262">channelCreated</span><span class="sxs-lookup"><span data-stu-id="122b7-262">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="122b7-263">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-263">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="122b7-264">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-264">For more information, see [channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-265">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="122b7-265">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="122b7-266">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-266">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="122b7-267">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted)[中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-267">For more information, see [channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-268">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-268">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="122b7-269">可以重写此方法以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-269">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="122b7-270">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 中 [重命名的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-270">For more information, see [channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-271">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-271">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="122b7-272">`return Task.CompletedTask;` 可以重写此方法来处理要重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="122b7-272">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="122b7-273">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 中 [重命名的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-273">For more information, see [team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-274">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="122b7-274">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="122b7-275">此方法在 `OnMembersAddedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-275">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-276">可以重写 方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-276">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="122b7-277">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-277">For more information, see [team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-278">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="122b7-278">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="122b7-279">此方法在 `OnMembersRemovedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-279">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-280">可以重写 方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-280">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="122b7-281">有关详细信息，请参阅对话[更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed)[的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-281">For more information, see [team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |

#### <a name="teams-invoke-activities"></a><span data-ttu-id="122b7-282">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="122b7-282">Teams invoke activities</span></span>

<span data-ttu-id="122b7-283">从 Teams 活动处理程序调用的 `onInvokeActivity` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-283">The list of Teams activity handlers called from the `onInvokeActivity` Teams activity handler include the following:</span></span>

| <span data-ttu-id="122b7-284">调用类型</span><span class="sxs-lookup"><span data-stu-id="122b7-284">Invoke types</span></span>                    | <span data-ttu-id="122b7-285">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-285">Handler</span></span>                              | <span data-ttu-id="122b7-286">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-286">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="122b7-287">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-287">CardAction.Invoke</span></span>               | `handleTeamsCardActionInvoke`       | <span data-ttu-id="122b7-288">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-288">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-289">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-289">fileConsent/invoke</span></span>              | `handleTeamsFileConsentAccept`      | <span data-ttu-id="122b7-290">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-290">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="122b7-291">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-291">fileConsent/invoke</span></span>              | `handleTeamsFileConsent`            | <span data-ttu-id="122b7-292">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-292">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-293">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-293">fileConsent/invoke</span></span>              | `handleTeamsFileConsentDecline`     | <span data-ttu-id="122b7-294">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-294">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="122b7-295">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="122b7-295">actionableMessage/executeAction</span></span> | `handleTeamsO365ConnectorCardAction` | <span data-ttu-id="122b7-296">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-296">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-297">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="122b7-297">signin/verifyState</span></span>              | `handleTeamsSigninVerifyState`      | <span data-ttu-id="122b7-298">当 signIn 验证从连接器收到状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-298">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-299">task/fetch</span><span class="sxs-lookup"><span data-stu-id="122b7-299">task/fetch</span></span>                      | `handleTeamsTaskModuleFetch`        | <span data-ttu-id="122b7-300">此方法可以在派生类中重写，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-300">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="122b7-301">task/submit</span><span class="sxs-lookup"><span data-stu-id="122b7-301">task/submit</span></span>                     | `handleTeamsTaskModuleSubmit`       | <span data-ttu-id="122b7-302">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-302">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="122b7-303">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="122b7-303">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="122b7-304">Bot Framework SDK 还支持调用特定于消息传递扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-304">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="122b7-305">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="122b7-305">For more information, see [what are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

# <a name="python"></a>[<span data-ttu-id="122b7-306">Python</span><span class="sxs-lookup"><span data-stu-id="122b7-306">Python</span></span>](#tab/python)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="122b7-307">核心 Bot Framework 处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-307">Core Bot Framework handlers</span></span>

>[!NOTE]
> <span data-ttu-id="122b7-308">除了添加 **和\*\*\*\*删除** 的成员的活动之外，本节中所述的所有活动处理程序将继续像处理非 Teams 机器人一样工作。</span><span class="sxs-lookup"><span data-stu-id="122b7-308">Except for the **added** and **removed** members' activities, all the activity handlers described in this section continue to work as they do with a non-Teams bot.</span></span>

<span data-ttu-id="122b7-309">活动处理程序在团队的上下文中有所不同，其中，将新成员添加到团队，而不是消息线程。</span><span class="sxs-lookup"><span data-stu-id="122b7-309">Activity handlers are different in context of a team, where the new member is added to the team instead of a message thread.</span></span>

<span data-ttu-id="122b7-310">中定义的处理程序列表 `ActivityHandler` 包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-310">The list of handlers defined in `ActivityHandler` include the following:</span></span>

| <span data-ttu-id="122b7-311">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-311">Event</span></span> | <span data-ttu-id="122b7-312">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-312">Handler</span></span> | <span data-ttu-id="122b7-313">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-313">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-314">接收的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-314">Any activity type received</span></span> | `on_turn` | <span data-ttu-id="122b7-315">此方法根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="122b7-315">This method calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="122b7-316">收到的邮件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-316">Message activity received</span></span> | `on_message_activity` | <span data-ttu-id="122b7-317">可以重写此方法以处理 `Message` 活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-317">This method can be overridden to handle a `Message` activity.</span></span> |
| <span data-ttu-id="122b7-318">收到的对话更新活动</span><span class="sxs-lookup"><span data-stu-id="122b7-318">Conversation update activity received</span></span> | `on_conversation_update_activity` | <span data-ttu-id="122b7-319">如果除机器人成员外的成员加入或离开对话，此方法将调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-319">This method calls a handler if members other than the bot join or leave the conversation.</span></span> |
| <span data-ttu-id="122b7-320">非自动程序成员已加入对话</span><span class="sxs-lookup"><span data-stu-id="122b7-320">Non-bot members joined the conversation</span></span> | `on_members_added_activity` | <span data-ttu-id="122b7-321">可以重写此方法以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-321">This method can be overridden to handle members joining a conversation.</span></span> |
| <span data-ttu-id="122b7-322">非自动程序成员离开对话</span><span class="sxs-lookup"><span data-stu-id="122b7-322">Non-bot members left the conversation</span></span> | `on_members_removed_activity` | <span data-ttu-id="122b7-323">可以重写此方法以处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-323">This method can be overridden to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="122b7-324">收到的事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-324">Event activity received</span></span> | `on_event_activity` | <span data-ttu-id="122b7-325">此方法调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="122b7-325">This method calls a handler specific to the type of event.</span></span> |
| <span data-ttu-id="122b7-326">收到的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-326">Token-response event activity received</span></span> | `on_token_response_event` | <span data-ttu-id="122b7-327">可以重写此方法以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-327">This method can be overridden to handle token response events.</span></span> |
| <span data-ttu-id="122b7-328">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="122b7-328">Non-token-response event activity received</span></span> | `on_event` | <span data-ttu-id="122b7-329">可以重写此方法以处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="122b7-329">This method can be overridden to handle other types of events.</span></span> |
| <span data-ttu-id="122b7-330">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="122b7-330">Other activity types received</span></span> | `on_unrecognized_activity_type` | <span data-ttu-id="122b7-331">可以重写此方法以处理任何未处理的活动类型。</span><span class="sxs-lookup"><span data-stu-id="122b7-331">This method can be overridden to handle any type of activity that is not handled.</span></span> |

#### <a name="teams-specific-activity-handlers"></a><span data-ttu-id="122b7-332">Teams 特定活动处理程序</span><span class="sxs-lookup"><span data-stu-id="122b7-332">Teams specific activity handlers</span></span>

<span data-ttu-id="122b7-333">扩展核心 Bot Framework 处理程序部分中的处理程序 `TeamsActivityHandler` 列表，以包括以下内容：</span><span class="sxs-lookup"><span data-stu-id="122b7-333">The `TeamsActivityHandler` extends the list of handlers from the core Bot Framework handlers section to include the following:</span></span>

| <span data-ttu-id="122b7-334">事件</span><span class="sxs-lookup"><span data-stu-id="122b7-334">Event</span></span> | <span data-ttu-id="122b7-335">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-335">Handler</span></span> | <span data-ttu-id="122b7-336">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-336">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="122b7-337">channelCreated</span><span class="sxs-lookup"><span data-stu-id="122b7-337">channelCreated</span></span> | `on_teams_channel_created` | <span data-ttu-id="122b7-338">可以重写此方法以处理正在创建的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-338">This method can be overridden to handle a Teams channel being created.</span></span> <span data-ttu-id="122b7-339">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)[中创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-339">For more information, see [channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="122b7-340">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="122b7-340">channelDeleted</span></span> | `on_teams_channel_deleted` | <span data-ttu-id="122b7-341">可以重写此方法以处理要删除的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-341">This method can be overridden to handle a Teams channel being deleted.</span></span> <span data-ttu-id="122b7-342">有关详细信息，请参阅对话[更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted)[中删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-342">For more information, see [channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-343">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-343">channelRenamed</span></span> | `on_teams_channel_renamed` | <span data-ttu-id="122b7-344">可以重写此方法以处理正在重命名的 Teams 频道。</span><span class="sxs-lookup"><span data-stu-id="122b7-344">This method can be overridden to handle a Teams channel being renamed.</span></span> <span data-ttu-id="122b7-345">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) 中 [重命名的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-345">For more information, see [channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-346">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="122b7-346">teamRenamed</span></span> | `on_teams_team_renamed` | <span data-ttu-id="122b7-347">`return Task.CompletedTask;` 可以重写此方法来处理要重命名的 Teams 团队。</span><span class="sxs-lookup"><span data-stu-id="122b7-347">`return Task.CompletedTask;` This method can be overridden to handle a Teams team being renamed.</span></span> <span data-ttu-id="122b7-348">有关详细信息，请参阅对话 [更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) 中 [重命名的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-348">For more information, see [team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-349">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="122b7-349">MembersAdded</span></span> | `on_teams_members_added` | <span data-ttu-id="122b7-350">此方法在 `OnMembersAddedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-350">This method calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-351">可以重写 方法以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-351">The method can be overridden to handle members joining a team.</span></span> <span data-ttu-id="122b7-352">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added)[中添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-352">For more information, see [team members added](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-added) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="122b7-353">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="122b7-353">MembersRemoved</span></span> | `on_teams_members_removed` | <span data-ttu-id="122b7-354">此方法在 `OnMembersRemovedAsync` 中调用 方法 `ActivityHandler` 。</span><span class="sxs-lookup"><span data-stu-id="122b7-354">This method calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="122b7-355">可以重写 方法以处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="122b7-355">The method can be overridden to handle members leaving a team.</span></span> <span data-ttu-id="122b7-356">有关详细信息，请参阅对话[更新事件中删除](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed)[的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events)。</span><span class="sxs-lookup"><span data-stu-id="122b7-356">For more information, see [team members removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-members-removed) in [conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke-activities"></a><span data-ttu-id="122b7-357">Teams 调用活动</span><span class="sxs-lookup"><span data-stu-id="122b7-357">Teams invoke activities</span></span>

<span data-ttu-id="122b7-358">从 Teams 活动处理程序调用的 `on_invoke_activity` Teams 活动处理程序列表包括：</span><span class="sxs-lookup"><span data-stu-id="122b7-358">The list of Teams activity handlers called from the `on_invoke_activity` Teams activity handler include the following:</span></span>

| <span data-ttu-id="122b7-359">调用类型</span><span class="sxs-lookup"><span data-stu-id="122b7-359">Invoke types</span></span>                    | <span data-ttu-id="122b7-360">Handler</span><span class="sxs-lookup"><span data-stu-id="122b7-360">Handler</span></span>                              | <span data-ttu-id="122b7-361">说明</span><span class="sxs-lookup"><span data-stu-id="122b7-361">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="122b7-362">CardAction.Invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-362">CardAction.Invoke</span></span>               | `on_teams_card_action_invoke`       | <span data-ttu-id="122b7-363">从连接器接收卡片操作调用活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-363">This method is invoked when a card action invoke activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-364">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-364">fileConsent/invoke</span></span>              | `on_teams_file_consent_accept`      | <span data-ttu-id="122b7-365">当用户接受文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-365">This method is invoked when a file consent card is accepted by the user.</span></span> |
| <span data-ttu-id="122b7-366">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-366">fileConsent/invoke</span></span>              | `on_teams_file_consent`            | <span data-ttu-id="122b7-367">从连接器收到文件同意卡活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-367">This method is invoked when a file consent card activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-368">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="122b7-368">fileConsent/invoke</span></span>              | `on_teams_file_consent_decline`     | <span data-ttu-id="122b7-369">当用户拒绝文件同意卡时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-369">This method is invoked when a file consent card is declined by the user.</span></span> |
| <span data-ttu-id="122b7-370">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="122b7-370">actionableMessage/executeAction</span></span> | `on_teams_o365_connector_card_action` | <span data-ttu-id="122b7-371">从连接器接收 O365 连接器卡操作活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-371">This method is invoked when a O365 connector card action activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-372">signin/verifyState</span><span class="sxs-lookup"><span data-stu-id="122b7-372">signin/verifyState</span></span>              | `on_teams_signin_verify_state`      | <span data-ttu-id="122b7-373">当 signIn 验证从连接器收到状态活动时，将调用此方法。</span><span class="sxs-lookup"><span data-stu-id="122b7-373">This method is invoked when a signIn verify state activity is received from the connector.</span></span> |
| <span data-ttu-id="122b7-374">task/fetch</span><span class="sxs-lookup"><span data-stu-id="122b7-374">task/fetch</span></span>                      | `on_teams_task_module_fetch`        | <span data-ttu-id="122b7-375">此方法可以在派生类中重写，以提供提取任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-375">This method can be overridden in a derived class to provide logic when a task module is fetched.</span></span> |
| <span data-ttu-id="122b7-376">task/submit</span><span class="sxs-lookup"><span data-stu-id="122b7-376">task/submit</span></span>                     | `on_teams_task_module_submit`       | <span data-ttu-id="122b7-377">此方法可以在派生类中重写，以提供提交任务模块时的逻辑。</span><span class="sxs-lookup"><span data-stu-id="122b7-377">This method can be overridden in a derived class to provide logic when a task module is submitted.</span></span> |

<span data-ttu-id="122b7-378">本部分中列出的调用活动适用于 Teams 中的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="122b7-378">The invoke activities listed in this section are for conversational bots in Teams.</span></span> <span data-ttu-id="122b7-379">Bot Framework SDK 还支持调用特定于消息传递扩展的活动。</span><span class="sxs-lookup"><span data-stu-id="122b7-379">The Bot Framework SDK also supports invoke activities specific to messaging extensions.</span></span> <span data-ttu-id="122b7-380">有关详细信息，请参阅 [什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)。</span><span class="sxs-lookup"><span data-stu-id="122b7-380">For more information, see [what are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions).</span></span>

---

* * *

<span data-ttu-id="122b7-381">现在，你已经熟悉自动程序活动处理程序，让我们了解聊天机器人的行为方式，具体取决于对话以及它接收或发送的消息。</span><span class="sxs-lookup"><span data-stu-id="122b7-381">Now that you have familiarized yourself with bot activity handlers, let us see how bots behave differently depending on the conversation and the messages it receives or sends.</span></span>

## <a name="next-step"></a><span data-ttu-id="122b7-382">后续步骤</span><span class="sxs-lookup"><span data-stu-id="122b7-382">Next step</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="122b7-383">对话基础知识</span><span class="sxs-lookup"><span data-stu-id="122b7-383">Conversation basics</span></span>](~/bots/how-to/conversations/conversation-basics.md)
