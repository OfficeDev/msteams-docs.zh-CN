---
title: 选项卡的身份验证流
description: 描述选项卡中的身份验证流
keywords: 团队身份验证流选项卡
ms.openlocfilehash: 5ecd4d7d3a2658d17a8c6dea5d73cbd98eb2dfde
ms.sourcegitcommit: bfdcd122b6b4ffc52d92320d4741f870c07f0542
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/02/2020
ms.locfileid: "49552540"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="6e345-104">Microsoft 团队身份验证流（针对选项卡）</span><span class="sxs-lookup"><span data-stu-id="6e345-104">Microsoft Teams authentication flow for tabs</span></span>

> [!Note]
> <span data-ttu-id="6e345-105">若要对移动客户端上的选项卡进行身份验证，您需要确保您至少使用的是1.4.1 版本的团队 JavaScript SDK。</span><span class="sxs-lookup"><span data-stu-id="6e345-105">For authentication to work for your tab on mobile clients, you need to ensure you're using at least the 1.4.1 version of the Teams JavaScript SDK.</span></span>
> <span data-ttu-id="6e345-106">团队 SDK 为身份验证流启动单独的窗口，因此 samesite 属性可以设置为 "不严格"。</span><span class="sxs-lookup"><span data-stu-id="6e345-106">Teams SDK launches separate window for authentication flow and hence samesite attribute can be set to 'Lax'.</span></span> <span data-ttu-id="6e345-107">目前，SameSite = None 不受团队桌面客户端或 Chrome 或 Safari 早期版本的支持。</span><span class="sxs-lookup"><span data-stu-id="6e345-107">Currently, SameSite=None is not supported by the Teams desktop client or older versions of Chrome or Safari.</span></span>

<span data-ttu-id="6e345-108">OAuth 2.0 是一种开放的标准，用于 Azure AD 和许多其他标识提供程序使用的身份验证和授权。</span><span class="sxs-lookup"><span data-stu-id="6e345-108">OAuth 2.0 is an open standard for authentication and authorization used by Azure AD and many other identity providers.</span></span> <span data-ttu-id="6e345-109">对 OAuth 2.0 的基本了解是在团队中使用身份验证的先决条件; [下面是一个很好的概述](https://aaronparecki.com/oauth-2-simplified/) ，比 [正式规范](https://oauth.net/2/)更易于遵循。</span><span class="sxs-lookup"><span data-stu-id="6e345-109">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="6e345-110">选项卡和 bot 的身份验证流略有不同，因为选项卡非常类似于网站，因此可以直接使用 OAuth 2.0;bot 不是，并且必须以不同的方式执行几项操作，但核心概念是相同的。</span><span class="sxs-lookup"><span data-stu-id="6e345-110">Authentication flow for tabs and bots are a little different because tabs are very similar to websites so they can use OAuth 2.0 directly; bots are not and must do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="6e345-111">有关使用 Node 和 [OAuth 2.0 隐式授予类型](https://oauth.net/2/grant-types/implicit/)的选项卡和 bot 的身份验证流示例，*请参阅*[启动身份验证流。](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow)</span><span class="sxs-lookup"><span data-stu-id="6e345-111">*See*, [Initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) for an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/).</span></span>

![选项卡身份验证序列图](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="6e345-113">用户与选项卡配置或内容页上的内容进行交互，通常是一个标记为 "登录" 或 "登录" 的按钮。</span><span class="sxs-lookup"><span data-stu-id="6e345-113">The user interacts with the content on the tab configuration or content page, commonly a button labeled "Sign in" or "Log in".</span></span>
2. <span data-ttu-id="6e345-114">该选项卡构造其授权起始页的 URL，可以选择使用 URL 占位符中的信息，也可以通过调用 `microsoftTeams.getContext()` 团队客户端 SDK 方法来简化用户的身份验证体验。</span><span class="sxs-lookup"><span data-stu-id="6e345-114">The tab constructs the URL for its auth start page, optionally using information from URL placeholders or by calling `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="6e345-115">例如，在使用 Azure AD 进行身份验证时，如果 `login_hint` 将参数设置为用户的电子邮件地址，则用户甚至可能无法登录（如果可能最近这样做），因为如果可能，AZURE AD 将使用用户缓存的凭据：弹出窗口将短暂闪烁，然后消失。</span><span class="sxs-lookup"><span data-stu-id="6e345-115">For example, when authenticating with Azure AD, if the `login_hint` parameter is set to the user's email address, the user may not even have to sign in if they have done so recently, because Azure AD will use the user's cached credentials if possible: the popup will flash briefly and then disappear.</span></span>
3. <span data-ttu-id="6e345-116">然后，该选项卡调用 `microsoftTeams.authentication.authenticate()` 方法并注册 `successCallback` 和 `failureCallback` 函数。</span><span class="sxs-lookup"><span data-stu-id="6e345-116">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="6e345-117">团队在弹出窗口的 iframe 中打开起始页。</span><span class="sxs-lookup"><span data-stu-id="6e345-117">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="6e345-118">起始页生成随机 `state` 数据，并将其保存以供将来验证，并重定向到标识提供程序的 `/authorize` 终结点（如 `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` Azure AD）。</span><span class="sxs-lookup"><span data-stu-id="6e345-118">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="6e345-119">`<tenant id>`将替换为你自己的租户 id (context.subname) 。</span><span class="sxs-lookup"><span data-stu-id="6e345-119">Replace `<tenant id>` with your own tenant id (context.tid).</span></span>
    * <span data-ttu-id="6e345-120">与团队中的其他应用程序身份验证流一样，起始页必须位于其列表中的域中 `validDomains` 和登录后重定向页面所在的同一个域中。</span><span class="sxs-lookup"><span data-stu-id="6e345-120">Like other application auth flows in Teams, the start page must be on a domain that's in its `validDomains` list, and on the same domain as the post-login redirect page.</span></span>
    * <span data-ttu-id="6e345-121">**重要说明**：对身份验证请求中的参数的 OAuth 2.0 隐式授予流调用， `state` 其中包含唯一的会话数据，以防止 [跨站点请求伪造攻击](https://en.wikipedia.org/wiki/Cross-site_request_forgery)。</span><span class="sxs-lookup"><span data-stu-id="6e345-121">**IMPORTANT**: The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="6e345-122">下面的示例对数据使用随机生成的 GUID `state` 。</span><span class="sxs-lookup"><span data-stu-id="6e345-122">The examples below use a randomly-generated GUID for the `state` data.</span></span>
5. <span data-ttu-id="6e345-123">在提供程序的网站上，用户登录并授予对该选项卡的访问权限。</span><span class="sxs-lookup"><span data-stu-id="6e345-123">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="6e345-124">提供程序将用户带访问令牌的选项卡的 OAuth 2.0 重定向页面。</span><span class="sxs-lookup"><span data-stu-id="6e345-124">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="6e345-125">该选项卡将检查返回的 `state` 值是否与先前保存的值匹配，以及调用 `microsoftTeams.authentication.notifySuccess()` ，后者又会调用 `successCallback` 在步骤3中注册的函数。</span><span class="sxs-lookup"><span data-stu-id="6e345-125">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="6e345-126">团队将关闭弹出窗口。</span><span class="sxs-lookup"><span data-stu-id="6e345-126">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="6e345-127">该选项卡显示配置 UI 或刷新或重新加载选项卡内容，具体取决于用户的启动位置。</span><span class="sxs-lookup"><span data-stu-id="6e345-127">The tab either displays configuration UI or refreshes or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="6e345-128">将选项卡上下文视为提示</span><span class="sxs-lookup"><span data-stu-id="6e345-128">Treat tab context as hints</span></span>

<span data-ttu-id="6e345-129">尽管选项卡上下文提供了有关用户的有用信息，但请勿使用此信息对用户进行身份验证，无论您是将其作为 URL 参数获取到您的选项卡内容 URL，还是通过在 `microsoftTeams.getContext()` Microsoft 团队客户端 SDK 中调用该函数。</span><span class="sxs-lookup"><span data-stu-id="6e345-129">Although the tab context provides helpful information regarding the user, don't use this information to authenticate the user whether you get it as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="6e345-130">恶意参与者可以使用其自己的参数调用您的选项卡内容 URL，并且模拟 Microsoft 团队的网页可以在 iframe 中加载您的选项卡内容 URL 并将其自己的数据返回到 `getContext()` 函数中。</span><span class="sxs-lookup"><span data-stu-id="6e345-130">A malicious actor could invoke your tab content URL with its own parameters, and a web page impersonating Microsoft Teams could load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="6e345-131">应在选项卡上下文中将与标识相关的信息简单地视为提示，并在使用之前对其进行验证。</span><span class="sxs-lookup"><span data-stu-id="6e345-131">You should treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="6e345-132">请参阅 [从弹出页面导航到 "授权" 页面](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)中的注释。</span><span class="sxs-lookup"><span data-stu-id="6e345-132">Refer to the notes in [Navigate to the authorization page from your popup page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="samples"></a><span data-ttu-id="6e345-133">示例</span><span class="sxs-lookup"><span data-stu-id="6e345-133">Samples</span></span>

<span data-ttu-id="6e345-134">有关显示 tab 验证过程的示例代码，请参阅：</span><span class="sxs-lookup"><span data-stu-id="6e345-134">For sample code showing the tab authentication process see:</span></span>

* [<span data-ttu-id="6e345-135">Microsoft 团队选项卡身份验证示例 (节点) </span><span class="sxs-lookup"><span data-stu-id="6e345-135">Microsoft Teams tab authentication sample (Node)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [<span data-ttu-id="6e345-136">Microsoft (c # ) 的 "团队" 选项卡身份验证示例 </span><span class="sxs-lookup"><span data-stu-id="6e345-136">Microsoft Teams tab authentication sample (C#)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a><span data-ttu-id="6e345-137">更多详细信息</span><span class="sxs-lookup"><span data-stu-id="6e345-137">More details</span></span>

<span data-ttu-id="6e345-138">有关针对 Azure Active Directory 进行选项卡身份验证的详细实施演练，请参阅：</span><span class="sxs-lookup"><span data-stu-id="6e345-138">For a detailed implementation walkthrough for tab authentication targeting Azure Active Directory see:</span></span>

* [<span data-ttu-id="6e345-139">在 Microsoft 团队选项卡中对用户进行身份验证</span><span class="sxs-lookup"><span data-stu-id="6e345-139">Authenticate a user in a Microsoft Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="6e345-140">无提示的身份验证</span><span class="sxs-lookup"><span data-stu-id="6e345-140">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
