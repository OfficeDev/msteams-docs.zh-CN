---
title: 'Microsoft Teams 2020 更新 (和 SameSite cookie) '
author: laujan
description: 描述 SameSite Cookie 的属性
keywords: cookie 属性 samesite
ms.topic: reference
localization_priority: Normal
ms.author: lomeybur
ms.openlocfilehash: 1841e349f3da61c6f8077e5a56874989aa6212ca
ms.sourcegitcommit: 25c9ad27f99682caaa7347840578b118c63b8f69
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/30/2021
ms.locfileid: "52101812"
---
# <a name="microsoft-teams-and-the-samesite-cookie-attribute-2020-update"></a><span data-ttu-id="b3bfb-104">Microsoft Teams 2020 更新 (和 SameSite cookie) </span><span class="sxs-lookup"><span data-stu-id="b3bfb-104">Microsoft Teams and the SameSite cookie attribute (2020 update)</span></span>

## <a name="cookies-in-brief"></a><span data-ttu-id="b3bfb-105">简短 Cookie</span><span class="sxs-lookup"><span data-stu-id="b3bfb-105">Cookies in brief</span></span>

 <span data-ttu-id="b3bfb-106">Cookie 是文本字符串，从网站发送，并且由 Web 浏览器存储在计算机上。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-106">Cookies are text strings, sent from websites, and stored on a computer by the web browser.</span></span> <span data-ttu-id="b3bfb-107">它们通常用于身份验证和个性化设置，例如，重新调用有状态的信息、保留用户设置、记录浏览活动以及显示相关广告。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-107">They're typically used for authentication and personalization, e.g., recalling stateful information, preserving user settings, recording browsing activity, and displaying relevant ads.</span></span> <span data-ttu-id="b3bfb-108">Cookie 始终链接到特定域，并且可能由各方安装。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-108">Cookies are always linked to a particular domain and can be installed by various parties.</span></span> <span data-ttu-id="b3bfb-109">它们按以下方式分类：</span><span class="sxs-lookup"><span data-stu-id="b3bfb-109">They are categorized as follows:</span></span>

 |<span data-ttu-id="b3bfb-110">Cookie</span><span class="sxs-lookup"><span data-stu-id="b3bfb-110">Cookie</span></span>|<span data-ttu-id="b3bfb-111">范围</span><span class="sxs-lookup"><span data-stu-id="b3bfb-111">Scope</span></span>|
 | ------ | ------ |
 |<span data-ttu-id="b3bfb-112">**第一方 Cookie**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-112">**First-party cookie**</span></span>|<span data-ttu-id="b3bfb-113">第一方 Cookie 由用户访问的网站创建，用于保存数据，如购物车项目、登录凭据 (例如身份验证 cookie) 和其他分析。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-113">A first-party cookie is created by websites that a user visits and is used to save data such as shopping cart items, login credentials (e.g., authentication cookies), and other analytics.</span></span>|
 |<span data-ttu-id="b3bfb-114">**第二方 Cookie**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-114">**Second-party cookie**</span></span>|<span data-ttu-id="b3bfb-115">从技术上说，第二方 Cookie 和第一方 Cookie 相同。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-115">A second-party cookies is technically the same as a first-party  cookie.</span></span> <span data-ttu-id="b3bfb-116">区别在于，数据通过数据合作关系协议（例如， (分析和报告协议Microsoft Teams[第](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference)二方) 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-116">The difference is that data is shared with a second party via a data partnership agreement (e.g., [Microsoft Teams analytics and reporting](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference)).</span></span> |
 |<span data-ttu-id="b3bfb-117">**第三方 Cookie**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-117">**Third-party cookie**</span></span>|<span data-ttu-id="b3bfb-118">第三方 Cookie 由用户显式访问的域外的其他域安装，主要用于跟踪 (例如"喜欢"按钮) 、广告服务以及实时聊天。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-118">A third-party cookie is installed by a domain other than the one the user explicitly visited and is mainly used for tracking (e.g. "Like" buttons), ad serving, and live chats.</span></span>|

### <a name="cookies-and-http-requests"></a><span data-ttu-id="b3bfb-119">Cookie 和 HTTP 请求</span><span class="sxs-lookup"><span data-stu-id="b3bfb-119">Cookies and HTTP requests</span></span>

<span data-ttu-id="b3bfb-120">在引入 SameSite 限制之前，当 Cookie 存储在浏览器中时，它们附加到每个 *HTTP* Web 请求，然后由 Set-Cookie HTTP 响应标头发送到服务器。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-120">Before the introduction of SameSite restrictions, when cookies were stored on the browser, they were attached to *every* HTTP web request and sent to the server by the Set-Cookie HTTP response header.</span></span> <span data-ttu-id="b3bfb-121">可以预测，该性能可能会引入安全漏洞，如跨站点请求伪造和 CSRF (攻击) 攻击。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-121">Predictably, that performance had the potential to introduce security vulnerabilities such as Cross-Site Request Forgery (CSRF) attacks.</span></span> <span data-ttu-id="b3bfb-122">*请参阅* [HTTP Cookie。](https://developer.mozilla.org/docs/Web/HTTP/Cookies)</span><span class="sxs-lookup"><span data-stu-id="b3bfb-122">*See* [HTTP cookies](https://developer.mozilla.org/docs/Web/HTTP/Cookies).</span></span> <span data-ttu-id="b3bfb-123">SameSite 组件通过 SetCookie 标头中的实现和管理缓解了曝光。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-123">The SameSite component mitigated that exposure through its implementation and management in the SetCookie header.</span></span>

### <a name="samesite-attribute-initial-release"></a><span data-ttu-id="b3bfb-124">SameSite 属性：初始版本</span><span class="sxs-lookup"><span data-stu-id="b3bfb-124">SameSite attribute: initial release</span></span>

<span data-ttu-id="b3bfb-125">Google Chrome 版本 51 引入了 SetCookie SameSite 规范作为 *可选* 属性。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-125">Google Chrome version 51 introduced the SetCookie SameSite specification as an *optional* attribute.</span></span> <span data-ttu-id="b3bfb-126">从内部版本 17672 开始，Windows 10为浏览器引入了 SameSite [cookie Microsoft Edge支持](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/)。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-126">Starting with Build 17672, Windows 10 introduced SameSite cookie support for the [Microsoft Edge browser](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/).</span></span>

<span data-ttu-id="b3bfb-127">开发人员可以选择不将 SameSite Cookie 属性添加到 SetCookie 标头，或者他们可以通过以下两个设置之一添加该属性 *：Lax* 和 *Strict*。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-127">Developers could opt out of adding the SameSite cookie attribute to the SetCookie header or they could add it with one of two settings, *Lax* and *Strict*.</span></span> <span data-ttu-id="b3bfb-128">未启用的 SameSite 属性被视为默认状态。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-128">An unimplemented SameSite attribute was considered the default state.</span></span>

## <a name="samesite-cookie-attribute-2020-release"></a><span data-ttu-id="b3bfb-129">SameSite Cookie 属性：2020 版本</span><span class="sxs-lookup"><span data-stu-id="b3bfb-129">SameSite cookie attribute: 2020 release</span></span>

<span data-ttu-id="b3bfb-130">Chrome 80 计划于 2020 年 2 月发布，引入了新的 Cookie 值，并默认实施 Cookie 策略。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-130">Chrome 80, scheduled for release in February 2020, introduces new cookie values and imposes cookie policies by default.</span></span> <span data-ttu-id="b3bfb-131">可以将三个值传递到更新的 SameSite 属性 *：Strict、Lax* 或 *None*。 </span><span class="sxs-lookup"><span data-stu-id="b3bfb-131">Three values can be passed into the updated SameSite attribute: *Strict*, *Lax*, or *None*.</span></span> <span data-ttu-id="b3bfb-132">未指定 SameSite 属性的 Cookie 将默认为 `SameSite=Lax` 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-132">Cookies that don't specify the SameSite attribute will default to `SameSite=Lax`.</span></span>

|<span data-ttu-id="b3bfb-133">Setting</span><span class="sxs-lookup"><span data-stu-id="b3bfb-133">Setting</span></span> | <span data-ttu-id="b3bfb-134">强制</span><span class="sxs-lookup"><span data-stu-id="b3bfb-134">Enforcement</span></span> | <span data-ttu-id="b3bfb-135">值</span><span class="sxs-lookup"><span data-stu-id="b3bfb-135">Value</span></span> |<span data-ttu-id="b3bfb-136">属性规范</span><span class="sxs-lookup"><span data-stu-id="b3bfb-136">Attribute Specification</span></span> |
| -------- | ----------- | --------|--------|
| <span data-ttu-id="b3bfb-137">**Lax**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-137">**Lax**</span></span>  | <span data-ttu-id="b3bfb-138">Cookie 仅在第一方上下文中和HTTP GET 请求中自动发送。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-138">Cookies will be sent automatically only in a *first-party* context and with HTTP GET requests.</span></span> <span data-ttu-id="b3bfb-139">SameSite Cookie 将在跨站点子请求（如调用加载图像或 iframe）上被保留，但在用户从外部网站导航到 URL 时（例如，通过以下链接）发送。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-139">SameSite cookies will be withheld on cross-site sub-requests, such as calls to load images or iframes, but will be sent when a user navigates to the URL from an external site, for example, by following a link.</span></span>| <span data-ttu-id="b3bfb-140">**默认**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-140">**Default**</span></span> |`Set-Cookie: key=value; SameSite=Lax`|
| <span data-ttu-id="b3bfb-141">**Strict**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-141">**Strict**</span></span> |<span data-ttu-id="b3bfb-142">浏览器仅发送来自将 cookie 设置为 (的网站的第一方上下文请求的) 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-142">The browser will only send cookies for first-party context requests (requests originating from the site that set the cookie).</span></span> <span data-ttu-id="b3bfb-143">如果请求来自与当前位置不同的 URL，则不发送任何用 属性标记 `Strict` 的 Cookie。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-143">If the request originated from a different URL than that of the current location, none of the cookies tagged with the `Strict` attribute will be sent.</span></span>| <span data-ttu-id="b3bfb-144">可选</span><span class="sxs-lookup"><span data-stu-id="b3bfb-144">Optional</span></span> |`Set-Cookie: key=value; SameSite=Strict`|
| <span data-ttu-id="b3bfb-145">**无**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-145">**None**</span></span> | <span data-ttu-id="b3bfb-146">Cookie 将在第一方上下文和跨源请求中发送;但是，该值必须显式设置为 ，并且所有浏览器请求都必须遵循 HTTPS 协议并包括需要加密连接 **`None`**  **`Secure`** 的属性。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-146">Cookies will be sent in both first-party context and cross-origin requests; however, the value must be explicitly set to **`None`** and all browser requests **must follow the HTTPS protocol** and include the **`Secure`** attribute which requires an encrypted connection.</span></span> <span data-ttu-id="b3bfb-147">不满足该要求的 Cookie 将 **被拒绝**。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-147">Cookies that don't adhere to that requirement will be **rejected**.</span></span> <br/><span data-ttu-id="b3bfb-148">**这两个属性是必需项**。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-148">**Both attributes are required together**.</span></span> <span data-ttu-id="b3bfb-149">如果 **`None`** 未指定 HTTPS 协议或未指定 HTTPS 协议，将拒绝第 **`Secure`**  三方 Cookie。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-149">If just **`None`** is specified without **`Secure`**  or if the HTTPS protocol is not used, the third-party cookie will be rejected.</span></span>| <span data-ttu-id="b3bfb-150">可选，但如果已设置，则 HTTPS 协议是必需的。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-150">Optional, but, if set, the HTTPS protocol is required.</span></span> |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="teams-implications-and-adjustments"></a><span data-ttu-id="b3bfb-151">Teams含义和调整</span><span class="sxs-lookup"><span data-stu-id="b3bfb-151">Teams implications and adjustments</span></span>

1. <span data-ttu-id="b3bfb-152">为 Cookie 启用相关的 SameSite 设置，并验证应用和扩展是否继续在 Teams。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-152">Enable the relevant SameSite setting for your cookies and validate that your apps and extensions continue to work in Teams.</span></span>
1. <span data-ttu-id="b3bfb-153">如果你的应用或扩展失败，在 Chrome 80 版本之前进行必要的修复。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-153">If your apps or extensions fail, make the necessary fixes prior to the Chrome 80 release.</span></span>
1. <span data-ttu-id="b3bfb-154">如果 Microsoft 内部合作伙伴需要此问题详细信息或帮助，可以加入以下团队 <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47> ：。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-154">Microsoft internal partners can join the following team if they need more information or help with this issue: <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47>.</span></span>

> [!NOTE]
> <span data-ttu-id="b3bfb-155">为获得最佳方案，建议您始终设置 SameSite 属性以反映 Cookie 的预定用途。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-155">For best practice, it is recommended that you always set SameSite attributes to reflect the intended use for your cookies.</span></span> <span data-ttu-id="b3bfb-156">不要依赖于默认浏览器行为。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-156">Do not rely on default browser behavior.</span></span> <span data-ttu-id="b3bfb-157">有关详细信息，请参阅开发人员[：为新的 SameSite=None 做好准备;安全 Cookie 设置](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-157">For more information, see [Developers: Get Ready for New SameSite=None; Secure Cookie Settings](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).</span></span>

### <a name="tabs-task-modules-and-message-extensions"></a><span data-ttu-id="b3bfb-158">选项卡、任务模块和邮件扩展</span><span class="sxs-lookup"><span data-stu-id="b3bfb-158">Tabs, task modules, and message extensions</span></span>

* <span data-ttu-id="b3bfb-159">Teams选项卡用于嵌入在顶级或第一方上下文中 `<iframes>` 查看的内容。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-159">Teams tabs use `<iframes>` to embed content that is viewed in a top-level or first-party context.</span></span>
* <span data-ttu-id="b3bfb-160">任务模块允许你在 Teams 应用程序中创建模式弹出体验。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-160">Task modules allow you to create modal popup experiences in your Teams application.</span></span> <span data-ttu-id="b3bfb-161">与选项卡类似，模式窗口在当前页面内打开。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-161">Similar to a tab, a modal window opens inside the current page.</span></span>
* <span data-ttu-id="b3bfb-162">消息扩展允许您将扩充的内容插入到来自外部资源的聊天消息中。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-162">Message extensions allow you to insert enriched content into chat message from external resources.</span></span>

<span data-ttu-id="b3bfb-163">当网站显示在 中时，嵌入内容使用的任何 Cookie 都将被视为第三方 `<iframe>` 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-163">Any cookies used by embedded content will be considered third-party when the site is displayed in an `<iframe>`.</span></span> <span data-ttu-id="b3bfb-164">此外，如果页面上的任何远程资源依赖于通过请求和标记、外部字体和个性化内容发送的 Cookie，则必须确保这些已标记为跨网站使用，例如或确保已进行回退。 `<img>` `<script>` `SameSite=None; Secure`</span><span class="sxs-lookup"><span data-stu-id="b3bfb-164">In addition, if any remote resources on a page rely on cookies being sent with a request `<img>` and `<script>` tags, external fonts, and personalized content, you must ensure those are marked for cross-site usage, such as `SameSite=None; Secure` or ensure that a fallback is in place.</span></span>

### <a name="authentication"></a><span data-ttu-id="b3bfb-165">身份验证</span><span class="sxs-lookup"><span data-stu-id="b3bfb-165">Authentication</span></span>

* <span data-ttu-id="b3bfb-166">如果需要对选项卡中的嵌入内容页进行身份验证，则需要使用基于 Web 的身份验证流。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-166">If you require authentication for embedded content pages in tabs, you'll need to use the web-based authentication flow.</span></span>
* <span data-ttu-id="b3bfb-167">基于 Web 的身份验证流还可用于配置页面、任务模块或邮件扩展。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-167">A web-based authentication flow can also be used for a configuration page, task module, or messaging extension.</span></span>
* <span data-ttu-id="b3bfb-168">你可以将基于 Web 的身份验证流用于需要使用任务模块的对话机器人。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-168">You can use  a web-based authentication flow for a conversational bot you'll need to use a task module.</span></span>

<span data-ttu-id="b3bfb-169">根据更新的 SameSite 限制，如果链接派生自外部网站，则浏览器不会将 Cookie 添加到已经过身份验证的网站。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-169">Pursuant to the updated SameSite restrictions, a browser will not add a cookie to an already authenticated web site if the link derives from an external site.</span></span> <span data-ttu-id="b3bfb-170">你将需要确保你的身份验证 Cookie 标记为跨站点使用，或者确保 `SameSite=None; Secure` 回退已到位。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-170">You'll need to ensure your authentication cookies are marked for cross-site usage — `SameSite=None; Secure` — or ensure that a fallback is in place.</span></span>

### <a name="android-system-webview"></a><span data-ttu-id="b3bfb-171">Android System WebView</span><span class="sxs-lookup"><span data-stu-id="b3bfb-171">Android System WebView</span></span>

<span data-ttu-id="b3bfb-172">Android WebView 是允许 Android 应用显示 Web 内容的 Chrome 系统组件。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-172">Android WebView is a Chrome system component that allows Android apps to display web content.</span></span> <span data-ttu-id="b3bfb-173">尽管新限制将成为默认限制，但从 Chrome 80 开始，不会立即在 WebView 上强制执行这些限制。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-173">While the new restrictions will become the default, starting with Chrome 80, they will not be immediately enforced on WebViews.</span></span> <span data-ttu-id="b3bfb-174">将来将应用这些策略。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-174">They will be applied in the future.</span></span> <span data-ttu-id="b3bfb-175">为进行准备，Android 允许本机应用直接通过[CookeManager API 设置 Cookie：](https://developer.android.com/reference/android/webkit/CookieManager)</span><span class="sxs-lookup"><span data-stu-id="b3bfb-175">To prepare, Android allows native apps to set cookies directly via the [CookeManager API](https://developer.android.com/reference/android/webkit/CookieManager):</span></span>

* <span data-ttu-id="b3bfb-176">对于仅在第一方上下文中需要的 Cookie，应根据需要将其声明为 `SameSite=Lax` 或 `SameSite=Strict` 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-176">For cookies that are only needed in a first-party context, you should declare them as `SameSite=Lax` or `SameSite=Strict`, as appropriate.</span></span>
* <span data-ttu-id="b3bfb-177">对于第三方上下文中所需的 Cookie，应确保它们声明为 `SameSite=None; Secure` 。</span><span class="sxs-lookup"><span data-stu-id="b3bfb-177">For cookies needed in a third-party context, you should ensure that they are declared as `SameSite=None; Secure`.</span></span>

## <a name="learn-more"></a><span data-ttu-id="b3bfb-178">了解详细信息</span><span class="sxs-lookup"><span data-stu-id="b3bfb-178">Learn more</span></span>

* [<span data-ttu-id="b3bfb-179">SameSite 示例</span><span class="sxs-lookup"><span data-stu-id="b3bfb-179">SameSite examples</span></span>](https://github.com/GoogleChromeLabs/samesite-examples)

* [<span data-ttu-id="b3bfb-180">SameSite Cookie 食谱</span><span class="sxs-lookup"><span data-stu-id="b3bfb-180">SameSite cookie recipes</span></span>](https://web.dev/samesite-cookie-recipes/)

* [<span data-ttu-id="b3bfb-181">已知不兼容的客户端</span><span class="sxs-lookup"><span data-stu-id="b3bfb-181">Known Incompatible Clients</span></span>]( https://www.chromium.org/updates/same-site/incompatible-clients)

* [<span data-ttu-id="b3bfb-182">开发人员：为新的 SameSite=None 做好准备;安全 Cookie 设置</span><span class="sxs-lookup"><span data-stu-id="b3bfb-182">Developers: Get Ready for New SameSite=None; Secure Cookie Settings</span></span>](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)

<span data-ttu-id="b3bfb-183">**OpenId 连接影响**</span><span class="sxs-lookup"><span data-stu-id="b3bfb-183">**OpenId Connect impact**</span></span><br>
[<span data-ttu-id="b3bfb-184">即将在网站和网站 ASP.NET ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b3bfb-184">Upcoming SameSite Cookie Changes in ASP.NET and ASP.NET Core</span></span>](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
